\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[unicode=true]{hyperref}
\hypersetup{
            pdftitle={Proposed API for tech.ml.dataset},
            pdfauthor={GenerateMe},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
% Fix footnotes in tables (requires footnote package)
\IfFileExists{footnote.sty}{\usepackage{footnote}\makesavenoteenv{long table}}{}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{Proposed API for tech.ml.dataset}
\author{GenerateMe}
\date{2020-06-01}

\begin{document}
\maketitle

\subsection{Introduction}\label{introduction}

\href{https://github.com/techascent/tech.ml.dataset}{tech.ml.dataset} is
a great and fast library which brings columnar dataset to the Clojure.
Chris Nuernberger has been working on this library for last year as a
part of bigger \texttt{tech.ml} stack.

I've started to test the library and help to fix uncovered bugs. My main
goal was to compare functionalities with the other standards from other
platforms. I focused on R solutions:
\href{https://dplyr.tidyverse.org/}{dplyr},
\href{https://tidyr.tidyverse.org/}{tidyr} and
\href{https://rdatatable.gitlab.io/data.table/}{data.table}.

During conversions of the examples I've come up how to reorganized
existing \texttt{tech.ml.dataset} functions into simple to use API. The
main goals were:

\begin{itemize}
\tightlist
\item
  Focus on dataset manipulation functionality, leaving other parts of
  \texttt{tech.ml} like pipelines, datatypes, readers, ML, etc.
\item
  Single entry point for common operations - one function dispatching on
  given arguments.
\item
  \texttt{group-by} results with special kind of dataset - a dataset
  containing subsets created after grouping as a column.
\item
  Most operations recognize regular dataset and grouped dataset and
  process data accordingly.
\item
  One function form to enable thread-first on dataset.
\end{itemize}

All proposed functions are grouped in tabs below. Select group to see
examples and details.

If you want to know more about \texttt{tech.ml.dataset} and
\texttt{tech.ml.datatype} please refer their documentation:

\begin{itemize}
\tightlist
\item
  \href{https://github.com/techascent/tech.datatype/blob/master/docs/cheatsheet.md}{Datatype}
\item
  \href{https://github.com/techascent/tech.datatype/blob/master/docs/datetime.md}{Date/time}
\item
  \href{https://github.com/techascent/tech.ml.dataset/blob/master/docs/walkthrough.md}{Dataset}
\end{itemize}

\href{https://github.com/genmeblog/techtest/blob/master/src/techtest/api.clj}{SOURCE
CODE}

INFO: The future of this API is not known yet. Two directions are
possible: integration into \texttt{tech.ml} or development under
\texttt{Scicloj} organization. For the time being use this repo if you
want to try. Join the discussion on
\href{https://clojurians.zulipchat.com/\#narrow/stream/236259-tech.2Eml.2Edataset.2Edev/topic/api}{Zulip}

Let's require main namespace and define dataset used in most examples:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{require}\NormalTok{ '[techtest.api }\AttributeTok{:as}\NormalTok{ api])}
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/dataset \{}\AttributeTok{:V1}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\DecValTok{1} \DecValTok{2}\NormalTok{]))}
                      \AttributeTok{:V2}\NormalTok{ (}\KeywordTok{range} \DecValTok{1} \DecValTok{10}\NormalTok{)}
                      \AttributeTok{:V3}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\FloatTok{0.5} \FloatTok{1.0} \FloatTok{1.5}\NormalTok{]))}
                      \AttributeTok{:V4}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\StringTok{"A"} \StringTok{"B"} \StringTok{"C"}\NormalTok{]))\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\subsection{Functionality}\label{functionality}

\subsubsection{Dataset}\label{dataset}

Dataset is a special type which can be considered as a map of columns
implemented around \texttt{tech.ml.datatype} library. Each column can be
considered as named sequence of typed data. Supported types include
integers, floats, string, boolean, date/time, objects etc.

\paragraph{Dataset creation}\label{dataset-creation}

Dataset can be created from various of types of Clojure structures and
files:

\begin{itemize}
\tightlist
\item
  single values
\item
  sequence of maps
\item
  map of sequences or values
\item
  sequence of columns (taken from other dataset or created manually)
\item
  sequence of pairs
\item
  file types: raw/gzipped csv/tsv, json, xls(x) taken from local file
  system or URL
\item
  input stream
\end{itemize}

\texttt{api/dataset} accepts:

\begin{itemize}
\tightlist
\item
  data
\item
  options (see documentation of
  \texttt{tech.ml.dataset/-\textgreater{}dataset} function for full
  list):

  \begin{itemize}
  \tightlist
  \item
    \texttt{:dataset-name} - name of the dataset
  \item
    \texttt{:num-rows} - number of rows to read from file
  \item
    \texttt{:header-row?} - indication if first row in file is a header
  \item
    \texttt{:key-fn} - function applied to column names (eg.
    \texttt{keyword}, to convert column names to keywords)
  \item
    \texttt{:separator} - column separator
  \item
    \texttt{:single-value-column-name} - name of the column when single
    value is provided
  \end{itemize}
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Empty dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
_unnamed [0 0]
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Dataset from single value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\DecValTok{999}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:\$value\tabularnewline
\midrule
\endhead
999\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Set column name for single value. Also set the dataset name.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\DecValTok{999}\NormalTok{ \{}\AttributeTok{:single-value-column-name} \StringTok{"my-single-value"}\NormalTok{\})}
\NormalTok{(api/dataset }\DecValTok{999}\NormalTok{ \{}\AttributeTok{:single-value-column-name} \StringTok{""}
                  \AttributeTok{:dataset-name} \StringTok{"Single value"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
my-single-value\tabularnewline
\midrule
\endhead
999\tabularnewline
\bottomrule
\end{longtable}

Single value {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
0\tabularnewline
\midrule
\endhead
999\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sequence of pairs (first = column name, second = value(s)).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset [[}\AttributeTok{:A} \DecValTok{33}\NormalTok{] [}\AttributeTok{:B} \DecValTok{5}\NormalTok{] [}\AttributeTok{:C} \AttributeTok{:a}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:A & :B & :C\tabularnewline
\midrule
\endhead
33 & 5 & :a\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Not sequential values are repeated row-count number of times.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset [[}\AttributeTok{:A}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3} \DecValTok{4} \DecValTok{5} \DecValTok{6}\NormalTok{]] [}\AttributeTok{:B} \StringTok{"X"}\NormalTok{] [}\AttributeTok{:C} \AttributeTok{:a}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:A & :B & :C\tabularnewline
\midrule
\endhead
1 & X & :a\tabularnewline
2 & X & :a\tabularnewline
3 & X & :a\tabularnewline
4 & X & :a\tabularnewline
5 & X & :a\tabularnewline
6 & X & :a\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Dataset created from map (keys = column names, vals = value(s)). Works
the same as sequence of pairs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset \{}\AttributeTok{:A} \DecValTok{33}\NormalTok{\})}
\NormalTok{(api/dataset \{}\AttributeTok{:A}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3}\NormalTok{]\})}
\NormalTok{(api/dataset \{}\AttributeTok{:A}\NormalTok{ [}\DecValTok{3} \DecValTok{4} \DecValTok{5}\NormalTok{] }\AttributeTok{:B} \StringTok{"X"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:A\tabularnewline
\midrule
\endhead
33\tabularnewline
\bottomrule
\end{longtable}

\_unnamed {[}3 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:A\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
3\tabularnewline
\bottomrule
\end{longtable}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:A & :B\tabularnewline
\midrule
\endhead
3 & X\tabularnewline
4 & X\tabularnewline
5 & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can put any value inside a column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset \{}\AttributeTok{:A}\NormalTok{ [[}\DecValTok{3} \DecValTok{4} \DecValTok{5}\NormalTok{] [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{]] }\AttributeTok{:B} \StringTok{"X"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:A & :B\tabularnewline
\midrule
\endhead
{[}3 4 5{]} & X\tabularnewline
{[}:a :b{]} & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sequence of maps

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset [\{}\AttributeTok{:a} \DecValTok{1} \AttributeTok{:b} \DecValTok{3}\NormalTok{\} \{}\AttributeTok{:b} \DecValTok{2} \AttributeTok{:a} \DecValTok{99}\NormalTok{\}])}
\NormalTok{(api/dataset [\{}\AttributeTok{:a} \DecValTok{1} \AttributeTok{:b}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3}\NormalTok{]\} \{}\AttributeTok{:a} \DecValTok{2} \AttributeTok{:b}\NormalTok{ [}\DecValTok{3} \DecValTok{4}\NormalTok{]\}])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
1 & 3\tabularnewline
99 & 2\tabularnewline
\bottomrule
\end{longtable}

\_unnamed {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
1 & {[}1 2 3{]}\tabularnewline
2 & {[}3 4{]}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Missing values are marked by \texttt{nil}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset [\{}\AttributeTok{:a} \VariableTok{nil} \AttributeTok{:b} \DecValTok{1}\NormalTok{\} \{}\AttributeTok{:a} \DecValTok{3} \AttributeTok{:b} \DecValTok{4}\NormalTok{\} \{}\AttributeTok{:a} \DecValTok{11}\NormalTok{\}])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
& 1\tabularnewline
3 & 4\tabularnewline
11 &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Import CSV file

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\StringTok{"data/family.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

data/family.csv {[}5 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
family & dob\_child1 & dob\_child2 & gender\_child1 &
gender\_child2\tabularnewline
\midrule
\endhead
1 & 1998-11-26 & 2000-01-29 & 1 & 2\tabularnewline
2 & 1996-06-22 & & 2 &\tabularnewline
3 & 2002-07-11 & 2004-04-05 & 2 & 2\tabularnewline
4 & 2004-10-10 & 2009-08-27 & 1 & 1\tabularnewline
5 & 2000-12-05 & 2005-02-28 & 2 & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Import from URL

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{defonce}\FunctionTok{ ds }\NormalTok{(api/dataset }\StringTok{"https://vega.github.io/vega-lite/examples/data/seattle-weather.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds}
\end{Highlighting}
\end{Shaded}

\url{https://vega.github.io/vega-lite/examples/data/seattle-weather.csv}
{[}1461 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
date & precipitation & temp\_max & temp\_min & wind &
weather\tabularnewline
\midrule
\endhead
2012-01-01 & 0.000 & 12.80 & 5.000 & 4.700 & drizzle\tabularnewline
2012-01-02 & 10.90 & 10.60 & 2.800 & 4.500 & rain\tabularnewline
2012-01-03 & 0.8000 & 11.70 & 7.200 & 2.300 & rain\tabularnewline
2012-01-04 & 20.30 & 12.20 & 5.600 & 4.700 & rain\tabularnewline
2012-01-05 & 1.300 & 8.900 & 2.800 & 6.100 & rain\tabularnewline
2012-01-06 & 2.500 & 4.400 & 2.200 & 2.200 & rain\tabularnewline
2012-01-07 & 0.000 & 7.200 & 2.800 & 2.300 & rain\tabularnewline
2012-01-08 & 0.000 & 10.00 & 2.800 & 2.000 & sun\tabularnewline
2012-01-09 & 4.300 & 9.400 & 5.000 & 3.400 & rain\tabularnewline
2012-01-10 & 1.000 & 6.100 & 0.6000 & 3.400 & rain\tabularnewline
2012-01-11 & 0.000 & 6.100 & -1.100 & 5.100 & sun\tabularnewline
2012-01-12 & 0.000 & 6.100 & -1.700 & 1.900 & sun\tabularnewline
2012-01-13 & 0.000 & 5.000 & -2.800 & 1.300 & sun\tabularnewline
2012-01-14 & 4.100 & 4.400 & 0.6000 & 5.300 & snow\tabularnewline
2012-01-15 & 5.300 & 1.100 & -3.300 & 3.200 & snow\tabularnewline
2012-01-16 & 2.500 & 1.700 & -2.800 & 5.000 & snow\tabularnewline
2012-01-17 & 8.100 & 3.300 & 0.000 & 5.600 & snow\tabularnewline
2012-01-18 & 19.80 & 0.000 & -2.800 & 5.000 & snow\tabularnewline
2012-01-19 & 15.20 & -1.100 & -2.800 & 1.600 & snow\tabularnewline
2012-01-20 & 13.50 & 7.200 & -1.100 & 2.300 & snow\tabularnewline
2012-01-21 & 3.000 & 8.300 & 3.300 & 8.200 & rain\tabularnewline
2012-01-22 & 6.100 & 6.700 & 2.200 & 4.800 & rain\tabularnewline
2012-01-23 & 0.000 & 8.300 & 1.100 & 3.600 & rain\tabularnewline
2012-01-24 & 8.600 & 10.00 & 2.200 & 5.100 & rain\tabularnewline
2012-01-25 & 8.100 & 8.900 & 4.400 & 5.400 & rain\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Saving}\label{saving}

Export dataset to a file or output stream can be done by calling
\texttt{api/write-csv!}. Function accepts:

\begin{itemize}
\tightlist
\item
  dataset
\item
  file name with one of the extensions: \texttt{.csv}, \texttt{.tsv},
  \texttt{.csv.gz} and \texttt{.tsv.gz} or output stream
\item
  options:

  \begin{itemize}
  \tightlist
  \item
    \texttt{:separator} - string or separator char.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/write-csv! ds }\StringTok{"output.tsv.gz"}\NormalTok{)}
\NormalTok{(.exists (clojure.java.io/file }\StringTok{"output.csv.gz"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
nil
true
\end{verbatim}

\paragraph{Dataset related functions}\label{dataset-related-functions}

Summary functions about the dataset like number of rows, columns and
basic stats.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Number of rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/row-count ds)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
1461
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Number of columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-count ds)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
6
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Shape of the dataset, {[}row count, column count{]}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/shape ds)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1461 6]
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

General info about dataset. There are three variants:

\begin{itemize}
\tightlist
\item
  default - containing information about columns with basic statistics

  \begin{itemize}
  \tightlist
  \item
    \texttt{:basic} - just name, row and column count and information if
    dataset is a result of \texttt{group-by} operation
  \item
    \texttt{:columns} - columns' metadata
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/info ds)}
\NormalTok{(api/info ds }\AttributeTok{:basic}\NormalTok{)}
\NormalTok{(api/info ds }\AttributeTok{:columns}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\url{https://vega.github.io/vega-lite/examples/data/seattle-weather.csv}:
descriptive-stats {[}6 10{]}:

\begin{longtable}[]{@{}llllllllll@{}}
\toprule
\begin{minipage}[b]{0.08\columnwidth}\raggedright\strut
:col-name\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\raggedright\strut
:datatype\strut
\end{minipage} & \begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
:n-valid\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright\strut
:n-missing\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright\strut
:min\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright\strut
:mean\strut
\end{minipage} & \begin{minipage}[b]{0.04\columnwidth}\raggedright\strut
:mode\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright\strut
:max\strut
\end{minipage} & \begin{minipage}[b]{0.12\columnwidth}\raggedright\strut
:standard-deviation\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
:skew\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
date\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
:packed-local-date\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
2012-01-01\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
2013-12-31\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
2015-12-31\strut
\end{minipage} & \begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
precipitation\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
:float32\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0.000\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
3.029\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
55.90\strut
\end{minipage} & \begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
6.680\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
3.506\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
temp\_max\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
:float32\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
-1.600\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
16.44\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
35.60\strut
\end{minipage} & \begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
7.350\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
0.2809\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
temp\_min\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
:float32\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
-7.100\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
8.235\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
18.30\strut
\end{minipage} & \begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
5.023\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
-0.2495\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
weather\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
:string\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
sun\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
wind\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
:float32\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0.4000\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
3.241\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
9.500\strut
\end{minipage} & \begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
1.438\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
0.8917\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\url{https://vega.github.io/vega-lite/examples/data/seattle-weather.csv}
:basic info {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
\begin{minipage}[b]{0.61\columnwidth}\raggedright\strut
:name\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\raggedright\strut
:grouped?\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright\strut
:rows\strut
\end{minipage} & \begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
:columns\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.61\columnwidth}\raggedright\strut
\url{https://vega.github.io/vega-lite/examples/data/seattle-weather.csv}\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
false\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
1461\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
6\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\url{https://vega.github.io/vega-lite/examples/data/seattle-weather.csv}
:column info {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:name & :size & :datatype & :categorical?\tabularnewline
\midrule
\endhead
date & 1461 & :packed-local-date &\tabularnewline
precipitation & 1461 & :float32 &\tabularnewline
temp\_max & 1461 & :float32 &\tabularnewline
temp\_min & 1461 & :float32 &\tabularnewline
wind & 1461 & :float32 &\tabularnewline
weather & 1461 & :string & true\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Getting a dataset name

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset-name ds)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
"https://vega.github.io/vega-lite/examples/data/seattle-weather.csv"
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Setting a dataset name (operation is immutable).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>} \StringTok{"seattle-weather"}
\NormalTok{     (api/set-dataset-name ds)}
\NormalTok{     (api/dataset-name))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
"seattle-weather"
\end{verbatim}

\paragraph{Columns and rows}\label{columns-and-rows}

Get columns and rows as sequences. \texttt{column}, \texttt{columns} and
\texttt{rows} treat grouped dataset as regular one. See \texttt{Groups}
to read more about grouped datasets.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select column.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(ds }\StringTok{"wind"}\NormalTok{)}
\NormalTok{(api/column ds }\StringTok{"date"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#tech.ml.dataset.column<float32>[1461]
wind
[4.700, 4.500, 2.300, 4.700, 6.100, 2.200, 2.300, 2.000, 3.400, 3.400, 5.100, 1.900, 1.300, 5.300, 3.200, 5.000, 5.600, 5.000, 1.600, 2.300, ...]
#tech.ml.dataset.column<packed-local-date>[1461]
date
[2012-01-01, 2012-01-02, 2012-01-03, 2012-01-04, 2012-01-05, 2012-01-06, 2012-01-07, 2012-01-08, 2012-01-09, 2012-01-10, 2012-01-11, 2012-01-12, 2012-01-13, 2012-01-14, 2012-01-15, 2012-01-16, 2012-01-17, 2012-01-18, 2012-01-19, 2012-01-20, ...]
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Columns as sequence

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{take} \DecValTok{2}\NormalTok{ (api/columns ds))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(#tech.ml.dataset.column<packed-local-date>[1461]
date
[2012-01-01, 2012-01-02, 2012-01-03, 2012-01-04, 2012-01-05, 2012-01-06, 2012-01-07, 2012-01-08, 2012-01-09, 2012-01-10, 2012-01-11, 2012-01-12, 2012-01-13, 2012-01-14, 2012-01-15, 2012-01-16, 2012-01-17, 2012-01-18, 2012-01-19, 2012-01-20, ...] #tech.ml.dataset.column<float32>[1461]
precipitation
[0.000, 10.90, 0.8000, 20.30, 1.300, 2.500, 0.000, 0.000, 4.300, 1.000, 0.000, 0.000, 0.000, 4.100, 5.300, 2.500, 8.100, 19.80, 15.20, 13.50, ...])
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Columns as map

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{keys}\NormalTok{ (api/columns ds }\AttributeTok{:as-map}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
("date" "precipitation" "temp_max" "temp_min" "wind" "weather")
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Rows as sequence of sequences

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{take} \DecValTok{2}\NormalTok{ (api/rows ds))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
([#object[java.time.LocalDate 0x1e1b4a9b "2012-01-01"] 0.0 12.8 5.0 4.7 "drizzle"] [#object[java.time.LocalDate 0x13703875 "2012-01-02"] 10.9 10.6 2.8 4.5 "rain"])
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Rows as sequence of maps

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(clojure.pprint/pprint (}\KeywordTok{take} \DecValTok{2}\NormalTok{ (api/rows ds }\AttributeTok{:as-maps}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
({"date" #object[java.time.LocalDate 0x336b67d4 "2012-01-01"],
  "precipitation" 0.0,
  "temp_min" 5.0,
  "weather" "drizzle",
  "temp_max" 12.8,
  "wind" 4.7}
 {"date" #object[java.time.LocalDate 0x49c7ff5d "2012-01-02"],
  "precipitation" 10.9,
  "temp_min" 2.8,
  "weather" "rain",
  "temp_max" 10.6,
  "wind" 4.5})
\end{verbatim}

\paragraph{Printing}\label{printing}

Dataset is printed using \texttt{dataset-\textgreater{}str} or
\texttt{print-dataset} functions. Options are the same as in
\texttt{tech.ml.dataset/dataset-data-\textgreater{}str}. Most important
is \texttt{:print-line-policy} which can be one of the:
\texttt{:single}, \texttt{:repl} or \texttt{:markdown}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/print-dataset (api/group-by DS }\AttributeTok{:V1}\NormalTok{) \{}\AttributeTok{:print-line-policy} \AttributeTok{:markdown}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
_unnamed [2 3]:

| :name | :group-id |                                                                                                                                                                                                                                                                                  :data |
|-------|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|     1 |         0 | Group: 1 [5 4]:<br><br>\| :V1 \| :V2 \|    :V3 \| :V4 \|<br>\|-----\|-----\|--------\|-----\|<br>\|   1 \|   1 \| 0.5000 \|   A \|<br>\|   1 \|   3 \|  1.500 \|   C \|<br>\|   1 \|   5 \|  1.000 \|   B \|<br>\|   1 \|   7 \| 0.5000 \|   A \|<br>\|   1 \|   9 \|  1.500 \|   C \| |
|     2 |         1 |                                      Group: 2 [4 4]:<br><br>\| :V1 \| :V2 \|    :V3 \| :V4 \|<br>\|-----\|-----\|--------\|-----\|<br>\|   2 \|   2 \|  1.000 \|   B \|<br>\|   2 \|   4 \| 0.5000 \|   A \|<br>\|   2 \|   6 \|  1.500 \|   C \|<br>\|   2 \|   8 \|  1.000 \|   B \| |
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/print-dataset (api/group-by DS }\AttributeTok{:V1}\NormalTok{) \{}\AttributeTok{:print-line-policy} \AttributeTok{:repl}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
_unnamed [2 3]:

| :name | :group-id |                             :data |
|-------|-----------|-----------------------------------|
|     1 |         0 | Group: 1 [5 4]:                   |
|       |           |                                   |
|       |           | \| :V1 \| :V2 \|    :V3 \| :V4 \| |
|       |           | \|-----\|-----\|--------\|-----\| |
|       |           | \|   1 \|   1 \| 0.5000 \|   A \| |
|       |           | \|   1 \|   3 \|  1.500 \|   C \| |
|       |           | \|   1 \|   5 \|  1.000 \|   B \| |
|       |           | \|   1 \|   7 \| 0.5000 \|   A \| |
|       |           | \|   1 \|   9 \|  1.500 \|   C \| |
|     2 |         1 | Group: 2 [4 4]:                   |
|       |           |                                   |
|       |           | \| :V1 \| :V2 \|    :V3 \| :V4 \| |
|       |           | \|-----\|-----\|--------\|-----\| |
|       |           | \|   2 \|   2 \|  1.000 \|   B \| |
|       |           | \|   2 \|   4 \| 0.5000 \|   A \| |
|       |           | \|   2 \|   6 \|  1.500 \|   C \| |
|       |           | \|   2 \|   8 \|  1.000 \|   B \| |
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/print-dataset (api/group-by DS }\AttributeTok{:V1}\NormalTok{) \{}\AttributeTok{:print-line-policy} \AttributeTok{:single}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
_unnamed [2 3]:

| :name | :group-id |           :data |
|-------|-----------|-----------------|
|     1 |         0 | Group: 1 [5 4]: |
|     2 |         1 | Group: 2 [4 4]: |
\end{verbatim}

\subsubsection{Group-by}\label{group-by}

Grouping by is an operation which splits dataset into subdatasets and
pack it into new special type of\ldots{} dataset. I distinguish two
types of dataset: regular dataset and grouped dataset. The latter is the
result of grouping.

Grouped dataset is annotated in by \texttt{:grouped?} meta tag and
consist following columns:

\begin{itemize}
\tightlist
\item
  \texttt{:name} - group name or structure
\item
  \texttt{:group-id} - integer assigned to the group
\item
  \texttt{:data} - groups as datasets
\end{itemize}

Almost all functions recognize type of the dataset (grouped or not) and
operate accordingly.

You can't apply reshaping or join/concat functions on grouped datasets.

\paragraph{Grouping}\label{grouping}

Grouping is done by calling \texttt{group-by} function with arguments:

\begin{itemize}
\tightlist
\item
  \texttt{ds} - dataset
\item
  \texttt{grouping-selector} - what to use for grouping
\item
  options:

  \begin{itemize}
  \tightlist
  \item
    \texttt{:result-type} - what to return:

    \begin{itemize}
    \tightlist
    \item
      \texttt{:as-dataset} (default) - return grouped dataset
    \item
      \texttt{:as-indexes} - return rows ids (row number from original
      dataset)
    \item
      \texttt{:as-map} - return map with group names as keys and
      subdataset as values
    \item
      \texttt{:as-seq} - return sequens of subdatasets
    \end{itemize}
  \item
    \texttt{:select-keys} - list of the columns passed to a grouping
    selector function
  \end{itemize}
\end{itemize}

All subdatasets (groups) have set name as the group name, additionally
\texttt{group-id} is in meta.

Grouping can be done by:

\begin{itemize}
\tightlist
\item
  single column name
\item
  seq of column names
\item
  map of keys (group names) and row indexes
\item
  value returned by function taking row as map (limited to
  \texttt{:select-keys})
\end{itemize}

Note: currently dataset inside dataset is printed recursively so it
renders poorly from markdown. So I will use \texttt{:as-seq} result type
to show just group names and groups.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

List of columns in grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/column-names))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V2 :V3 :V4)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

List of columns in grouped dataset treated as regular dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/as-regular-dataset)}
\NormalTok{    (api/column-names))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:name :group-id :data)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Content of the grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/columns (api/group-by DS }\AttributeTok{:V1}\NormalTok{) }\AttributeTok{:as-map}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
{:name #tech.ml.dataset.column<int64>[2]
:name
[1, 2, ], :group-id #tech.ml.dataset.column<int64>[2]
:group-id
[0, 1, ], :data #tech.ml.dataset.column<object>[2]
:data
[Group: 1 [5 4]:

| :V1 | :V2 |    :V3 | :V4 |
|-----|-----|--------|-----|
|   1 |   1 | 0.5000 |   A |
|   1 |   3 |  1.500 |   C |
|   1 |   5 |  1.000 |   B |
|   1 |   7 | 0.5000 |   A |
|   1 |   9 |  1.500 |   C |
, Group: 2 [4 4]:

| :V1 | :V2 |    :V3 | :V4 |
|-----|-----|--------|-----|
|   2 |   2 |  1.000 |   B |
|   2 |   4 | 0.5000 |   A |
|   2 |   6 |  1.500 |   C |
|   2 |   8 |  1.000 |   B |
, ]}
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouped dataset as map

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{keys}\NormalTok{ (api/group-by DS }\AttributeTok{:V1}\NormalTok{ \{}\AttributeTok{:result-type} \AttributeTok{:as-map}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(1 2)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{vals}\NormalTok{ (api/group-by DS }\AttributeTok{:V1}\NormalTok{ \{}\AttributeTok{:result-type} \AttributeTok{:as-map}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

(Group: 1 {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: 2 {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Group dataset as map of indexes (row ids)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS }\AttributeTok{:V1}\NormalTok{ \{}\AttributeTok{:result-type} \AttributeTok{:as-indexes}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
{1 [0 2 4 6 8], 2 [1 3 5 7]}
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouped datasets are printed as follows by default.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:name & :group-id & :data\tabularnewline
\midrule
\endhead
1 & 0 & Group: 1 {[}5 4{]}:\tabularnewline
2 & 1 & Group: 2 {[}4 4{]}:\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

To get groups as sequence or a map can be done from grouped dataset
using \texttt{groups-\textgreater{}seq} and
\texttt{groups-\textgreater{}map} functions.

Groups as seq can be obtained by just accessing \texttt{:data} column.

I will use temporary dataset here.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{let}\NormalTok{ [ds (}\KeywordTok{->}\NormalTok{ \{}\StringTok{"a"}\NormalTok{ [}\DecValTok{1} \DecValTok{1} \DecValTok{2} \DecValTok{2}\NormalTok{]}
              \StringTok{"b"}\NormalTok{ [}\StringTok{"a"} \StringTok{"b"} \StringTok{"c"} \StringTok{"d"}\NormalTok{]\}}
\NormalTok{             (api/dataset)}
\NormalTok{             (api/group-by }\StringTok{"a"}\NormalTok{))]}
\NormalTok{  (}\KeywordTok{seq}\NormalTok{ (ds }\AttributeTok{:data}\NormalTok{))) }\CommentTok{;; seq is not necessary but Markdown treats `:data` as command here}
\end{Highlighting}
\end{Shaded}

(Group: 1 {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
1 & a\tabularnewline
1 & b\tabularnewline
\bottomrule
\end{longtable}

Group: 2 {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
2 & c\tabularnewline
2 & d\tabularnewline
\bottomrule
\end{longtable}

)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ \{}\StringTok{"a"}\NormalTok{ [}\DecValTok{1} \DecValTok{1} \DecValTok{2} \DecValTok{2}\NormalTok{]}
     \StringTok{"b"}\NormalTok{ [}\StringTok{"a"} \StringTok{"b"} \StringTok{"c"} \StringTok{"d"}\NormalTok{]\}}
\NormalTok{    (api/dataset)}
\NormalTok{    (api/group-by }\StringTok{"a"}\NormalTok{)}
\NormalTok{    (api/groups->seq))}
\end{Highlighting}
\end{Shaded}

(Group: 1 {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
1 & a\tabularnewline
1 & b\tabularnewline
\bottomrule
\end{longtable}

Group: 2 {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
2 & c\tabularnewline
2 & d\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Groups as map

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ \{}\StringTok{"a"}\NormalTok{ [}\DecValTok{1} \DecValTok{1} \DecValTok{2} \DecValTok{2}\NormalTok{]}
     \StringTok{"b"}\NormalTok{ [}\StringTok{"a"} \StringTok{"b"} \StringTok{"c"} \StringTok{"d"}\NormalTok{]\}}
\NormalTok{    (api/dataset)}
\NormalTok{    (api/group-by }\StringTok{"a"}\NormalTok{)}
\NormalTok{    (api/groups->map))}
\end{Highlighting}
\end{Shaded}

\{1 Group: 1 {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
1 & a\tabularnewline
1 & b\tabularnewline
\bottomrule
\end{longtable}

, 2 Group: 2 {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
2 & c\tabularnewline
2 & d\tabularnewline
\bottomrule
\end{longtable}

\}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouping by more than one column. You can see that group names are maps.
When ungrouping is done these maps are used to restore column names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS [}\AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{] \{}\AttributeTok{:result-type} \AttributeTok{:as-seq}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

(Group: \{:V3 1.0, :V1 1\} {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

Group: \{:V3 0.5, :V1 1\} {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

Group: \{:V3 0.5, :V1 2\} {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

Group: \{:V3 1.0, :V1 2\} {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

Group: \{:V3 1.5, :V1 1\} {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: \{:V3 1.5, :V1 2\} {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouping can be done by providing just row indexes. This way you can
assign the same row to more than one group.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS \{}\StringTok{"group-a"}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{1} \DecValTok{2}\NormalTok{]}
                  \StringTok{"group-b"}\NormalTok{ [}\DecValTok{5} \DecValTok{5} \DecValTok{5} \DecValTok{1}\NormalTok{]\} \{}\AttributeTok{:result-type} \AttributeTok{:as-seq}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

(Group: group-a {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: group-b {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can group by a result of grouping function which gets row as map and
should return group name. When map is used as a group name, ungrouping
restore original column names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{*}\NormalTok{ (}\AttributeTok{:V1}\NormalTok{ row)}
\NormalTok{                             (}\AttributeTok{:V3}\NormalTok{ row))) \{}\AttributeTok{:result-type} \AttributeTok{:as-seq}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

(Group: 1.0 {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

Group: 2.0 {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

Group: 0.5 {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

Group: 3.0 {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: 1.5 {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can use any predicate on column to split dataset into two groups.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<} \VariableTok{%} \FloatTok{1.0}\NormalTok{) }\AttributeTok{:V3}\NormalTok{) \{}\AttributeTok{:result-type} \AttributeTok{:as-seq}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

(Group: false {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: true {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\texttt{juxt} is also helpful

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS (}\KeywordTok{juxt} \AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{) \{}\AttributeTok{:result-type} \AttributeTok{:as-seq}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

(Group: {[}1 1.0{]} {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

Group: {[}1 0.5{]} {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

Group: {[}2 1.5{]} {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: {[}1 1.5{]} {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: {[}2 0.5{]} {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

Group: {[}2 1.0{]} {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\texttt{tech.ml.dataset} provides an option to limit columns which are
passed to grouping functions. It's done for performance purposes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS }\KeywordTok{identity}\NormalTok{ \{}\AttributeTok{:result-type} \AttributeTok{:as-seq}
                           \AttributeTok{:select-keys}\NormalTok{ [}\AttributeTok{:V1}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

(Group: \{:V1 1\} {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

Group: \{:V1 2\} {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

)

\paragraph{Ungrouping}\label{ungrouping}

Ungrouping simply concats all the groups into the dataset. Following
options are possible

\begin{itemize}
\tightlist
\item
  \texttt{:order?} - order groups according to the group name ascending
  order. Default: \texttt{false}
\item
  \texttt{:add-group-as-column} - should group name become a column? If
  yes column is created with provided name (or \texttt{:\$group-name} if
  argument is \texttt{true}). Default: \texttt{nil}.
\item
  \texttt{:add-group-id-as-column} - should group id become a column? If
  yes column is created with provided name (or \texttt{:\$group-id} if
  argument is \texttt{true}). Default: \texttt{nil}.
\item
  \texttt{:dataset-name} - to name resulting dataset. Default:
  \texttt{nil} (\_unnamed)
\end{itemize}

If group name is a map, it will be splitted into separate columns. Be
sure that groups (subdatasets) doesn't contain the same columns already.

If group name is a vector, it will be splitted into separate columns. If
you want to name them, set vector of target column names as
\texttt{:add-group-as-column} argument.

After ungrouping, order of the rows is kept within the groups but groups
are ordered according to the internal storage.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouping and ungrouping.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Groups sorted by group name and named.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/ungroup \{}\AttributeTok{:order}\NormalTok{? }\VariableTok{true}
                  \AttributeTok{:dataset-name} \StringTok{"Ordered by V3"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

Ordered by V3 {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Groups sorted descending by group name and named.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/ungroup \{}\AttributeTok{:order}\NormalTok{? }\AttributeTok{:desc}
                  \AttributeTok{:dataset-name} \StringTok{"Ordered by V3 descending"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

Ordered by V3 descending {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's add group name and id as additional columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<} \VariableTok{%} \DecValTok{4}\NormalTok{) }\AttributeTok{:V2}\NormalTok{))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column} \VariableTok{true}
                  \AttributeTok{:add-group-id-as-column} \VariableTok{true}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:\$group-name & :\$group-id & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
false & 0 & 2 & 4 & 0.5000 & A\tabularnewline
false & 0 & 1 & 5 & 1.000 & B\tabularnewline
false & 0 & 2 & 6 & 1.500 & C\tabularnewline
false & 0 & 1 & 7 & 0.5000 & A\tabularnewline
false & 0 & 2 & 8 & 1.000 & B\tabularnewline
false & 0 & 1 & 9 & 1.500 & C\tabularnewline
true & 1 & 1 & 1 & 0.5000 & A\tabularnewline
true & 1 & 2 & 2 & 1.000 & B\tabularnewline
true & 1 & 1 & 3 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's assign different column names

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<} \VariableTok{%} \DecValTok{4}\NormalTok{) }\AttributeTok{:V2}\NormalTok{))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column} \StringTok{"Is V2 less than 4?"}
                  \AttributeTok{:add-group-id-as-column} \StringTok{"group id"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
Is V2 less than 4? & group id & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
false & 0 & 2 & 4 & 0.5000 & A\tabularnewline
false & 0 & 1 & 5 & 1.000 & B\tabularnewline
false & 0 & 2 & 6 & 1.500 & C\tabularnewline
false & 0 & 1 & 7 & 0.5000 & A\tabularnewline
false & 0 & 2 & 8 & 1.000 & B\tabularnewline
false & 0 & 1 & 9 & 1.500 & C\tabularnewline
true & 1 & 1 & 1 & 0.5000 & A\tabularnewline
true & 1 & 2 & 2 & 1.000 & B\tabularnewline
true & 1 & 1 & 3 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If we group by map, we can automatically create new columns out of group
names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row] \{}\StringTok{"V1 and V3 multiplied"}\NormalTok{ (}\KeywordTok{*}\NormalTok{ (}\AttributeTok{:V1}\NormalTok{ row)}
\NormalTok{                                                      (}\AttributeTok{:V3}\NormalTok{ row))}
                            \StringTok{"V4 as lowercase"}\NormalTok{ (clojure.string/lower-case (}\AttributeTok{:V4}\NormalTok{ row))\}))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column} \VariableTok{true}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
V1 and V3 multiplied & V4 as lowercase & :V1 & :V2 & :V3 &
:V4\tabularnewline
\midrule
\endhead
1.000 & a & 2 & 4 & 0.5000 & A\tabularnewline
0.5000 & a & 1 & 1 & 0.5000 & A\tabularnewline
0.5000 & a & 1 & 7 & 0.5000 & A\tabularnewline
1.000 & b & 1 & 5 & 1.000 & B\tabularnewline
2.000 & b & 2 & 2 & 1.000 & B\tabularnewline
2.000 & b & 2 & 8 & 1.000 & B\tabularnewline
3.000 & c & 2 & 6 & 1.500 & C\tabularnewline
1.500 & c & 1 & 3 & 1.500 & C\tabularnewline
1.500 & c & 1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

We can add group names without separation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row] \{}\StringTok{"V1 and V3 multiplied"}\NormalTok{ (}\KeywordTok{*}\NormalTok{ (}\AttributeTok{:V1}\NormalTok{ row)}
\NormalTok{                                                      (}\AttributeTok{:V3}\NormalTok{ row))}
                            \StringTok{"V4 as lowercase"}\NormalTok{ (clojure.string/lower-case (}\AttributeTok{:V4}\NormalTok{ row))\}))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column} \StringTok{"just map"}
                  \AttributeTok{:separate}\NormalTok{? }\VariableTok{false}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
just map & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
\{``V1 and V3 multiplied'' 1.0, ``V4 as lowercase'' ``a''\} & 2 & 4 &
0.5000 & A\tabularnewline
\{``V1 and V3 multiplied'' 0.5, ``V4 as lowercase'' ``a''\} & 1 & 1 &
0.5000 & A\tabularnewline
\{``V1 and V3 multiplied'' 0.5, ``V4 as lowercase'' ``a''\} & 1 & 7 &
0.5000 & A\tabularnewline
\{``V1 and V3 multiplied'' 1.0, ``V4 as lowercase'' ``b''\} & 1 & 5 &
1.000 & B\tabularnewline
\{``V1 and V3 multiplied'' 2.0, ``V4 as lowercase'' ``b''\} & 2 & 2 &
1.000 & B\tabularnewline
\{``V1 and V3 multiplied'' 2.0, ``V4 as lowercase'' ``b''\} & 2 & 8 &
1.000 & B\tabularnewline
\{``V1 and V3 multiplied'' 3.0, ``V4 as lowercase'' ``c''\} & 2 & 6 &
1.500 & C\tabularnewline
\{``V1 and V3 multiplied'' 1.5, ``V4 as lowercase'' ``c''\} & 1 & 3 &
1.500 & C\tabularnewline
\{``V1 and V3 multiplied'' 1.5, ``V4 as lowercase'' ``c''\} & 1 & 9 &
1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The same applies to group names as sequences

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{juxt} \AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column} \StringTok{"abc"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:abc-0 & :abc-1 & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1.000 & 1 & 5 & 1.000 & B\tabularnewline
1 & 0.5000 & 1 & 1 & 0.5000 & A\tabularnewline
1 & 0.5000 & 1 & 7 & 0.5000 & A\tabularnewline
2 & 1.500 & 2 & 6 & 1.500 & C\tabularnewline
1 & 1.500 & 1 & 3 & 1.500 & C\tabularnewline
1 & 1.500 & 1 & 9 & 1.500 & C\tabularnewline
2 & 0.5000 & 2 & 4 & 0.5000 & A\tabularnewline
2 & 1.000 & 2 & 2 & 1.000 & B\tabularnewline
2 & 1.000 & 2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's provide column names

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{juxt} \AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column}\NormalTok{ [}\StringTok{"v1"} \StringTok{"v3"}\NormalTok{]\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
v1 & v3 & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1.000 & 1 & 5 & 1.000 & B\tabularnewline
1 & 0.5000 & 1 & 1 & 0.5000 & A\tabularnewline
1 & 0.5000 & 1 & 7 & 0.5000 & A\tabularnewline
2 & 1.500 & 2 & 6 & 1.500 & C\tabularnewline
1 & 1.500 & 1 & 3 & 1.500 & C\tabularnewline
1 & 1.500 & 1 & 9 & 1.500 & C\tabularnewline
2 & 0.5000 & 2 & 4 & 0.5000 & A\tabularnewline
2 & 1.000 & 2 & 2 & 1.000 & B\tabularnewline
2 & 1.000 & 2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Also we can supress separation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{juxt} \AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{))}
\NormalTok{    (api/ungroup \{}\AttributeTok{:separate}\NormalTok{? }\VariableTok{false}
                  \AttributeTok{:add-group-as-column} \VariableTok{true}\NormalTok{\}))}
\CommentTok{;; => _unnamed [9 5]:}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:\$group-name & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
{[}1 1.0{]} & 1 & 5 & 1.000 & B\tabularnewline
{[}1 0.5{]} & 1 & 1 & 0.5000 & A\tabularnewline
{[}1 0.5{]} & 1 & 7 & 0.5000 & A\tabularnewline
{[}2 1.5{]} & 2 & 6 & 1.500 & C\tabularnewline
{[}1 1.5{]} & 1 & 3 & 1.500 & C\tabularnewline
{[}1 1.5{]} & 1 & 9 & 1.500 & C\tabularnewline
{[}2 0.5{]} & 2 & 4 & 0.5000 & A\tabularnewline
{[}2 1.0{]} & 2 & 2 & 1.000 & B\tabularnewline
{[}2 1.0{]} & 2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Other functions}\label{other-functions}

To check if dataset is grouped or not just use \texttt{grouped?}
function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/grouped? DS)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
nil
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/grouped? (api/group-by DS }\AttributeTok{:V1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
true
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If you want to remove grouping annotation (to make all the functions
work as with regular dataset) you can use \texttt{unmark-group} or
\texttt{as-regular-dataset} (alias) functions.

It can be important when you want to remove some groups (rows) from
grouped dataset using \texttt{drop-rows} or something like that.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/as-regular-dataset)}
\NormalTok{    (api/grouped?))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
nil
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

This is considered internal.

If you want to implement your own mapping function on grouped dataset
you can call \texttt{process-group-data} and pass function operating on
datasets. Result should be a dataset to have ungrouping working.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/process-group-data #(}\KeywordTok{str} \StringTok{"Shape: "}\NormalTok{ (}\KeywordTok{vector}\NormalTok{ (api/row-count }\VariableTok{%}\NormalTok{) (api/column-count }\VariableTok{%}\NormalTok{))))}
\NormalTok{    (api/as-regular-dataset))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:name & :group-id & :data\tabularnewline
\midrule
\endhead
1 & 0 & Shape: {[}5 4{]}\tabularnewline
2 & 1 & Shape: {[}4 4{]}\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Columns}\label{columns}

Column is a special \texttt{tech.ml.dataset} structure based on
\texttt{tech.ml.datatype} library. For our purposes we cat treat columns
as typed and named sequence bound to particular dataset.

Type of the data is inferred from a sequence during column creation.

\paragraph{Names}\label{names}

To select dataset columns or column names \texttt{columns-selector} is
used. \texttt{columns-selector} can be one of the following:

\begin{itemize}
\tightlist
\item
  \texttt{:all} keyword - selects all columns
\item
  column name - for single column
\item
  sequence of column names - for collection of columns
\item
  regex - to apply pattern on column names or datatype
\item
  filter predicate - to filter column names or datatype
\item
  \texttt{type} namespaced keyword for specific datatype or group of
  datatypes
\end{itemize}

Column name can be anything.

\texttt{column-names} function returns names according to
\texttt{columns-selector} and optional \texttt{meta-field}.
\texttt{meta-field} is one of the following:

\begin{itemize}
\tightlist
\item
  \texttt{:name} (default) - to operate on column names
\item
  \texttt{:datatype} - to operated on column types
\item
  \texttt{:all} - if you want to process all metadata
\end{itemize}

Datatype groups are:

\begin{itemize}
\tightlist
\item
  \texttt{:type/numerical} - any numerical type
\item
  \texttt{:type/float} - floating point number (\texttt{:float32} and
  \texttt{:float64})
\item
  \texttt{:type/integer} - any integer
\item
  \texttt{:type/datetime} - any datetime type
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

To select all column names you can use \texttt{column-names} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V2 :V3 :V4)
\end{verbatim}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS }\AttributeTok{:all}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V2 :V3 :V4)
\end{verbatim}

In case you want to select column which has name \texttt{:all} (or is
sequence or map), put it into a vector. Below code returns empty
sequence since there is no such column in the dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS [}\AttributeTok{:all}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
()
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Obviously selecting single name returns it's name if available

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{(api/column-names DS }\StringTok{"no such column"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1)
()
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select sequence of column names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS [}\AttributeTok{:V1} \StringTok{"V2"} \AttributeTok{:V3} \AttributeTok{:V4} \AttributeTok{:V5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V3 :V4)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select names based on regex, columns ends with \texttt{1} or \texttt{4}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS }\SpecialStringTok{#".*[14]"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V4)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select names based on regex operating on type of the column (to check
what are the column types, call \texttt{(api/info\ DS\ :columns)}. Here
we want to get integer columns only.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS }\SpecialStringTok{#"^:int.*"} \AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V2)
\end{verbatim}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS }\AttributeTok{:type/integer}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1 :V2)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

And finally we can use predicate to select names. Let's select double
precision columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS #\{}\AttributeTok{:float64}\NormalTok{\} }\AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V3)
\end{verbatim}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS }\AttributeTok{:type/float64} \AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V3)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If you want to select all columns but given, use \texttt{complement}
function. Works only on a predicate.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V1}\NormalTok{\}))}
\NormalTok{(api/column-names DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:float64}\NormalTok{\}) }\AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V2 :V3 :V4)
(:V1 :V2 :V4)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can select column names based on all column metadata at once by
using \texttt{:all} metadata selector. Below we want to select column
names ending with \texttt{1} which have \texttt{long} datatype.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/column-names DS (}\KeywordTok{fn}\NormalTok{ [}\KeywordTok{meta}\NormalTok{]}
\NormalTok{                       (}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=} \AttributeTok{:int64}\NormalTok{ (}\AttributeTok{:datatype} \KeywordTok{meta}\NormalTok{))}
\NormalTok{                            (clojure.string/ends-with? (}\AttributeTok{:name} \KeywordTok{meta}\NormalTok{) }\StringTok{"1"}\NormalTok{))) }\AttributeTok{:all}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(:V1)
\end{verbatim}

\paragraph{Select}\label{select}

\texttt{select-columns} creates dataset with columns selected by
\texttt{columns-selector} as described above. Function works on regular
and grouped dataset.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select only float64 columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS #(}\KeywordTok{=} \AttributeTok{:float64} \VariableTok{%}\NormalTok{) }\AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select all but \texttt{:V1} columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V1}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 0.5000 & A\tabularnewline
2 & 1.000 & B\tabularnewline
3 & 1.500 & C\tabularnewline
4 & 0.5000 & A\tabularnewline
5 & 1.000 & B\tabularnewline
6 & 1.500 & C\tabularnewline
7 & 0.5000 & A\tabularnewline
8 & 1.000 & B\tabularnewline
9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If we have grouped data set, column selection is applied to every group
separately.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/select-columns [}\AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{])}
\NormalTok{    (api/groups->map))}
\end{Highlighting}
\end{Shaded}

\{1 Group: 1 {[}5 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V2 & :V3\tabularnewline
\midrule
\endhead
1 & 0.5000\tabularnewline
3 & 1.500\tabularnewline
5 & 1.000\tabularnewline
7 & 0.5000\tabularnewline
9 & 1.500\tabularnewline
\bottomrule
\end{longtable}

, 2 Group: 2 {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V2 & :V3\tabularnewline
\midrule
\endhead
2 & 1.000\tabularnewline
4 & 0.5000\tabularnewline
6 & 1.500\tabularnewline
8 & 1.000\tabularnewline
\bottomrule
\end{longtable}

\}

\paragraph{Drop}\label{drop}

\texttt{drop-columns} creates dataset with removed columns.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Drop float64 columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-columns DS #(}\KeywordTok{=} \AttributeTok{:float64} \VariableTok{%}\NormalTok{) }\AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & A\tabularnewline
2 & 2 & B\tabularnewline
1 & 3 & C\tabularnewline
2 & 4 & A\tabularnewline
1 & 5 & B\tabularnewline
2 & 6 & C\tabularnewline
1 & 7 & A\tabularnewline
2 & 8 & B\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Drop all columns but \texttt{:V1} and \texttt{:V2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-columns DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
1 & 1\tabularnewline
2 & 2\tabularnewline
1 & 3\tabularnewline
2 & 4\tabularnewline
1 & 5\tabularnewline
2 & 6\tabularnewline
1 & 7\tabularnewline
2 & 8\tabularnewline
1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If we have grouped data set, column selection is applied to every group
separately. Selected columns are dropped.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/drop-columns [}\AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{])}
\NormalTok{    (api/groups->map))}
\end{Highlighting}
\end{Shaded}

\{1 Group: 1 {[}5 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V4\tabularnewline
\midrule
\endhead
1 & A\tabularnewline
1 & C\tabularnewline
1 & B\tabularnewline
1 & A\tabularnewline
1 & C\tabularnewline
\bottomrule
\end{longtable}

, 2 Group: 2 {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V4\tabularnewline
\midrule
\endhead
2 & B\tabularnewline
2 & A\tabularnewline
2 & C\tabularnewline
2 & B\tabularnewline
\bottomrule
\end{longtable}

\}

\paragraph{Rename}\label{rename}

If you want to rename colums use \texttt{rename-columns} and pass map
where keys are old names, values new ones.

You can also pass mapping function with optional columns-selector

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/rename-columns DS \{}\AttributeTok{:V1} \StringTok{"v1"}
                        \AttributeTok{:V2} \StringTok{"v2"}
                        \AttributeTok{:V3}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3}\NormalTok{]}
                        \AttributeTok{:V4}\NormalTok{ (Object.)\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
v1 & v2 & {[}1 2 3{]} &
\href{mailto:java.lang.Object@7c3f0bfa}{\nolinkurl{java.lang.Object@7c3f0bfa}}\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Map all names with function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/rename-columns DS (}\KeywordTok{comp} \KeywordTok{str} \KeywordTok{second} \KeywordTok{name}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
1 & 2 & 3 & 4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Map selected names with function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/rename-columns DS [}\AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{] (}\KeywordTok{comp} \KeywordTok{str} \KeywordTok{second} \KeywordTok{name}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
1 & :V2 & 3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Function works on grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/rename-columns \{}\AttributeTok{:V1} \StringTok{"v1"}
                         \AttributeTok{:V2} \StringTok{"v2"}
                         \AttributeTok{:V3}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3}\NormalTok{]}
                         \AttributeTok{:V4}\NormalTok{ (Object.)\})}
\NormalTok{    (api/groups->map))}
\end{Highlighting}
\end{Shaded}

\{1 Group: 1 {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
v1 & v2 & {[}1 2 3{]} &
\href{mailto:java.lang.Object@7b93efb6}{\nolinkurl{java.lang.Object@7b93efb6}}\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

, 2 Group: 2 {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
v1 & v2 & {[}1 2 3{]} &
\href{mailto:java.lang.Object@7b93efb6}{\nolinkurl{java.lang.Object@7b93efb6}}\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\}

\paragraph{Add or update}\label{add-or-update}

To add (or update existing) column call \texttt{add-or-update-column}
function. Function accepts:

\begin{itemize}
\tightlist
\item
  \texttt{ds} - a dataset
\item
  \texttt{column-name} - if it's existing column name, column will be
  replaced
\item
  \texttt{column} - can be column (from other dataset), sequence, single
  value or function. Too big columns are always trimmed. Too small are
  cycled or extended with missing values (according to
  \texttt{size-strategy} argument)
\item
  \texttt{size-strategy} (optional) - when new column is shorter than
  dataset row count, following strategies are applied:

  \begin{itemize}
  \tightlist
  \item
    \texttt{:cycle} (default) - repeat data
  \item
    \texttt{:na} - append missing values
  \item
    \texttt{:strict} - throws an exception when sizes mismatch
  \end{itemize}
\end{itemize}

Function works on grouped dataset.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Add single value as column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-column DS }\AttributeTok{:V5} \StringTok{"X"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & X\tabularnewline
2 & 2 & 1.000 & B & X\tabularnewline
1 & 3 & 1.500 & C & X\tabularnewline
2 & 4 & 0.5000 & A & X\tabularnewline
1 & 5 & 1.000 & B & X\tabularnewline
2 & 6 & 1.500 & C & X\tabularnewline
1 & 7 & 0.5000 & A & X\tabularnewline
2 & 8 & 1.000 & B & X\tabularnewline
1 & 9 & 1.500 & C & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Replace one column (column is trimmed)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-column DS }\AttributeTok{:V1}\NormalTok{ (}\KeywordTok{repeatedly} \KeywordTok{rand}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
0.8284 & 1 & 0.5000 & A\tabularnewline
0.2794 & 2 & 1.000 & B\tabularnewline
0.4280 & 3 & 1.500 & C\tabularnewline
0.9230 & 4 & 0.5000 & A\tabularnewline
0.8369 & 5 & 1.000 & B\tabularnewline
0.8839 & 6 & 1.500 & C\tabularnewline
0.5740 & 7 & 0.5000 & A\tabularnewline
0.04703 & 8 & 1.000 & B\tabularnewline
0.06775 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Copy column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-column DS }\AttributeTok{:V5}\NormalTok{ (DS }\AttributeTok{:V1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & 1\tabularnewline
2 & 2 & 1.000 & B & 2\tabularnewline
1 & 3 & 1.500 & C & 1\tabularnewline
2 & 4 & 0.5000 & A & 2\tabularnewline
1 & 5 & 1.000 & B & 1\tabularnewline
2 & 6 & 1.500 & C & 2\tabularnewline
1 & 7 & 0.5000 & A & 1\tabularnewline
2 & 8 & 1.000 & B & 2\tabularnewline
1 & 9 & 1.500 & C & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

When function is used, argument is whole dataset and the result should
be column, sequence or single value

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-column DS }\AttributeTok{:row-count}\NormalTok{ api/row-count) }
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :row-count\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & 9\tabularnewline
2 & 2 & 1.000 & B & 9\tabularnewline
1 & 3 & 1.500 & C & 9\tabularnewline
2 & 4 & 0.5000 & A & 9\tabularnewline
1 & 5 & 1.000 & B & 9\tabularnewline
2 & 6 & 1.500 & C & 9\tabularnewline
1 & 7 & 0.5000 & A & 9\tabularnewline
2 & 8 & 1.000 & B & 9\tabularnewline
1 & 9 & 1.500 & C & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Above example run on grouped dataset, applies function on each group
separately.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:row-count}\NormalTok{ api/row-count)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :row-count\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & 5\tabularnewline
1 & 3 & 1.500 & C & 5\tabularnewline
1 & 5 & 1.000 & B & 5\tabularnewline
1 & 7 & 0.5000 & A & 5\tabularnewline
1 & 9 & 1.500 & C & 5\tabularnewline
2 & 2 & 1.000 & B & 4\tabularnewline
2 & 4 & 0.5000 & A & 4\tabularnewline
2 & 6 & 1.500 & C & 4\tabularnewline
2 & 8 & 1.000 & B & 4\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

When column which is added is longer than row count in dataset, column
is trimmed. When column is shorter, it's cycled or missing values are
appended.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-column DS }\AttributeTok{:V5}\NormalTok{ [}\AttributeTok{:r} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & :r\tabularnewline
2 & 2 & 1.000 & B & :b\tabularnewline
1 & 3 & 1.500 & C & :r\tabularnewline
2 & 4 & 0.5000 & A & :b\tabularnewline
1 & 5 & 1.000 & B & :r\tabularnewline
2 & 6 & 1.500 & C & :b\tabularnewline
1 & 7 & 0.5000 & A & :r\tabularnewline
2 & 8 & 1.000 & B & :b\tabularnewline
1 & 9 & 1.500 & C & :r\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-column DS }\AttributeTok{:V5}\NormalTok{ [}\AttributeTok{:r} \AttributeTok{:b}\NormalTok{] }\AttributeTok{:na}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & :r\tabularnewline
2 & 2 & 1.000 & B & :b\tabularnewline
1 & 3 & 1.500 & C &\tabularnewline
2 & 4 & 0.5000 & A &\tabularnewline
1 & 5 & 1.000 & B &\tabularnewline
2 & 6 & 1.500 & C &\tabularnewline
1 & 7 & 0.5000 & A &\tabularnewline
2 & 8 & 1.000 & B &\tabularnewline
1 & 9 & 1.500 & C &\tabularnewline
\bottomrule
\end{longtable}

Exception is thrown when \texttt{:strict} strategy is used and column
size is not equal row count

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{try}
\NormalTok{  (api/add-or-update-column DS }\AttributeTok{:V5}\NormalTok{ [}\AttributeTok{:r} \AttributeTok{:b}\NormalTok{] }\AttributeTok{:strict}\NormalTok{)}
\NormalTok{  (}\KeywordTok{catch}\NormalTok{ Exception }\KeywordTok{e}\NormalTok{ (}\KeywordTok{str} \StringTok{"Exception caught: "}\NormalTok{(ex-message }\KeywordTok{e}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
"Exception caught: Column size (2) should be exactly the same as dataset row count (9)"
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Tha same applies for grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:V5}\NormalTok{ [}\AttributeTok{:r} \AttributeTok{:b}\NormalTok{] }\AttributeTok{:na}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B & :r\tabularnewline
1 & 5 & 1.000 & B & :b\tabularnewline
2 & 8 & 1.000 & B &\tabularnewline
1 & 1 & 0.5000 & A & :r\tabularnewline
2 & 4 & 0.5000 & A & :b\tabularnewline
1 & 7 & 0.5000 & A &\tabularnewline
1 & 3 & 1.500 & C & :r\tabularnewline
2 & 6 & 1.500 & C & :b\tabularnewline
1 & 9 & 1.500 & C &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's use other column to fill groups

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:V5}\NormalTok{ (DS }\AttributeTok{:V2}\NormalTok{))}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B & 1\tabularnewline
1 & 5 & 1.000 & B & 2\tabularnewline
2 & 8 & 1.000 & B & 3\tabularnewline
1 & 1 & 0.5000 & A & 1\tabularnewline
2 & 4 & 0.5000 & A & 2\tabularnewline
1 & 7 & 0.5000 & A & 3\tabularnewline
1 & 3 & 1.500 & C & 1\tabularnewline
2 & 6 & 1.500 & C & 2\tabularnewline
1 & 9 & 1.500 & C & 3\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

In case you want to add or update several columns you can call
\texttt{add-or-update-columns} and provide map where keys are column
names, vals are columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/add-or-update-columns DS \{}\AttributeTok{:V1}\NormalTok{ #(}\KeywordTok{map} \KeywordTok{inc}\NormalTok{ (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))}
                               \AttributeTok{:V5}\NormalTok{ #(}\KeywordTok{map}\NormalTok{ (}\KeywordTok{comp} \KeywordTok{keyword} \KeywordTok{str}\NormalTok{) (}\VariableTok{%} \AttributeTok{:V4}\NormalTok{))}
                               \AttributeTok{:V6} \DecValTok{11}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :V5 & :V6\tabularnewline
\midrule
\endhead
2 & 1 & 0.5000 & A & :A & 11\tabularnewline
3 & 2 & 1.000 & B & :B & 11\tabularnewline
2 & 3 & 1.500 & C & :C & 11\tabularnewline
3 & 4 & 0.5000 & A & :A & 11\tabularnewline
2 & 5 & 1.000 & B & :B & 11\tabularnewline
3 & 6 & 1.500 & C & :C & 11\tabularnewline
2 & 7 & 0.5000 & A & :A & 11\tabularnewline
3 & 8 & 1.000 & B & :B & 11\tabularnewline
2 & 9 & 1.500 & C & :C & 11\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Update}\label{update}

If you want to modify specific column(s) you can call
\texttt{update-columns}. Arguments:

\begin{itemize}
\tightlist
\item
  dataset
\item
  one of:

  \begin{itemize}
  \tightlist
  \item
    \texttt{columns-selector} and function (or sequence of functions)
  \item
    map where keys are column names and vals are function
  \end{itemize}
\end{itemize}

Functions accept column and have to return column or sequence

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Reverse of columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/update-columns DS }\AttributeTok{:all} \KeywordTok{reverse}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 9 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Apply dec/inc on numerical columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/update-columns DS }\AttributeTok{:type/numerical}\NormalTok{ [(}\KeywordTok{partial} \KeywordTok{map} \KeywordTok{dec}\NormalTok{)}
\NormalTok{                                        (}\KeywordTok{partial} \KeywordTok{map} \KeywordTok{inc}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
0 & 2 & -0.5000 & A\tabularnewline
1 & 3 & 0.000 & B\tabularnewline
0 & 4 & 0.5000 & C\tabularnewline
1 & 5 & -0.5000 & A\tabularnewline
0 & 6 & 0.000 & B\tabularnewline
1 & 7 & 0.5000 & C\tabularnewline
0 & 8 & -0.5000 & A\tabularnewline
1 & 9 & 0.000 & B\tabularnewline
0 & 10 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can also assing function to a column by packing operations into the
map.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/update-columns DS \{}\AttributeTok{:V1} \KeywordTok{reverse}
                        \AttributeTok{:V2}\NormalTok{ (}\KeywordTok{comp}\NormalTok{ shuffle }\KeywordTok{seq}\NormalTok{)\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 6 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 9 & 0.5000 & A\tabularnewline
1 & 7 & 1.000 & B\tabularnewline
2 & 1 & 1.500 & C\tabularnewline
1 & 8 & 0.5000 & A\tabularnewline
2 & 5 & 1.000 & B\tabularnewline
1 & 4 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Map}\label{map}

The other way of creating or updating column is to map rows as regular
\texttt{map} function. The arity of mapping function should be the same
as number of selected columns.

Arguments:

\begin{itemize}
\tightlist
\item
  \texttt{ds} - dataset
\item
  \texttt{column-name} - target column name
\item
  \texttt{columns-selector} - columns selected
\item
  \texttt{map-fn} - mapping function
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's add numerical columns together

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/map-columns DS}
                 \AttributeTok{:sum-of-numbers}
\NormalTok{                 (api/column-names DS  #\{}\AttributeTok{:int64} \AttributeTok{:float64}\NormalTok{\} }\AttributeTok{:datatype}\NormalTok{)}
\NormalTok{                 (}\KeywordTok{fn}\NormalTok{ [& rows]}
\NormalTok{                   (}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ rows)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :sum-of-numbers\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & 2.500\tabularnewline
2 & 2 & 1.000 & B & 5.000\tabularnewline
1 & 3 & 1.500 & C & 5.500\tabularnewline
2 & 4 & 0.5000 & A & 6.500\tabularnewline
1 & 5 & 1.000 & B & 7.000\tabularnewline
2 & 6 & 1.500 & C & 9.500\tabularnewline
1 & 7 & 0.5000 & A & 8.500\tabularnewline
2 & 8 & 1.000 & B & 11.00\tabularnewline
1 & 9 & 1.500 & C & 11.50\tabularnewline
\bottomrule
\end{longtable}

The same works on grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/map-columns }\AttributeTok{:sum-of-numbers}
\NormalTok{                     (api/column-names DS  #\{}\AttributeTok{:int64} \AttributeTok{:float64}\NormalTok{\} }\AttributeTok{:datatype}\NormalTok{)}
\NormalTok{                     (}\KeywordTok{fn}\NormalTok{ [& rows]}
\NormalTok{                       (}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ rows)))}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :sum-of-numbers\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & 2.500\tabularnewline
2 & 4 & 0.5000 & A & 6.500\tabularnewline
1 & 7 & 0.5000 & A & 8.500\tabularnewline
2 & 2 & 1.000 & B & 5.000\tabularnewline
1 & 5 & 1.000 & B & 7.000\tabularnewline
2 & 8 & 1.000 & B & 11.00\tabularnewline
1 & 3 & 1.500 & C & 5.500\tabularnewline
2 & 6 & 1.500 & C & 9.500\tabularnewline
1 & 9 & 1.500 & C & 11.50\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Reorder}\label{reorder}

To reorder columns use columns selectors to choose what columns go
first. The unseleted columns are appended to the end.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/reorder-columns DS }\AttributeTok{:V4}\NormalTok{ [}\AttributeTok{:V3} \AttributeTok{:V2}\NormalTok{] }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V2 & :V3 & :V1\tabularnewline
\midrule
\endhead
A & 1 & 0.5000 & 1\tabularnewline
B & 2 & 1.000 & 2\tabularnewline
C & 3 & 1.500 & 1\tabularnewline
A & 4 & 0.5000 & 2\tabularnewline
B & 5 & 1.000 & 1\tabularnewline
C & 6 & 1.500 & 2\tabularnewline
A & 7 & 0.5000 & 1\tabularnewline
B & 8 & 1.000 & 2\tabularnewline
C & 9 & 1.500 & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

This function doesn't let you select meta field, so you have to call
\texttt{column-names} in such case. Below we want to add integer columns
at the end.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/reorder-columns DS (api/column-names DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:int64}\NormalTok{\}) }\AttributeTok{:datatype}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V3 & :V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
0.5000 & A & 1 & 1\tabularnewline
1.000 & B & 2 & 2\tabularnewline
1.500 & C & 1 & 3\tabularnewline
0.5000 & A & 2 & 4\tabularnewline
1.000 & B & 1 & 5\tabularnewline
1.500 & C & 2 & 6\tabularnewline
0.5000 & A & 1 & 7\tabularnewline
1.000 & B & 2 & 8\tabularnewline
1.500 & C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Type conversion}\label{type-conversion}

To convert column into given datatype can be done using
\texttt{convert-types} function. Not all the types can be converted
automatically also some types require slow parsing (every conversion
from string). In case where conversion is not possible you can pass
conversion function.

Arguments:

\begin{itemize}
\tightlist
\item
  \texttt{ds} - dataset
\item
  Two options:

  \begin{itemize}
  \tightlist
  \item
    \texttt{coltype-map} in case when you want to convert several
    columns, keys are column names, vals are new types
  \item
    \texttt{column-selector} and \texttt{new-types} - column name and
    new datatype (or datatypes as sequence)
  \end{itemize}
\end{itemize}

\texttt{new-types} can be:

\begin{itemize}
\tightlist
\item
  a type like \texttt{:int64} or \texttt{:string} or sequence of types
\item
  or sequence of pair of datetype and conversion function
\end{itemize}

After conversion additional infomation is given on problematic values.

The other conversion is casting column into java array
(\texttt{-\textgreater{}array}) of the type column or provided as
argument. Grouped dataset returns sequence of arrays.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Basic conversion

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/convert-types }\AttributeTok{:V1} \AttributeTok{:float64}\NormalTok{)}
\NormalTok{    (api/info }\AttributeTok{:columns}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed :column info {[}4 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:name & :size & :datatype & :unparsed-indexes & :unparsed-data &
:categorical?\tabularnewline
\midrule
\endhead
:V1 & 9 & :float64 & \{\} & {[}{]} &\tabularnewline
:V2 & 9 & :int64 & & &\tabularnewline
:V3 & 9 & :float64 & & &\tabularnewline
:V4 & 9 & :string & & & true\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Using custom converter. Let's treat \texttt{:V4} as haxadecimal values.
See that this way we can map column to any value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/convert-types }\AttributeTok{:V4}\NormalTok{ [[}\AttributeTok{:int16}\NormalTok{ #(Integer/parseInt }\VariableTok{%} \DecValTok{16}\NormalTok{)]]))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & 10\tabularnewline
2 & 2 & 1.000 & 11\tabularnewline
1 & 3 & 1.500 & 12\tabularnewline
2 & 4 & 0.5000 & 10\tabularnewline
1 & 5 & 1.000 & 11\tabularnewline
2 & 6 & 1.500 & 12\tabularnewline
1 & 7 & 0.5000 & 10\tabularnewline
2 & 8 & 1.000 & 11\tabularnewline
1 & 9 & 1.500 & 12\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can process several columns at once

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/convert-types \{}\AttributeTok{:V1} \AttributeTok{:float64}
                        \AttributeTok{:V2} \AttributeTok{:object}
                        \AttributeTok{:V3}\NormalTok{ [}\AttributeTok{:boolean}\NormalTok{ #(}\KeywordTok{<} \VariableTok{%} \FloatTok{1.0}\NormalTok{)]}
                        \AttributeTok{:V4} \AttributeTok{:object}\NormalTok{\})}
\NormalTok{    (api/info }\AttributeTok{:columns}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed :column info {[}4 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:name & :size & :datatype & :unparsed-indexes &
:unparsed-data\tabularnewline
\midrule
\endhead
:V1 & 9 & :float64 & \{\} & {[}{]}\tabularnewline
:V2 & 9 & :object & \{\} & {[}{]}\tabularnewline
:V3 & 9 & :boolean & \{\} & {[}{]}\tabularnewline
:V4 & 9 & :object & &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Convert one type into another

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/convert-types }\AttributeTok{:type/numerical} \AttributeTok{:int16}\NormalTok{)}
\NormalTok{    (api/info }\AttributeTok{:columns}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed :column info {[}4 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:name & :size & :datatype & :unparsed-indexes & :unparsed-data &
:categorical?\tabularnewline
\midrule
\endhead
:V1 & 9 & :int16 & \{\} & {[}{]} &\tabularnewline
:V2 & 9 & :int16 & \{\} & {[}{]} &\tabularnewline
:V3 & 9 & :int16 & \{\} & {[}{]} &\tabularnewline
:V4 & 9 & :string & & & true\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Function works on the grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/convert-types }\AttributeTok{:V1} \AttributeTok{:float32}\NormalTok{)}
\NormalTok{    (api/ungroup)}
\NormalTok{    (api/info }\AttributeTok{:columns}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed :column info {[}4 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:name & :size & :datatype & :unparsed-indexes & :unparsed-data &
:categorical?\tabularnewline
\midrule
\endhead
:V1 & 9 & :float32 & \{\} & {[}{]} &\tabularnewline
:V2 & 9 & :int64 & & &\tabularnewline
:V3 & 9 & :float64 & & &\tabularnewline
:V4 & 9 & :string & & & true\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Double array conversion.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/->array DS }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#object["[J" 0x42a554b9 "[J@42a554b9"]
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Function also works on grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/->array }\AttributeTok{:V2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(#object["[J" 0x2d315f58 "[J@2d315f58"] #object["[J" 0x3f865ecd "[J@3f865ecd"] #object["[J" 0x1eae8016 "[J@1eae8016"])
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can also cast the type to the other one (if casting is possible):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/->array DS }\AttributeTok{:V4} \AttributeTok{:string}\NormalTok{)}
\NormalTok{(api/->array DS }\AttributeTok{:V1} \AttributeTok{:float32}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#object["[Ljava.lang.String;" 0x66d413a3 "[Ljava.lang.String;@66d413a3"]
#object["[F" 0x7dd09b25 "[F@7dd09b25"]
\end{verbatim}

\subsubsection{Rows}\label{rows}

Rows can be selected or dropped using various selectors:

\begin{itemize}
\tightlist
\item
  row id(s) - row index as number or seqence of numbers (first row has
  index \texttt{0}, second \texttt{1} and so on)
\item
  sequence of true/false values
\item
  filter by predicate (argument is row as a map)
\end{itemize}

When predicate is used you may want to limit columns passed to the
function (\texttt{select-keys} option).

Additionally you may want to precalculate some values which will be
visible for predicate as additional columns. It's done internally by
calling \texttt{add-or-update-columns} on a dataset. \texttt{:pre} is
used as a column definitions.

\paragraph{Select}\label{select-1}

Select fourth row

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS }\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select 3 rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS [}\DecValTok{1} \DecValTok{4} \DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select rows using sequence of true/false values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS [}\VariableTok{true} \VariableTok{nil} \VariableTok{nil} \VariableTok{true}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select rows using predicate

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<} \VariableTok{%} \DecValTok{1}\NormalTok{) }\AttributeTok{:V3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The same works on grouped dataset, let's select first row from every
group.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/select-rows }\DecValTok{0}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If you want to select \texttt{:V2} values which are lower than or equal
mean in grouped dataset you have to precalculate it using \texttt{:pre}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/select-rows (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{<=}\NormalTok{ (}\AttributeTok{:V2}\NormalTok{ row) (}\AttributeTok{:mean}\NormalTok{ row)))}
\NormalTok{                     \{}\AttributeTok{:pre}\NormalTok{ \{}\AttributeTok{:mean}\NormalTok{ #(tech.v2.datatype.functional/mean (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))\}\})}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Drop}\label{drop-1}

\texttt{drop-rows} removes rows, and accepts exactly the same parameters
as \texttt{select-rows}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Drop values lower than or equal \texttt{:V2} column mean in grouped
dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/drop-rows (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{<=}\NormalTok{ (}\AttributeTok{:V2}\NormalTok{ row) (}\AttributeTok{:mean}\NormalTok{ row)))}
\NormalTok{                   \{}\AttributeTok{:pre}\NormalTok{ \{}\AttributeTok{:mean}\NormalTok{ #(tech.v2.datatype.functional/mean (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))\}\})}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Other}\label{other}

There are several function to select first, last, random rows, or
display head, tail of the dataset. All functions work on grouped
dataset.

All random functions accept \texttt{:seed} as an option if you want to
fix returned result.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

First row

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/first DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Last row

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/last DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Random row (single)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/rand-nth DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Random row (single) with seed

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/rand-nth DS \{}\AttributeTok{:seed} \DecValTok{42}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Random \texttt{n} (default: row count) rows with repetition.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/random DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 9 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Five random rows with repetition

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/random DS }\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Five random, non-repeating rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/random DS }\DecValTok{5}\NormalTok{ \{}\AttributeTok{:repeat}\NormalTok{? }\VariableTok{false}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Five random, with seed

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/random DS }\DecValTok{5}\NormalTok{ \{}\AttributeTok{:seed} \DecValTok{42}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Shuffle dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/shuffle DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 7 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Shuffle with seed

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/shuffle DS \{}\AttributeTok{:seed} \DecValTok{42}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 5 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

First \texttt{n} rows (default 5)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/head DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Last \texttt{n} rows (default 5)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/tail DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\texttt{by-rank} calculates rank on column(s). It's base on
\href{https://www.rdocumentation.org/packages/base/versions/3.6.1/topics/rank}{R
rank()} with addition of \texttt{:dense} (default) tie strategy which
give consecutive rank numbering.

\texttt{:desc?} options (default: \texttt{true}) sorts input with
descending order, giving top values under \texttt{0} value.

\texttt{rank} is zero based and is defined at
\texttt{techtest.api.utils} namespace.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/by-rank DS }\AttributeTok{:V3} \KeywordTok{zero?}\NormalTok{) }\CommentTok{;; most V3 values}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/by-rank DS }\AttributeTok{:V3} \KeywordTok{zero?}\NormalTok{ \{}\AttributeTok{:desc}\NormalTok{? }\VariableTok{false}\NormalTok{\}) }\CommentTok{;; least V3 values}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Rank also works on multiple columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/by-rank DS [}\AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{] }\KeywordTok{zero?}\NormalTok{ \{}\AttributeTok{:desc}\NormalTok{? }\VariableTok{false}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select 5 random rows from each group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/random }\DecValTok{5}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}15 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Aggregate}\label{aggregate}

Aggregating is a function which produces single row out of dataset.

Aggregator is a function or sequence or map of functions which accept
dataset as an argument and result single value, sequence of values or
map.

Where map is given as an input or result, keys are treated as column
names.

Grouped dataset is ungrouped after aggreation. This can be turned off by
setting \texttt{:ungroup} to false. In case you want to pass additional
ungrouping parameters add them to the options.

By default resulting column names are prefixed with \texttt{summary}
prefix (set it with \texttt{:default-column-name-prefix} option).

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's calculate mean of some columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS #(}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:summary\tabularnewline
\midrule
\endhead
45\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's give resulting column a name.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS \{}\AttributeTok{:sum-of-V2}\NormalTok{ #(}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:sum-of-V2\tabularnewline
\midrule
\endhead
45\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sequential result is spread into separate columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS #(}\KeywordTok{take} \DecValTok{5}\NormalTok{(}\VariableTok{%} \AttributeTok{:V2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:summary-0 & :summary-1 & :summary-2 & :summary-3 &
:summary-4\tabularnewline
\midrule
\endhead
1 & 2 & 3 & 4 & 5\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can combine all variants and rename default prefix

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS [#(}\KeywordTok{take} \DecValTok{3}\NormalTok{ (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))}
\NormalTok{                   (}\KeywordTok{fn}\NormalTok{ [ds] \{}\AttributeTok{:sum-v1}\NormalTok{ (}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ (ds }\AttributeTok{:V1}\NormalTok{))}
                            \AttributeTok{:prod-v3}\NormalTok{ (}\KeywordTok{reduce} \KeywordTok{*}\NormalTok{ (ds }\AttributeTok{:V3}\NormalTok{))\})] \{}\AttributeTok{:default-column-name-prefix} \StringTok{"V2-value"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
:V2-value-0-0\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
:V2-value-0-1\strut
\end{minipage} & \begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
:V2-value-0-2\strut
\end{minipage} & \begin{minipage}[b]{0.20\columnwidth}\raggedright\strut
:V2-value-1-sum-v1\strut
\end{minipage} & \begin{minipage}[b]{0.21\columnwidth}\raggedright\strut
:V2-value-1-prod-v3\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
1\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
2\strut
\end{minipage} & \begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
3\strut
\end{minipage} & \begin{minipage}[t]{0.20\columnwidth}\raggedright\strut
13\strut
\end{minipage} & \begin{minipage}[t]{0.21\columnwidth}\raggedright\strut
0.4219\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Processing grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate [#(}\KeywordTok{take} \DecValTok{3}\NormalTok{ (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))}
\NormalTok{                    (}\KeywordTok{fn}\NormalTok{ [ds] \{}\AttributeTok{:sum-v1}\NormalTok{ (}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ (ds }\AttributeTok{:V1}\NormalTok{))}
                             \AttributeTok{:prod-v3}\NormalTok{ (}\KeywordTok{reduce} \KeywordTok{*}\NormalTok{ (ds }\AttributeTok{:V3}\NormalTok{))\})] \{}\AttributeTok{:default-column-name-prefix} \StringTok{"V2-value"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
\begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
:V4\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\raggedright\strut
:V2-value-0-0\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\raggedright\strut
:V2-value-0-1\strut
\end{minipage} & \begin{minipage}[b]{0.14\columnwidth}\raggedright\strut
:V2-value-0-2\strut
\end{minipage} & \begin{minipage}[b]{0.18\columnwidth}\raggedright\strut
:V2-value-1-sum-v1\strut
\end{minipage} & \begin{minipage}[b]{0.19\columnwidth}\raggedright\strut
:V2-value-1-prod-v3\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
B\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
2\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
5\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
8\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
5\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
1.000\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
C\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
3\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
6\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
4\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
3.375\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
A\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
1\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
4\strut
\end{minipage} & \begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
7\strut
\end{minipage} & \begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
4\strut
\end{minipage} & \begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
0.1250\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Result of aggregating is automatically ungrouped, you can skip this step
by stetting \texttt{:ungroup} option to \texttt{false}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V3}\NormalTok{])}
\NormalTok{    (api/aggregate [#(}\KeywordTok{take} \DecValTok{3}\NormalTok{ (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))}
\NormalTok{                    (}\KeywordTok{fn}\NormalTok{ [ds] \{}\AttributeTok{:sum-v1}\NormalTok{ (}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ (ds }\AttributeTok{:V1}\NormalTok{))}
                             \AttributeTok{:prod-v3}\NormalTok{ (}\KeywordTok{reduce} \KeywordTok{*}\NormalTok{ (ds }\AttributeTok{:V3}\NormalTok{))\})] \{}\AttributeTok{:default-column-name-prefix} \StringTok{"V2-value"}
                                                              \AttributeTok{:ungroup}\NormalTok{? }\VariableTok{false}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:name & :group-id & :data\tabularnewline
\midrule
\endhead
\{:V3 1.0\} & 0 & \_unnamed {[}1 5{]}:\tabularnewline
\{:V3 0.5\} & 1 & \_unnamed {[}1 5{]}:\tabularnewline
\{:V3 1.5\} & 2 & \_unnamed {[}1 5{]}:\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Column}\label{column}

You can perform columnar aggreagation also. \texttt{aggregate-columns}
selects columns and apply aggregating function (or sequence of
functions) for each column separately.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate-columns DS [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] #(}\KeywordTok{reduce} \KeywordTok{+} \VariableTok{%}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
13 & 45 & 9.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate-columns DS [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] [#(}\KeywordTok{reduce} \KeywordTok{+} \VariableTok{%}\NormalTok{)}
\NormalTok{                                         #(}\KeywordTok{reduce} \KeywordTok{max} \VariableTok{%}\NormalTok{)}
\NormalTok{                                         #(}\KeywordTok{reduce} \KeywordTok{*} \VariableTok{%}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
13 & 9 & 0.4219\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] #(}\KeywordTok{reduce} \KeywordTok{+} \VariableTok{%}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
B & 5 & 15 & 3.000\tabularnewline
C & 4 & 18 & 4.500\tabularnewline
A & 4 & 12 & 1.500\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Order}\label{order}

Ordering can be done by column(s) or any function operating on row.
Possible order can be:

\begin{itemize}
\tightlist
\item
  \texttt{:asc} for ascending order (default)
\item
  \texttt{:desc} for descending order
\item
  custom comparator
\end{itemize}

\texttt{:select-keys} limits row map provided to ordering functions.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Order by single column, ascending

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Descending order

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS }\AttributeTok{:V1} \AttributeTok{:desc}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Order by two columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Use different orders for columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] [}\AttributeTok{:asc} \AttributeTok{:desc}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 9 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] [}\AttributeTok{:desc} \AttributeTok{:desc}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{] [}\AttributeTok{:desc} \AttributeTok{:asc}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Custom function can be used to provied ordering key. Here order by
\texttt{:V4} descending, then by product of other columns ascending.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V4}\NormalTok{ (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{*}\NormalTok{ (}\AttributeTok{:V1}\NormalTok{ row)}
\NormalTok{                                  (}\AttributeTok{:V2}\NormalTok{ row)}
\NormalTok{                                  (}\AttributeTok{:V3}\NormalTok{ row)))] [}\AttributeTok{:desc} \AttributeTok{:asc}\NormalTok{] \{}\AttributeTok{:select-keys}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Custom comparator also can be used in case objects are not comparable by
default. Let's define artificial one: if Euclidean distance is lower
than 2, compare along \texttt{z} else along \texttt{x} and \texttt{y}.
We use first three columns for that.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{defn}\FunctionTok{ dist}
\NormalTok{  [v1 v2]}
\NormalTok{  (}\KeywordTok{->>}\NormalTok{ v2}
\NormalTok{       (}\KeywordTok{map} \KeywordTok{-}\NormalTok{ v1)}
\NormalTok{       (}\KeywordTok{map}\NormalTok{ #(}\KeywordTok{*} \VariableTok{%} \VariableTok{%}\NormalTok{))}
\NormalTok{       (}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{)}
\NormalTok{       (Math/sqrt)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#'user/dist
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] (}\KeywordTok{fn}\NormalTok{ [[x1 y1 z1 }\AttributeTok{:as}\NormalTok{ v1] [x2 y2 z2 }\AttributeTok{:as}\NormalTok{ v2]]}
\NormalTok{                                 (}\KeywordTok{let}\NormalTok{ [d (dist v1 v2)]}
\NormalTok{                                   (}\KeywordTok{if}\NormalTok{ (}\KeywordTok{<}\NormalTok{ d }\FloatTok{2.0}\NormalTok{)}
\NormalTok{                                     (}\KeywordTok{compare}\NormalTok{ z1 z2)}
\NormalTok{                                     (}\KeywordTok{compare}\NormalTok{ [x1 y1] [x2 y2])))))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Unique}\label{unique}

Remove rows which contains the same data. By default \texttt{unique-by}
removes duplicates from whole dataset. You can also pass list of columns
or functions (similar as in \texttt{group-by}) to remove duplicates
limited by them. Default strategy is to keep the first row. More
strategies below.

\texttt{unique-by} works on groups

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Remove duplicates from whole dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Remove duplicates from each group selected by column.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Pair of columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS [}\AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Also function can be used, split dataset by modulo 3 on columns
\texttt{:V2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS (}\KeywordTok{fn}\NormalTok{ [m] (}\KeywordTok{mod}\NormalTok{ (}\AttributeTok{:V2}\NormalTok{ m) }\DecValTok{3}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The same can be achived with \texttt{group-by}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [m] (}\KeywordTok{mod}\NormalTok{ (}\AttributeTok{:V2}\NormalTok{ m) }\DecValTok{3}\NormalTok{)))}
\NormalTok{    (api/first)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/unique-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Strategies}\label{strategies}

There are 4 strategies defined:

\begin{itemize}
\tightlist
\item
  \texttt{:first} - select first row (default)
\item
  \texttt{:last} - select last row
\item
  \texttt{:random} - select random row
\item
  any function - apply function to a columns which are subject of
  uniqueness
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Last

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS }\AttributeTok{:V1}\NormalTok{ \{}\AttributeTok{:strategy} \AttributeTok{:last}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Random

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS }\AttributeTok{:V1}\NormalTok{ \{}\AttributeTok{:strategy} \AttributeTok{:random}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Pack columns into vector

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS }\AttributeTok{:V4}\NormalTok{ \{}\AttributeTok{:strategy} \KeywordTok{vec}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
{[}2 1 2{]} & {[}2 5 8{]} & {[}1.0 1.0 1.0{]}\tabularnewline
{[}1 2 1{]} & {[}3 6 9{]} & {[}1.5 1.5 1.5{]}\tabularnewline
{[}1 2 1{]} & {[}1 4 7{]} & {[}0.5 0.5 0.5{]}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sum columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS }\AttributeTok{:V4}\NormalTok{ \{}\AttributeTok{:strategy}\NormalTok{ (}\KeywordTok{partial} \KeywordTok{reduce} \KeywordTok{+}\NormalTok{)\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
5 & 15 & 3.000\tabularnewline
4 & 18 & 4.500\tabularnewline
4 & 12 & 1.500\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Group by function and apply functions

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS (}\KeywordTok{fn}\NormalTok{ [m] (}\KeywordTok{mod}\NormalTok{ (}\AttributeTok{:V2}\NormalTok{ m) }\DecValTok{3}\NormalTok{)) \{}\AttributeTok{:strategy} \KeywordTok{vec}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
{[}1 2 1{]} & {[}3 6 9{]} & {[}1.5 1.5 1.5{]} & {[}``C'' ``C''
``C''{]}\tabularnewline
{[}1 2 1{]} & {[}1 4 7{]} & {[}0.5 0.5 0.5{]} & {[}``A'' ``A''
``A''{]}\tabularnewline
{[}2 1 2{]} & {[}2 5 8{]} & {[}1.0 1.0 1.0{]} & {[}``B'' ``B''
``B''{]}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/unique-by (}\KeywordTok{fn}\NormalTok{ [m] (}\KeywordTok{mod}\NormalTok{ (}\AttributeTok{:V2}\NormalTok{ m) }\DecValTok{3}\NormalTok{)) \{}\AttributeTok{:strategy} \KeywordTok{vec}\NormalTok{\})}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-as-column} \AttributeTok{:from-V1}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:from-V1 & :V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & {[}1 1{]} & {[}3 9{]} & {[}1.5 1.5{]} & {[}``C''
``C''{]}\tabularnewline
1 & {[}1 1{]} & {[}1 7{]} & {[}0.5 0.5{]} & {[}``A''
``A''{]}\tabularnewline
1 & {[}1{]} & {[}5{]} & {[}1.0{]} & {[}``B''{]}\tabularnewline
2 & {[}2{]} & {[}6{]} & {[}1.5{]} & {[}``C''{]}\tabularnewline
2 & {[}2{]} & {[}4{]} & {[}0.5{]} & {[}``A''{]}\tabularnewline
2 & {[}2 2{]} & {[}2 8{]} & {[}1.0 1.0{]} & {[}``B''
``B''{]}\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Missing}\label{missing}

When dataset contains missing values you can select or drop rows with
missing values or replace them using some strategy.

\texttt{column-selector} can be used to limit considered columns

Let's define dataset which contains missing values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DSm }\NormalTok{(api/dataset \{}\AttributeTok{:V1}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \VariableTok{nil}\NormalTok{]))}
                       \AttributeTok{:V2}\NormalTok{ (}\KeywordTok{range} \DecValTok{1} \DecValTok{10}\NormalTok{)}
                       \AttributeTok{:V3}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\FloatTok{0.5} \FloatTok{1.0} \VariableTok{nil} \FloatTok{1.5}\NormalTok{]))}
                       \AttributeTok{:V4}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\StringTok{"A"} \StringTok{"B"} \StringTok{"C"}\NormalTok{]))\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DSm}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
& 3 & & C\tabularnewline
1 & 4 & 1.500 & A\tabularnewline
2 & 5 & 0.5000 & B\tabularnewline
& 6 & 1.000 & C\tabularnewline
1 & 7 & & A\tabularnewline
2 & 8 & 1.500 & B\tabularnewline
& 9 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Select}\label{select-2}

Select rows with missing values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-missing DSm)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
& 3 & & C\tabularnewline
& 6 & 1.000 & C\tabularnewline
1 & 7 & & A\tabularnewline
& 9 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select rows with missing values in \texttt{:V1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-missing DSm }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
& 3 & & C\tabularnewline
& 6 & 1.000 & C\tabularnewline
& 9 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The same with grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DSm}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/select-missing }\AttributeTok{:V3}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 7 & & A\tabularnewline
& 3 & & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Drop}\label{drop-2}

Drop rows with missing values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-missing DSm)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 4 & 1.500 & A\tabularnewline
2 & 5 & 0.5000 & B\tabularnewline
2 & 8 & 1.500 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Drop rows with missing values in \texttt{:V1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-missing DSm }\AttributeTok{:V1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 4 & 1.500 & A\tabularnewline
2 & 5 & 0.5000 & B\tabularnewline
1 & 7 & & A\tabularnewline
2 & 8 & 1.500 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The same with grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DSm}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/drop-missing }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 4 & 1.500 & A\tabularnewline
1 & 7 & & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 5 & 0.5000 & B\tabularnewline
2 & 8 & 1.500 & B\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Replace}\label{replace}

Missing values can be replaced using several strategies.
\texttt{replace-missing} accepts:

\begin{itemize}
\tightlist
\item
  dataset
\item
  column selector
\item
  value

  \begin{itemize}
  \tightlist
  \item
    single value
  \item
    sequence of values (cycled)
  \item
    function, applied on column(s) with stripped missings
  \end{itemize}
\item
  strategy (optional)
\end{itemize}

Strategies are:

\begin{itemize}
\tightlist
\item
  \texttt{:value} - replace with given value (default)
\item
  \texttt{:up} - copy values up
\item
  \texttt{:down} - copy values down
\end{itemize}

Let's define special dataset here:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DSm2 }\NormalTok{(api/dataset \{}\AttributeTok{:a}\NormalTok{ [}\VariableTok{nil} \VariableTok{nil} \VariableTok{nil} \FloatTok{1.0} \DecValTok{2}   \VariableTok{nil} \DecValTok{4}   \VariableTok{nil}  \DecValTok{11} \VariableTok{nil} \VariableTok{nil}\NormalTok{]}
                        \AttributeTok{:b}\NormalTok{ [}\FloatTok{2.0}   \DecValTok{2}   \DecValTok{2} \VariableTok{nil} \VariableTok{nil} \DecValTok{3}   \VariableTok{nil}   \DecValTok{3}  \DecValTok{4}  \DecValTok{5} \DecValTok{5}\NormalTok{]\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DSm2}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
& 2.000\tabularnewline
& 2.000\tabularnewline
& 2.000\tabularnewline
1.000 &\tabularnewline
2.000 &\tabularnewline
& 3.000\tabularnewline
4.000 &\tabularnewline
& 3.000\tabularnewline
11.00 & 4.000\tabularnewline
& 5.000\tabularnewline
& 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Replace missing with single value in whole dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 }\DecValTok{999}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
999.0 & 2.000\tabularnewline
999.0 & 2.000\tabularnewline
999.0 & 2.000\tabularnewline
1.000 & 999.0\tabularnewline
2.000 & 999.0\tabularnewline
999.0 & 3.000\tabularnewline
4.000 & 999.0\tabularnewline
999.0 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
999.0 & 5.000\tabularnewline
999.0 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Replace missing with single value in \texttt{:a} column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 }\AttributeTok{:a} \DecValTok{999}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
999.0 & 2.000\tabularnewline
999.0 & 2.000\tabularnewline
999.0 & 2.000\tabularnewline
1.000 &\tabularnewline
2.000 &\tabularnewline
999.0 & 3.000\tabularnewline
4.000 &\tabularnewline
999.0 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
999.0 & 5.000\tabularnewline
999.0 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Replace missing with sequence in \texttt{:a} column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 }\AttributeTok{:a}\NormalTok{ [-}\DecValTok{999} \DecValTok{-998} \DecValTok{-997}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
-999.0 & 2.000\tabularnewline
-998.0 & 2.000\tabularnewline
-997.0 & 2.000\tabularnewline
1.000 &\tabularnewline
2.000 &\tabularnewline
-999.0 & 3.000\tabularnewline
4.000 &\tabularnewline
-998.0 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
-997.0 & 5.000\tabularnewline
-999.0 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Replace missing with a function (mean)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 }\AttributeTok{:a}\NormalTok{ tech.v2.datatype.functional/mean)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
4.500 & 2.000\tabularnewline
4.500 & 2.000\tabularnewline
4.500 & 2.000\tabularnewline
1.000 &\tabularnewline
2.000 &\tabularnewline
4.500 & 3.000\tabularnewline
4.000 &\tabularnewline
4.500 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
4.500 & 5.000\tabularnewline
4.500 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Using \texttt{:down} strategy, fills gaps with values from above. You
can see that if missings are at the beginning, they are left missing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{] }\VariableTok{nil} \AttributeTok{:down}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
& 2.000\tabularnewline
& 2.000\tabularnewline
& 2.000\tabularnewline
1.000 & 2.000\tabularnewline
2.000 & 2.000\tabularnewline
2.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
11.00 & 5.000\tabularnewline
11.00 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

To fix above issue you can provide value

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{] }\DecValTok{999} \AttributeTok{:down}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
999.0 & 2.000\tabularnewline
999.0 & 2.000\tabularnewline
999.0 & 2.000\tabularnewline
1.000 & 2.000\tabularnewline
2.000 & 2.000\tabularnewline
2.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
11.00 & 5.000\tabularnewline
11.00 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The same applies for \texttt{:up} strategy which is opposite direction.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{] }\DecValTok{999} \AttributeTok{:up}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
1.000 & 2.000\tabularnewline
1.000 & 2.000\tabularnewline
1.000 & 2.000\tabularnewline
1.000 & 3.000\tabularnewline
2.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
11.00 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
999.0 & 5.000\tabularnewline
999.0 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

We can use a function which is applied after applying \texttt{:up} or
\texttt{:down}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/replace-missing DSm2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{] tech.v2.datatype.functional/mean }\AttributeTok{:down}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}11 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:a & :b\tabularnewline
\midrule
\endhead
4.500 & 2.000\tabularnewline
4.500 & 2.000\tabularnewline
4.500 & 2.000\tabularnewline
1.000 & 2.000\tabularnewline
2.000 & 2.000\tabularnewline
2.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
4.000 & 3.000\tabularnewline
11.00 & 4.000\tabularnewline
11.00 & 5.000\tabularnewline
11.00 & 5.000\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Join/Separate Columns}\label{joinseparate-columns}

Joining or separating columns are operations which can help to tidy
messy dataset.

\begin{itemize}
\tightlist
\item
  \texttt{join-columns} joins content of the columns (as string
  concatenation or other structure) and stores it in new column
\item
  \texttt{separate-column} splits content of the columns into set of new
  columns
\end{itemize}

\paragraph{Join}\label{join}

\texttt{join-columns} accepts:

\begin{itemize}
\tightlist
\item
  dataset
\item
  column selector (as in \texttt{select-columns})
\item
  options

  \begin{itemize}
  \tightlist
  \item
    \texttt{:separator} (default \texttt{"-"})
  \item
    \texttt{:drop-columns?} - whether to drop source columns or not
    (default \texttt{true})
  \item
    \texttt{:result-type}

    \begin{itemize}
    \tightlist
    \item
      \texttt{:map} - packs data into map
    \item
      \texttt{:seq} - packs data into sequence
    \item
      \texttt{:string} - join strings with separator (default)
    \item
      or custom function which gets row as a vector
    \end{itemize}
  \item
    \texttt{:missing-subst} - substitution for missing value
  \end{itemize}
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Default usage. Create \texttt{:joined} column out of other columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & 1-1-A\tabularnewline
1.000 & 2-2-B\tabularnewline
& 3-C\tabularnewline
1.500 & 1-4-A\tabularnewline
0.5000 & 2-5-B\tabularnewline
1.000 & 6-C\tabularnewline
& 1-7-A\tabularnewline
1.500 & 2-8-B\tabularnewline
0.5000 & 9-C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Without dropping source columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:drop-columns}\NormalTok{? }\VariableTok{false}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :joined\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A & 1-1-A\tabularnewline
2 & 2 & 1.000 & B & 2-2-B\tabularnewline
& 3 & & C & 3-C\tabularnewline
1 & 4 & 1.500 & A & 1-4-A\tabularnewline
2 & 5 & 0.5000 & B & 2-5-B\tabularnewline
& 6 & 1.000 & C & 6-C\tabularnewline
1 & 7 & & A & 1-7-A\tabularnewline
2 & 8 & 1.500 & B & 2-8-B\tabularnewline
& 9 & 0.5000 & C & 9-C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Let's replace missing value with ``NA'' string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:missing-subst} \StringTok{"NA"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & 1-1-A\tabularnewline
1.000 & 2-2-B\tabularnewline
& NA-3-C\tabularnewline
1.500 & 1-4-A\tabularnewline
0.5000 & 2-5-B\tabularnewline
1.000 & NA-6-C\tabularnewline
& 1-7-A\tabularnewline
1.500 & 2-8-B\tabularnewline
0.5000 & NA-9-C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

We can use custom separator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:separator} \StringTok{"/"}
                                             \AttributeTok{:missing-subst} \StringTok{"."}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & 1/1/A\tabularnewline
1.000 & 2/2/B\tabularnewline
& ./3/C\tabularnewline
1.500 & 1/4/A\tabularnewline
0.5000 & 2/5/B\tabularnewline
1.000 & ./6/C\tabularnewline
& 1/7/A\tabularnewline
1.500 & 2/8/B\tabularnewline
0.5000 & ./9/C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Or even sequence of separators.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:separator}\NormalTok{ [}\StringTok{"-"} \StringTok{"/"}\NormalTok{]}
                                             \AttributeTok{:missing-subst} \StringTok{"."}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & 1-1/A\tabularnewline
1.000 & 2-2/B\tabularnewline
& .-3/C\tabularnewline
1.500 & 1-4/A\tabularnewline
0.5000 & 2-5/B\tabularnewline
1.000 & .-6/C\tabularnewline
& 1-7/A\tabularnewline
1.500 & 2-8/B\tabularnewline
0.5000 & .-9/C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

The other types of results, map:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:result-type} \AttributeTok{:map}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & \{:V1 1, :V2 1, :V4 ``A''\}\tabularnewline
1.000 & \{:V1 2, :V2 2, :V4 ``B''\}\tabularnewline
& \{:V1 nil, :V2 3, :V4 ``C''\}\tabularnewline
1.500 & \{:V1 1, :V2 4, :V4 ``A''\}\tabularnewline
0.5000 & \{:V1 2, :V2 5, :V4 ``B''\}\tabularnewline
1.000 & \{:V1 nil, :V2 6, :V4 ``C''\}\tabularnewline
& \{:V1 1, :V2 7, :V4 ``A''\}\tabularnewline
1.500 & \{:V1 2, :V2 8, :V4 ``B''\}\tabularnewline
0.5000 & \{:V1 nil, :V2 9, :V4 ``C''\}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sequence

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:result-type} \AttributeTok{:seq}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & (1 1 ``A'')\tabularnewline
1.000 & (2 2 ``B'')\tabularnewline
& (nil 3 ``C'')\tabularnewline
1.500 & (1 4 ``A'')\tabularnewline
0.5000 & (2 5 ``B'')\tabularnewline
1.000 & (nil 6 ``C'')\tabularnewline
& (1 7 ``A'')\tabularnewline
1.500 & (2 8 ``B'')\tabularnewline
0.5000 & (nil 9 ``C'')\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Custom function, calculate hash

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns DSm }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:result-type} \KeywordTok{hash}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & 535226087\tabularnewline
1.000 & 1128801549\tabularnewline
& -1842240303\tabularnewline
1.500 & 2022347171\tabularnewline
0.5000 & 1884312041\tabularnewline
1.000 & -1555412370\tabularnewline
& 1640237355\tabularnewline
1.500 & -967279152\tabularnewline
0.5000 & 1128367958\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DSm}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/join-columns }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V3 & :joined\tabularnewline
\midrule
\endhead
0.5000 & 1-1-A\tabularnewline
1.500 & 1-4-A\tabularnewline
& 1-7-A\tabularnewline
1.000 & 2-2-B\tabularnewline
0.5000 & 2-5-B\tabularnewline
1.500 & 2-8-B\tabularnewline
& 3-C\tabularnewline
1.000 & 6-C\tabularnewline
0.5000 & 9-C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\subparagraph{Tidyr examples}\label{tidyr-examples}

\href{https://tidyr.tidyverse.org/reference/unite.html}{source}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ df }\NormalTok{(api/dataset \{}\AttributeTok{:x}\NormalTok{ [}\StringTok{"a"} \StringTok{"a"} \VariableTok{nil} \VariableTok{nil}\NormalTok{]}
                      \AttributeTok{:y}\NormalTok{ [}\StringTok{"b"} \VariableTok{nil} \StringTok{"b"} \VariableTok{nil}\NormalTok{]\}))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#'user/df
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:x & :y\tabularnewline
\midrule
\endhead
a & b\tabularnewline
a &\tabularnewline
& b\tabularnewline
&\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns df }\StringTok{"z"}\NormalTok{ [}\AttributeTok{:x} \AttributeTok{:y}\NormalTok{] \{}\AttributeTok{:drop-columns}\NormalTok{? }\VariableTok{false}
                                  \AttributeTok{:missing-subst} \StringTok{"NA"}
                                  \AttributeTok{:separator} \StringTok{"_"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:x & :y & z\tabularnewline
\midrule
\endhead
a & b & a\_b\tabularnewline
a & & a\_NA\tabularnewline
& b & NA\_b\tabularnewline
& & NA\_NA\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/join-columns df }\StringTok{"z"}\NormalTok{ [}\AttributeTok{:x} \AttributeTok{:y}\NormalTok{] \{}\AttributeTok{:drop-columns}\NormalTok{? }\VariableTok{false}
                                  \AttributeTok{:separator} \StringTok{"_"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:x & :y & z\tabularnewline
\midrule
\endhead
a & b & a\_b\tabularnewline
a & & a\tabularnewline
& b & b\tabularnewline
& &\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Separate}\label{separate}

Column can be also separated into several other columns using string as
separator, regex or custom function. Arguments:

\begin{itemize}
\tightlist
\item
  dataset
\item
  source column
\item
  target columns
\item
  separator as:

  \begin{itemize}
  \tightlist
  \item
    string - it's converted to regular expression and passed to
    \texttt{clojure.string/split} function
  \item
    regex
  \item
    or custom function (default: identity)
  \end{itemize}
\item
  options

  \begin{itemize}
  \tightlist
  \item
    \texttt{:drop-columns?} - whether drop source column or not
    (default: \texttt{true})
  \item
    \texttt{:missing-subst} - values which should be treated as missing,
    can be set, sequence, value or function (default: \texttt{""})
  \end{itemize}
\end{itemize}

Custom function (as separator) should return seqence of values for given
value.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Separate float into integer and factional values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column DS }\AttributeTok{:V3}\NormalTok{ [}\AttributeTok{:int-part} \AttributeTok{:frac-part}\NormalTok{] (}\KeywordTok{fn}\NormalTok{ [^}\KeywordTok{double}\NormalTok{ v]}
\NormalTok{                                                     [(}\KeywordTok{int}\NormalTok{ (}\KeywordTok{quot}\NormalTok{ v }\FloatTok{1.0}\NormalTok{))}
\NormalTok{                                                      (}\KeywordTok{mod}\NormalTok{ v }\FloatTok{1.0}\NormalTok{)]))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :int-part & :frac-part & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0 & 0.5000 & A\tabularnewline
2 & 2 & 1 & 0.000 & B\tabularnewline
1 & 3 & 1 & 0.5000 & C\tabularnewline
2 & 4 & 0 & 0.5000 & A\tabularnewline
1 & 5 & 1 & 0.000 & B\tabularnewline
2 & 6 & 1 & 0.5000 & C\tabularnewline
1 & 7 & 0 & 0.5000 & A\tabularnewline
2 & 8 & 1 & 0.000 & B\tabularnewline
1 & 9 & 1 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Source column can be kept

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column DS }\AttributeTok{:V3}\NormalTok{ [}\AttributeTok{:int-part} \AttributeTok{:frac-part}\NormalTok{] (}\KeywordTok{fn}\NormalTok{ [^}\KeywordTok{double}\NormalTok{ v]}
\NormalTok{                                                     [(}\KeywordTok{int}\NormalTok{ (}\KeywordTok{quot}\NormalTok{ v }\FloatTok{1.0}\NormalTok{))}
\NormalTok{                                                      (}\KeywordTok{mod}\NormalTok{ v }\FloatTok{1.0}\NormalTok{)]) \{}\AttributeTok{:drop-column}\NormalTok{? }\VariableTok{false}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:V1 & :V2 & :V3 & :int-part & :frac-part & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & 0 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & 1 & 0.000 & B\tabularnewline
1 & 3 & 1.500 & 1 & 0.5000 & C\tabularnewline
2 & 4 & 0.5000 & 0 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & 1 & 0.000 & B\tabularnewline
2 & 6 & 1.500 & 1 & 0.5000 & C\tabularnewline
1 & 7 & 0.5000 & 0 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & 1 & 0.000 & B\tabularnewline
1 & 9 & 1.500 & 1 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

We can treat \texttt{0} or \texttt{0.0} as missing value

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column DS }\AttributeTok{:V3}\NormalTok{ [}\AttributeTok{:int-part} \AttributeTok{:frac-part}\NormalTok{] (}\KeywordTok{fn}\NormalTok{ [^}\KeywordTok{double}\NormalTok{ v]}
\NormalTok{                                                     [(}\KeywordTok{int}\NormalTok{ (}\KeywordTok{quot}\NormalTok{ v }\FloatTok{1.0}\NormalTok{))}
\NormalTok{                                                      (}\KeywordTok{mod}\NormalTok{ v }\FloatTok{1.0}\NormalTok{)]) \{}\AttributeTok{:missing-subst}\NormalTok{ [}\DecValTok{0} \FloatTok{0.0}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :int-part & :frac-part & :V4\tabularnewline
\midrule
\endhead
1 & 1 & & 0.5000 & A\tabularnewline
2 & 2 & 1 & & B\tabularnewline
1 & 3 & 1 & 0.5000 & C\tabularnewline
2 & 4 & & 0.5000 & A\tabularnewline
1 & 5 & 1 & & B\tabularnewline
2 & 6 & 1 & 0.5000 & C\tabularnewline
1 & 7 & & 0.5000 & A\tabularnewline
2 & 8 & 1 & & B\tabularnewline
1 & 9 & 1 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Works on grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/separate-column }\AttributeTok{:V3}\NormalTok{ [}\AttributeTok{:int-part} \AttributeTok{:fract-part}\NormalTok{] (}\KeywordTok{fn}\NormalTok{ [^}\KeywordTok{double}\NormalTok{ v]}
\NormalTok{                                                       [(}\KeywordTok{int}\NormalTok{ (}\KeywordTok{quot}\NormalTok{ v }\FloatTok{1.0}\NormalTok{))}
\NormalTok{                                                        (}\KeywordTok{mod}\NormalTok{ v }\FloatTok{1.0}\NormalTok{)]))}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :int-part & :fract-part & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0 & 0.5000 & A\tabularnewline
2 & 4 & 0 & 0.5000 & A\tabularnewline
1 & 7 & 0 & 0.5000 & A\tabularnewline
2 & 2 & 1 & 0.000 & B\tabularnewline
1 & 5 & 1 & 0.000 & B\tabularnewline
2 & 8 & 1 & 0.000 & B\tabularnewline
1 & 3 & 1 & 0.5000 & C\tabularnewline
2 & 6 & 1 & 0.5000 & C\tabularnewline
1 & 9 & 1 & 0.5000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Join and separate together.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DSm}
\NormalTok{    (api/join-columns }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:result-type} \AttributeTok{:map}\NormalTok{\})}
\NormalTok{    (api/separate-column }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:v1} \AttributeTok{:v2} \AttributeTok{:v4}\NormalTok{] (}\KeywordTok{juxt} \AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V3 & :v1 & :v2 & :v4\tabularnewline
\midrule
\endhead
0.5000 & 1 & 1 & A\tabularnewline
1.000 & 2 & 2 & B\tabularnewline
& & 3 & C\tabularnewline
1.500 & 1 & 4 & A\tabularnewline
0.5000 & 2 & 5 & B\tabularnewline
1.000 & & 6 & C\tabularnewline
& 1 & 7 & A\tabularnewline
1.500 & 2 & 8 & B\tabularnewline
0.5000 & & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DSm}
\NormalTok{    (api/join-columns }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V4}\NormalTok{] \{}\AttributeTok{:result-type} \AttributeTok{:seq}\NormalTok{\})}
\NormalTok{    (api/separate-column }\AttributeTok{:joined}\NormalTok{ [}\AttributeTok{:v1} \AttributeTok{:v2} \AttributeTok{:v4}\NormalTok{] }\KeywordTok{identity}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V3 & :v1 & :v2 & :v4\tabularnewline
\midrule
\endhead
0.5000 & 1 & 1 & A\tabularnewline
1.000 & 2 & 2 & B\tabularnewline
& & 3 & C\tabularnewline
1.500 & 1 & 4 & A\tabularnewline
0.5000 & 2 & 5 & B\tabularnewline
1.000 & & 6 & C\tabularnewline
& 1 & 7 & A\tabularnewline
1.500 & 2 & 8 & B\tabularnewline
0.5000 & & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Tidyr examples}\label{tidyr-examples-1}

\href{https://tidyr.tidyverse.org/reference/separate.html}{separate
source}
\href{https://tidyr.tidyverse.org/reference/extract.html}{extract
source}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ df-separate }\NormalTok{(api/dataset \{}\AttributeTok{:x}\NormalTok{ [}\VariableTok{nil} \StringTok{"a.b"} \StringTok{"a.d"} \StringTok{"b.c"}\NormalTok{]\}))}
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ df-separate2 }\NormalTok{(api/dataset \{}\AttributeTok{:x}\NormalTok{ [}\StringTok{"a"} \StringTok{"a b"} \VariableTok{nil} \StringTok{"a b c"}\NormalTok{]\}))}
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ df-separate3 }\NormalTok{(api/dataset \{}\AttributeTok{:x}\NormalTok{ [}\StringTok{"a?b"} \VariableTok{nil} \StringTok{"a.b"} \StringTok{"b:c"}\NormalTok{]\}))}
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ df-extract }\NormalTok{(api/dataset \{}\AttributeTok{:x}\NormalTok{ [}\VariableTok{nil} \StringTok{"a-b"} \StringTok{"a-d"} \StringTok{"b-c"} \StringTok{"d-e"}\NormalTok{]\}))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#'user/df-separate
#'user/df-separate2
#'user/df-separate3
#'user/df-extract
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df-separate}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:x\tabularnewline
\midrule
\endhead
\tabularnewline
a.b\tabularnewline
a.d\tabularnewline
b.c\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df-separate2}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:x\tabularnewline
\midrule
\endhead
a\tabularnewline
a b\tabularnewline
\tabularnewline
a b c\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df-separate3}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:x\tabularnewline
\midrule
\endhead
a?b\tabularnewline
\tabularnewline
a.b\tabularnewline
b:c\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df-extract}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:x\tabularnewline
\midrule
\endhead
\tabularnewline
a-b\tabularnewline
a-d\tabularnewline
b-c\tabularnewline
d-e\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-separate }\AttributeTok{:x}\NormalTok{ [}\AttributeTok{:A} \AttributeTok{:B}\NormalTok{] }\StringTok{"}\NormalTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:A & :B\tabularnewline
\midrule
\endhead
&\tabularnewline
a & b\tabularnewline
a & d\tabularnewline
b & c\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can drop columns after separation by setting \texttt{nil} as a name.
We need second value here.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-separate }\AttributeTok{:x}\NormalTok{ [}\VariableTok{nil} \AttributeTok{:B}\NormalTok{] }\StringTok{"}\NormalTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:B\tabularnewline
\midrule
\endhead
\tabularnewline
b\tabularnewline
d\tabularnewline
c\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Extra data is dropped

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-separate2 }\AttributeTok{:x}\NormalTok{ [}\StringTok{"a"} \StringTok{"b"}\NormalTok{] }\StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
a &\tabularnewline
a & b\tabularnewline
&\tabularnewline
a & b\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Split with regular expression

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-separate3 }\AttributeTok{:x}\NormalTok{ [}\StringTok{"a"} \StringTok{"b"}\NormalTok{] }\StringTok{"[?}\NormalTok{\textbackslash{}\textbackslash{}}\StringTok{.:]"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
a & b\tabularnewline
&\tabularnewline
a & b\tabularnewline
b & c\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Or just regular expression to extract values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-separate3 }\AttributeTok{:x}\NormalTok{ [}\StringTok{"a"} \StringTok{"b"}\NormalTok{] }\SpecialStringTok{#"(.).(.)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
a & b\tabularnewline
\midrule
\endhead
a & b\tabularnewline
&\tabularnewline
a & b\tabularnewline
b & c\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Extract first value only

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-extract }\AttributeTok{:x}\NormalTok{ [}\StringTok{"A"}\NormalTok{] }\StringTok{"-"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
A\tabularnewline
\midrule
\endhead
\tabularnewline
a\tabularnewline
a\tabularnewline
b\tabularnewline
d\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Split with regex

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-extract }\AttributeTok{:x}\NormalTok{ [}\StringTok{"A"} \StringTok{"B"}\NormalTok{] }\SpecialStringTok{#"(\textbackslash{}p\{Alnum\})-(\textbackslash{}p\{Alnum\})"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
A & B\tabularnewline
\midrule
\endhead
&\tabularnewline
a & b\tabularnewline
a & d\tabularnewline
b & c\tabularnewline
d & e\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Only \texttt{a,b,c,d} strings

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/separate-column df-extract }\AttributeTok{:x}\NormalTok{ [}\StringTok{"A"} \StringTok{"B"}\NormalTok{] }\SpecialStringTok{#"([a-d]+)-([a-d]+)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
A & B\tabularnewline
\midrule
\endhead
&\tabularnewline
a & b\tabularnewline
a & d\tabularnewline
b & c\tabularnewline
&\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Fold/Unroll Rows}\label{foldunroll-rows}

To pack or unpack the data into single value you can use
\texttt{fold-by} and \texttt{unroll} functions.

\texttt{fold-by} groups dataset and packs columns data from each group
separately into desired datastructure (like vector or sequence).
\texttt{unroll} does the opposite.

\paragraph{Fold-by}\label{fold-by}

Group-by and pack columns into vector

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/fold-by DS [}\AttributeTok{:V3} \AttributeTok{:V4} \AttributeTok{:V1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V3 & :V1 & :V2\tabularnewline
\midrule
\endhead
B & 1.000 & 1 & {[}5{]}\tabularnewline
C & 1.500 & 2 & {[}6{]}\tabularnewline
C & 1.500 & 1 & {[}3 9{]}\tabularnewline
A & 0.5000 & 1 & {[}1 7{]}\tabularnewline
B & 1.000 & 2 & {[}2 8{]}\tabularnewline
A & 0.5000 & 2 & {[}4{]}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can pack several columns at once.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/fold-by DS [}\AttributeTok{:V4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
B & {[}2 1 2{]} & {[}2 5 8{]} & {[}1.0 1.0 1.0{]}\tabularnewline
C & {[}1 2 1{]} & {[}3 6 9{]} & {[}1.5 1.5 1.5{]}\tabularnewline
A & {[}1 2 1{]} & {[}1 4 7{]} & {[}0.5 0.5 0.5{]}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can use custom packing function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/fold-by DS [}\AttributeTok{:V4}\NormalTok{] }\KeywordTok{seq}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
\begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
:V4\strut
\end{minipage} & \begin{minipage}[b]{0.26\columnwidth}\raggedright\strut
:V1\strut
\end{minipage} & \begin{minipage}[b]{0.26\columnwidth}\raggedright\strut
:V2\strut
\end{minipage} & \begin{minipage}[b]{0.30\columnwidth}\raggedright\strut
:V3\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
B\strut
\end{minipage} & \begin{minipage}[t]{0.26\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@7c02}{\nolinkurl{clojure.lang.LazySeq@7c02}}\strut
\end{minipage} & \begin{minipage}[t]{0.26\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@7c84}{\nolinkurl{clojure.lang.LazySeq@7c84}}\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@1f0745f}{\nolinkurl{clojure.lang.LazySeq@1f0745f}}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
C\strut
\end{minipage} & \begin{minipage}[t]{0.26\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@785f}{\nolinkurl{clojure.lang.LazySeq@785f}}\strut
\end{minipage} & \begin{minipage}[t]{0.26\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@8065}{\nolinkurl{clojure.lang.LazySeq@8065}}\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@20f8745f}{\nolinkurl{clojure.lang.LazySeq@20f8745f}}\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
A\strut
\end{minipage} & \begin{minipage}[t]{0.26\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@785f}{\nolinkurl{clojure.lang.LazySeq@785f}}\strut
\end{minipage} & \begin{minipage}[t]{0.26\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@78a3}{\nolinkurl{clojure.lang.LazySeq@78a3}}\strut
\end{minipage} & \begin{minipage}[t]{0.30\columnwidth}\raggedright\strut
\href{mailto:clojure.lang.LazySeq@c3e0745f}{\nolinkurl{clojure.lang.LazySeq@c3e0745f}}\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/fold-by DS [}\AttributeTok{:V4}\NormalTok{] }\KeywordTok{set}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
B & \#\{1 2\} & \#\{2 5 8\} & \#\{1.0\}\tabularnewline
C & \#\{1 2\} & \#\{6 3 9\} & \#\{1.5\}\tabularnewline
A & \#\{1 2\} & \#\{7 1 4\} & \#\{0.5\}\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

This works also on grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/fold-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
B & {[}1{]} & {[}5{]} & {[}1.0{]}\tabularnewline
C & {[}1 1{]} & {[}3 9{]} & {[}1.5 1.5{]}\tabularnewline
A & {[}1 1{]} & {[}1 7{]} & {[}0.5 0.5{]}\tabularnewline
B & {[}2 2{]} & {[}2 8{]} & {[}1.0 1.0{]}\tabularnewline
C & {[}2{]} & {[}6{]} & {[}1.5{]}\tabularnewline
A & {[}2{]} & {[}4{]} & {[}0.5{]}\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Unroll}\label{unroll}

\texttt{unroll} unfolds sequences stored in data, multiplying other ones
when necessary. You can unroll more than one column at once (folded data
should have the same size!).

Options:

\begin{itemize}
\tightlist
\item
  \texttt{:indexes?} if true (or column name), information about index
  of unrolled sequence is added.
\item
  \texttt{:datatypes} list of datatypes which should be applied to
  restored columns, a map
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Unroll one column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unroll (api/fold-by DS [}\AttributeTok{:V4}\NormalTok{]) [}\AttributeTok{:V1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V2 & :V3 & :V1\tabularnewline
\midrule
\endhead
B & {[}2 5 8{]} & {[}1.0 1.0 1.0{]} & 2\tabularnewline
B & {[}2 5 8{]} & {[}1.0 1.0 1.0{]} & 1\tabularnewline
B & {[}2 5 8{]} & {[}1.0 1.0 1.0{]} & 2\tabularnewline
C & {[}3 6 9{]} & {[}1.5 1.5 1.5{]} & 1\tabularnewline
C & {[}3 6 9{]} & {[}1.5 1.5 1.5{]} & 2\tabularnewline
C & {[}3 6 9{]} & {[}1.5 1.5 1.5{]} & 1\tabularnewline
A & {[}1 4 7{]} & {[}0.5 0.5 0.5{]} & 1\tabularnewline
A & {[}1 4 7{]} & {[}0.5 0.5 0.5{]} & 2\tabularnewline
A & {[}1 4 7{]} & {[}0.5 0.5 0.5{]} & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Unroll all folded columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unroll (api/fold-by DS [}\AttributeTok{:V4}\NormalTok{]) [}\AttributeTok{:V1} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
B & 2 & 2 & 1.000\tabularnewline
B & 1 & 5 & 1.000\tabularnewline
B & 2 & 8 & 1.000\tabularnewline
C & 1 & 3 & 1.500\tabularnewline
C & 2 & 6 & 1.500\tabularnewline
C & 1 & 9 & 1.500\tabularnewline
A & 1 & 1 & 0.5000\tabularnewline
A & 2 & 4 & 0.5000\tabularnewline
A & 1 & 7 & 0.5000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Unroll one by one leads to cartesian product

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/fold-by [}\AttributeTok{:V4} \AttributeTok{:V1}\NormalTok{])}
\NormalTok{    (api/unroll [}\AttributeTok{:V2}\NormalTok{])}
\NormalTok{    (api/unroll [}\AttributeTok{:V3}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}15 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
C & 2 & 6 & 1.500\tabularnewline
A & 1 & 1 & 0.5000\tabularnewline
A & 1 & 1 & 0.5000\tabularnewline
A & 1 & 7 & 0.5000\tabularnewline
A & 1 & 7 & 0.5000\tabularnewline
B & 1 & 5 & 1.000\tabularnewline
C & 1 & 3 & 1.500\tabularnewline
C & 1 & 3 & 1.500\tabularnewline
C & 1 & 9 & 1.500\tabularnewline
C & 1 & 9 & 1.500\tabularnewline
A & 2 & 4 & 0.5000\tabularnewline
B & 2 & 2 & 1.000\tabularnewline
B & 2 & 2 & 1.000\tabularnewline
B & 2 & 8 & 1.000\tabularnewline
B & 2 & 8 & 1.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can add indexes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unroll (api/fold-by DS [}\AttributeTok{:V1}\NormalTok{]) [}\AttributeTok{:V4} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] \{}\AttributeTok{:indexes}\NormalTok{? }\VariableTok{true}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :indexes & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & 1 & 0.5000 & A\tabularnewline
1 & 1 & 3 & 1.500 & C\tabularnewline
1 & 2 & 5 & 1.000 & B\tabularnewline
1 & 3 & 7 & 0.5000 & A\tabularnewline
1 & 4 & 9 & 1.500 & C\tabularnewline
2 & 0 & 2 & 1.000 & B\tabularnewline
2 & 1 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 6 & 1.500 & C\tabularnewline
2 & 3 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unroll (api/fold-by DS [}\AttributeTok{:V1}\NormalTok{]) [}\AttributeTok{:V4} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] \{}\AttributeTok{:indexes}\NormalTok{? }\StringTok{"vector idx"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & vector idx & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & 1 & 0.5000 & A\tabularnewline
1 & 1 & 3 & 1.500 & C\tabularnewline
1 & 2 & 5 & 1.000 & B\tabularnewline
1 & 3 & 7 & 0.5000 & A\tabularnewline
1 & 4 & 9 & 1.500 & C\tabularnewline
2 & 0 & 2 & 1.000 & B\tabularnewline
2 & 1 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 6 & 1.500 & C\tabularnewline
2 & 3 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

You can also force datatypes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/fold-by [}\AttributeTok{:V1}\NormalTok{])}
\NormalTok{    (api/unroll [}\AttributeTok{:V4} \AttributeTok{:V2} \AttributeTok{:V3}\NormalTok{] \{}\AttributeTok{:datatypes}\NormalTok{ \{}\AttributeTok{:V4} \AttributeTok{:string}
                                           \AttributeTok{:V2} \AttributeTok{:int16}
                                           \AttributeTok{:V3} \AttributeTok{:float32}\NormalTok{\}\})}
\NormalTok{    (api/info }\AttributeTok{:columns}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed :column info {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:name & :size & :datatype & :categorical?\tabularnewline
\midrule
\endhead
:V1 & 9 & :object &\tabularnewline
:V2 & 9 & :int16 &\tabularnewline
:V3 & 9 & :float32 &\tabularnewline
:V4 & 9 & :string & true\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

This works also on grouped dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V1}\NormalTok{)}
\NormalTok{    (api/fold-by [}\AttributeTok{:V1} \AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/unroll }\AttributeTok{:V3}\NormalTok{ \{}\AttributeTok{:indexes}\NormalTok{? }\VariableTok{true}\NormalTok{\})}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V4 & :V1 & :V2 & :indexes & :V3\tabularnewline
\midrule
\endhead
A & 1 & {[}1 7{]} & 0 & 0.5000\tabularnewline
A & 1 & {[}1 7{]} & 1 & 0.5000\tabularnewline
B & 1 & {[}5{]} & 0 & 1.000\tabularnewline
C & 1 & {[}3 9{]} & 0 & 1.500\tabularnewline
C & 1 & {[}3 9{]} & 1 & 1.500\tabularnewline
C & 2 & {[}6{]} & 0 & 1.500\tabularnewline
A & 2 & {[}4{]} & 0 & 0.5000\tabularnewline
B & 2 & {[}2 8{]} & 0 & 1.000\tabularnewline
B & 2 & {[}2 8{]} & 1 & 1.000\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Reshape}\label{reshape}

Reshaping data provides two types of operations:

\begin{itemize}
\tightlist
\item
  \texttt{pivot-\textgreater{}longer} - converting columns to rows
\item
  \texttt{pivot-\textgreater{}wider} - converting rows to columns
\end{itemize}

Both functions are inspired on
\href{https://tidyr.tidyverse.org/articles/pivot.html}{tidyr} R package
and provide almost the same functionality.

All examples are taken from mentioned above documentation.

Both functions work only on regular dataset.

\paragraph{Longer}\label{longer}

\texttt{pivot-\textgreater{}longer} converts columns to rows. Column
names are treated as data.

Arguments:

\begin{itemize}
\tightlist
\item
  dataset
\item
  columns selector
\item
  options:

  \begin{itemize}
  \tightlist
  \item
    \texttt{:target-columns} - names of the columns created or columns
    pattern (see below) (default: \texttt{:\$column})
  \item
    \texttt{:value-column-name} - name of the column for values
    (default: \texttt{:\$value})
  \item
    \texttt{:splitter} - regular expression or function which splits
    source column names into data
  \item
    \texttt{:drop-missing?} - remove rows with missing? (default:
    \texttt{:true})
  \item
    \texttt{:datatypes} - map of target columns data types
  \end{itemize}
\end{itemize}

\texttt{:target-columns} - can be:

\begin{itemize}
\tightlist
\item
  column name - source columns names are put there as a data
\item
  column names as seqence - source columns names after split are put
  separately into \texttt{:target-columns} as data
\item
  pattern - is a sequence of names, where some of the names are
  \texttt{nil}. \texttt{nil} is replaced by a name taken from splitter
  and such column is used for values.
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Create rows from all columns but \texttt{"religion"}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ relig-income }\NormalTok{(api/dataset }\StringTok{"data/relig_income.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{relig-income}
\end{Highlighting}
\end{Shaded}

data/relig\_income.csv {[}18 11{]}:

\begin{longtable}[]{@{}lllllllllll@{}}
\toprule
\begin{minipage}[b]{0.14\columnwidth}\raggedright\strut
religion\strut
\end{minipage} & \begin{minipage}[b]{0.04\columnwidth}\raggedright\strut
\textless{}\$10k\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
\$10-20k\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
\$20-30k\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
\$30-40k\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
\$40-50k\strut
\end{minipage} & \begin{minipage}[b]{0.05\columnwidth}\raggedright\strut
\$50-75k\strut
\end{minipage} & \begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
\$75-100k\strut
\end{minipage} & \begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
\$100-150k\strut
\end{minipage} & \begin{minipage}[b]{0.04\columnwidth}\raggedright\strut
\textgreater{}150k\strut
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\raggedright\strut
Don't know/refused\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Agnostic\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
27\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
34\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
60\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
81\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
76\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
137\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
122\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
109\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
84\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
96\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Atheist\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
12\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
27\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
37\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
52\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
35\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
70\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
73\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
59\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
74\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
76\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Buddhist\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
27\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
21\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
30\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
34\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
33\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
58\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
62\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
39\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
53\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
54\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Catholic\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
418\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
617\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
732\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
670\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
638\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
1116\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
949\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
792\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
633\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
1489\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Don't know/refused\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
15\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
14\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
15\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
11\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
10\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
35\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
21\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
17\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
18\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
116\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Evangelical Prot\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
575\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
869\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
1064\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
982\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
881\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
1486\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
949\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
723\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
414\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
1529\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Hindu\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
7\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
11\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
34\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
47\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
48\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
54\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
37\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Historically Black Prot\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
228\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
244\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
236\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
238\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
197\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
223\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
131\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
81\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
78\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
339\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Jehovah's Witness\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
20\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
27\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
24\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
24\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
21\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
30\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
15\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
11\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
6\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
37\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Jewish\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
19\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
19\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
25\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
25\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
30\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
95\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
69\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
87\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
151\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
162\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Mainline Prot\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
289\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
495\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
619\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
655\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
651\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
1107\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
939\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
753\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
634\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
1328\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Mormon\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
29\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
40\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
48\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
51\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
56\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
112\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
85\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
49\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
42\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
69\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Muslim\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
6\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
7\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
10\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
23\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
16\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
8\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
6\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
22\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Orthodox\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
13\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
17\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
23\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
32\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
32\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
47\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
38\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
42\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
46\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
73\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Other Christian\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
7\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
11\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
13\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
13\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
14\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
18\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
14\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
12\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
18\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Other Faiths\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
20\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
33\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
40\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
46\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
49\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
63\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
46\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
40\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
41\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
71\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Other World Religions\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
5\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
2\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
3\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
4\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
2\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
7\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
3\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
4\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
4\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
8\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.14\columnwidth}\raggedright\strut
Unaffiliated\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
217\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
299\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
374\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
365\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
341\strut
\end{minipage} & \begin{minipage}[t]{0.05\columnwidth}\raggedright\strut
528\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
407\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
321\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
258\strut
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
597\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer relig-income (}\KeywordTok{complement}\NormalTok{ #\{}\StringTok{"religion"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

data/relig\_income.csv {[}180 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
religion & :\$column & :\$value\tabularnewline
\midrule
\endhead
Agnostic & \textless{}\$10k & 27\tabularnewline
Atheist & \textless{}\$10k & 12\tabularnewline
Buddhist & \textless{}\$10k & 27\tabularnewline
Catholic & \textless{}\$10k & 418\tabularnewline
Don't know/refused & \textless{}\$10k & 15\tabularnewline
Evangelical Prot & \textless{}\$10k & 575\tabularnewline
Hindu & \textless{}\$10k & 1\tabularnewline
Historically Black Prot & \textless{}\$10k & 228\tabularnewline
Jehovah's Witness & \textless{}\$10k & 20\tabularnewline
Jewish & \textless{}\$10k & 19\tabularnewline
Mainline Prot & \textless{}\$10k & 289\tabularnewline
Mormon & \textless{}\$10k & 29\tabularnewline
Muslim & \textless{}\$10k & 6\tabularnewline
Orthodox & \textless{}\$10k & 13\tabularnewline
Other Christian & \textless{}\$10k & 9\tabularnewline
Other Faiths & \textless{}\$10k & 20\tabularnewline
Other World Religions & \textless{}\$10k & 5\tabularnewline
Unaffiliated & \textless{}\$10k & 217\tabularnewline
Agnostic & Don't know/refused & 96\tabularnewline
Atheist & Don't know/refused & 76\tabularnewline
Buddhist & Don't know/refused & 54\tabularnewline
Catholic & Don't know/refused & 1489\tabularnewline
Don't know/refused & Don't know/refused & 116\tabularnewline
Evangelical Prot & Don't know/refused & 1529\tabularnewline
Hindu & Don't know/refused & 37\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Convert only columns starting with \texttt{"wk"} and pack them into
\texttt{:week} column, values go to \texttt{:rank} column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ bilboard }\NormalTok{(}\KeywordTok{->}\NormalTok{ (api/dataset }\StringTok{"data/billboard.csv.gz"}\NormalTok{)}
\NormalTok{                  (api/drop-columns #(}\KeywordTok{=} \AttributeTok{:boolean} \VariableTok{%}\NormalTok{) }\AttributeTok{:datatype}\NormalTok{))) }\CommentTok{;; drop some boolean columns, tidyr just skips them}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>}\NormalTok{ bilboard}
\NormalTok{     (api/column-names)}
\NormalTok{     (}\KeywordTok{take} \DecValTok{13}\NormalTok{)}
\NormalTok{     (api/select-columns bilboard))}
\end{Highlighting}
\end{Shaded}

data/billboard.csv.gz {[}317 13{]}:

\begin{longtable}[]{@{}lllllllllllll@{}}
\toprule
artist & track & date.entered & wk1 & wk2 & wk3 & wk4 & wk5 & wk6 & wk7
& wk8 & wk9 & wk10\tabularnewline
\midrule
\endhead
2 Pac & Baby Don't Cry (Keep\ldots{} & 2000-02-26 & 87 & 82 & 72 & 77 &
87 & 94 & 99 & & &\tabularnewline
2Ge+her & The Hardest Part Of \ldots{} & 2000-09-02 & 91 & 87 & 92 & & &
& & & &\tabularnewline
3 Doors Down & Kryptonite & 2000-04-08 & 81 & 70 & 68 & 67 & 66 & 57 &
54 & 53 & 51 & 51\tabularnewline
3 Doors Down & Loser & 2000-10-21 & 76 & 76 & 72 & 69 & 67 & 65 & 55 &
59 & 62 & 61\tabularnewline
504 Boyz & Wobble Wobble & 2000-04-15 & 57 & 34 & 25 & 17 & 17 & 31 & 36
& 49 & 53 & 57\tabularnewline
98\^{}0 & Give Me Just One Nig\ldots{} & 2000-08-19 & 51 & 39 & 34 & 26
& 26 & 19 & 2 & 2 & 3 & 6\tabularnewline
A*Teens & Dancing Queen & 2000-07-08 & 97 & 97 & 96 & 95 & 100 & & & &
&\tabularnewline
Aaliyah & I Don't Wanna & 2000-01-29 & 84 & 62 & 51 & 41 & 38 & 35 & 35
& 38 & 38 & 36\tabularnewline
Aaliyah & Try Again & 2000-03-18 & 59 & 53 & 38 & 28 & 21 & 18 & 16 & 14
& 12 & 10\tabularnewline
Adams, Yolanda & Open My Heart & 2000-08-26 & 76 & 76 & 74 & 69 & 68 &
67 & 61 & 58 & 57 & 59\tabularnewline
Adkins, Trace & More & 2000-04-29 & 84 & 84 & 75 & 73 & 73 & 69 & 68 &
65 & 73 & 83\tabularnewline
Aguilera, Christina & Come On Over Baby (A\ldots{} & 2000-08-05 & 57 &
47 & 45 & 29 & 23 & 18 & 11 & 9 & 9 & 11\tabularnewline
Aguilera, Christina & I Turn To You & 2000-04-15 & 50 & 39 & 30 & 28 &
21 & 19 & 20 & 17 & 17 & 17\tabularnewline
Aguilera, Christina & What A Girl Wants & 1999-11-27 & 71 & 51 & 28 & 18
& 13 & 13 & 11 & 1 & 1 & 2\tabularnewline
Alice Deejay & Better Off Alone & 2000-04-08 & 79 & 65 & 53 & 48 & 45 &
36 & 34 & 29 & 27 & 30\tabularnewline
Allan, Gary & Smoke Rings In The D\ldots{} & 2000-01-22 & 80 & 78 & 76 &
77 & 92 & & & & &\tabularnewline
Amber & Sexual & 1999-07-17 & 99 & 99 & 96 & 96 & 100 & 93 & 93 & 96 &
&\tabularnewline
Anastacia & I'm Outta Love & 2000-04-01 & 92 & & & 95 & & & & &
&\tabularnewline
Anthony, Marc & My Baby You & 2000-09-16 & 82 & 76 & 76 & 70 & 82 & 81 &
74 & 80 & 76 & 76\tabularnewline
Anthony, Marc & You Sang To Me & 2000-02-26 & 77 & 54 & 50 & 43 & 30 &
27 & 21 & 18 & 15 & 13\tabularnewline
Avant & My First Love & 2000-11-04 & 70 & 62 & 56 & 43 & 39 & 33 & 26 &
26 & 26 & 31\tabularnewline
Avant & Separated & 2000-04-29 & 62 & 32 & 30 & 23 & 26 & 30 & 35 & 32 &
32 & 25\tabularnewline
BBMak & Back Here & 2000-04-29 & 99 & 86 & 60 & 52 & 38 & 34 & 28 & 21 &
18 & 18\tabularnewline
Backstreet Boys, The & Shape Of My Heart & 2000-10-14 & 39 & 25 & 24 &
15 & 12 & 12 & 10 & 9 & 10 & 12\tabularnewline
Backstreet Boys, The & Show Me The Meaning \ldots{} & 2000-01-01 & 74 &
62 & 55 & 25 & 16 & 14 & 12 & 10 & 12 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer bilboard #(clojure.string/starts-with? }\VariableTok{%} \StringTok{"wk"}\NormalTok{) \{}\AttributeTok{:target-columns} \AttributeTok{:week}
                                                                   \AttributeTok{:value-column-name} \AttributeTok{:rank}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

data/billboard.csv.gz {[}5307 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
artist & track & date.entered & :week & :rank\tabularnewline
\midrule
\endhead
3 Doors Down & Kryptonite & 2000-04-08 & wk35 & 4\tabularnewline
Braxton, Toni & He Wasn't Man Enough & 2000-03-18 & wk35 &
34\tabularnewline
Creed & Higher & 1999-09-11 & wk35 & 22\tabularnewline
Creed & With Arms Wide Open & 2000-05-13 & wk35 & 5\tabularnewline
Hill, Faith & Breathe & 1999-11-06 & wk35 & 8\tabularnewline
Joe & I Wanna Know & 2000-01-01 & wk35 & 5\tabularnewline
Lonestar & Amazed & 1999-06-05 & wk35 & 14\tabularnewline
Vertical Horizon & Everything You Want & 2000-01-22 & wk35 &
27\tabularnewline
matchbox twenty & Bent & 2000-04-29 & wk35 & 33\tabularnewline
Creed & Higher & 1999-09-11 & wk55 & 21\tabularnewline
Lonestar & Amazed & 1999-06-05 & wk55 & 22\tabularnewline
3 Doors Down & Kryptonite & 2000-04-08 & wk19 & 18\tabularnewline
3 Doors Down & Loser & 2000-10-21 & wk19 & 73\tabularnewline
98\^{}0 & Give Me Just One Nig\ldots{} & 2000-08-19 & wk19 &
93\tabularnewline
Aaliyah & I Don't Wanna & 2000-01-29 & wk19 & 83\tabularnewline
Aaliyah & Try Again & 2000-03-18 & wk19 & 3\tabularnewline
Adams, Yolanda & Open My Heart & 2000-08-26 & wk19 & 79\tabularnewline
Aguilera, Christina & Come On Over Baby (A\ldots{} & 2000-08-05 & wk19 &
23\tabularnewline
Aguilera, Christina & I Turn To You & 2000-04-15 & wk19 &
29\tabularnewline
Aguilera, Christina & What A Girl Wants & 1999-11-27 & wk19 &
18\tabularnewline
Alice Deejay & Better Off Alone & 2000-04-08 & wk19 & 79\tabularnewline
Amber & Sexual & 1999-07-17 & wk19 & 95\tabularnewline
Anthony, Marc & My Baby You & 2000-09-16 & wk19 & 91\tabularnewline
Anthony, Marc & You Sang To Me & 2000-02-26 & wk19 & 9\tabularnewline
Avant & My First Love & 2000-11-04 & wk19 & 81\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

We can create numerical column out of column names

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer bilboard #(clojure.string/starts-with? }\VariableTok{%} \StringTok{"wk"}\NormalTok{) \{}\AttributeTok{:target-columns} \AttributeTok{:week}
                                                                   \AttributeTok{:value-column-name} \AttributeTok{:rank}
                                                                   \AttributeTok{:splitter} \SpecialStringTok{#"wk(.*)"}
                                                                   \AttributeTok{:datatypes}\NormalTok{ \{}\AttributeTok{:week} \AttributeTok{:int16}\NormalTok{\}\})}
\end{Highlighting}
\end{Shaded}

data/billboard.csv.gz {[}5307 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
artist & track & date.entered & :week & :rank\tabularnewline
\midrule
\endhead
3 Doors Down & Kryptonite & 2000-04-08 & 46 & 21\tabularnewline
Creed & Higher & 1999-09-11 & 46 & 7\tabularnewline
Creed & With Arms Wide Open & 2000-05-13 & 46 & 37\tabularnewline
Hill, Faith & Breathe & 1999-11-06 & 46 & 31\tabularnewline
Lonestar & Amazed & 1999-06-05 & 46 & 5\tabularnewline
3 Doors Down & Kryptonite & 2000-04-08 & 51 & 42\tabularnewline
Creed & Higher & 1999-09-11 & 51 & 14\tabularnewline
Hill, Faith & Breathe & 1999-11-06 & 51 & 49\tabularnewline
Lonestar & Amazed & 1999-06-05 & 51 & 12\tabularnewline
2 Pac & Baby Don't Cry (Keep\ldots{} & 2000-02-26 & 6 &
94\tabularnewline
3 Doors Down & Kryptonite & 2000-04-08 & 6 & 57\tabularnewline
3 Doors Down & Loser & 2000-10-21 & 6 & 65\tabularnewline
504 Boyz & Wobble Wobble & 2000-04-15 & 6 & 31\tabularnewline
98\^{}0 & Give Me Just One Nig\ldots{} & 2000-08-19 & 6 &
19\tabularnewline
Aaliyah & I Don't Wanna & 2000-01-29 & 6 & 35\tabularnewline
Aaliyah & Try Again & 2000-03-18 & 6 & 18\tabularnewline
Adams, Yolanda & Open My Heart & 2000-08-26 & 6 & 67\tabularnewline
Adkins, Trace & More & 2000-04-29 & 6 & 69\tabularnewline
Aguilera, Christina & Come On Over Baby (A\ldots{} & 2000-08-05 & 6 &
18\tabularnewline
Aguilera, Christina & I Turn To You & 2000-04-15 & 6 & 19\tabularnewline
Aguilera, Christina & What A Girl Wants & 1999-11-27 & 6 &
13\tabularnewline
Alice Deejay & Better Off Alone & 2000-04-08 & 6 & 36\tabularnewline
Amber & Sexual & 1999-07-17 & 6 & 93\tabularnewline
Anthony, Marc & My Baby You & 2000-09-16 & 6 & 81\tabularnewline
Anthony, Marc & You Sang To Me & 2000-02-26 & 6 & 27\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

When column names contain observation data, such column names can be
splitted and data can be restored into separate columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ who }\NormalTok{(api/dataset }\StringTok{"data/who.csv.gz"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>}\NormalTok{ who}
\NormalTok{     (api/column-names)}
\NormalTok{     (}\KeywordTok{take} \DecValTok{10}\NormalTok{)}
\NormalTok{     (api/select-columns who))}
\end{Highlighting}
\end{Shaded}

data/who.csv.gz {[}7240 10{]}:

\begin{longtable}[]{@{}llllllllll@{}}
\toprule
\begin{minipage}[b]{0.08\columnwidth}\raggedright\strut
country\strut
\end{minipage} & \begin{minipage}[b]{0.04\columnwidth}\raggedright\strut
iso2\strut
\end{minipage} & \begin{minipage}[b]{0.04\columnwidth}\raggedright\strut
iso3\strut
\end{minipage} & \begin{minipage}[b]{0.04\columnwidth}\raggedright\strut
year\strut
\end{minipage} & \begin{minipage}[b]{0.08\columnwidth}\raggedright\strut
new\_sp\_m014\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
new\_sp\_m1524\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
new\_sp\_m2534\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
new\_sp\_m3544\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
new\_sp\_m4554\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
new\_sp\_m5564\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1980\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1981\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1982\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1983\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1984\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1985\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1986\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1987\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1988\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1989\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1990\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1991\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1992\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1993\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1994\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1995\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1996\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1997\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
10\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
6\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
3\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
5\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
2\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1998\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
30\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
129\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
128\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
90\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
89\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
64\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
1999\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
8\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
55\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
55\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
47\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
34\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
21\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
2000\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
52\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
228\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
183\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
149\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
129\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
94\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
2001\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
129\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
379\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
349\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
274\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
204\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
139\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
2002\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
90\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
476\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
481\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
368\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
246\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
241\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
2003\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
127\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
511\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
436\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
284\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
256\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
288\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
Afghanistan\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AF\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
AFG\strut
\end{minipage} & \begin{minipage}[t]{0.04\columnwidth}\raggedright\strut
2004\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
139\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
537\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
568\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
360\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
358\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
386\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer who #(clojure.string/starts-with? }\VariableTok{%} \StringTok{"new"}\NormalTok{) \{}\AttributeTok{:target-columns}\NormalTok{ [}\AttributeTok{:diagnosis} \AttributeTok{:gender} \AttributeTok{:age}\NormalTok{]}
                                                               \AttributeTok{:splitter} \SpecialStringTok{#"new_?(.*)_(.)(.*)"}
                                                               \AttributeTok{:value-column-name} \AttributeTok{:count}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

data/who.csv.gz {[}76046 8{]}:

\begin{longtable}[]{@{}llllllll@{}}
\toprule
country & iso2 & iso3 & year & :diagnosis & :gender & :age &
:count\tabularnewline
\midrule
\endhead
Albania & AL & ALB & 2013 & rel & m & 1524 & 60\tabularnewline
Algeria & DZ & DZA & 2013 & rel & m & 1524 & 1021\tabularnewline
Andorra & AD & AND & 2013 & rel & m & 1524 & 0\tabularnewline
Angola & AO & AGO & 2013 & rel & m & 1524 & 2992\tabularnewline
Anguilla & AI & AIA & 2013 & rel & m & 1524 & 0\tabularnewline
Antigua and Barbuda & AG & ATG & 2013 & rel & m & 1524 &
1\tabularnewline
Argentina & AR & ARG & 2013 & rel & m & 1524 & 1124\tabularnewline
Armenia & AM & ARM & 2013 & rel & m & 1524 & 116\tabularnewline
Australia & AU & AUS & 2013 & rel & m & 1524 & 105\tabularnewline
Austria & AT & AUT & 2013 & rel & m & 1524 & 44\tabularnewline
Azerbaijan & AZ & AZE & 2013 & rel & m & 1524 & 958\tabularnewline
Bahamas & BS & BHS & 2013 & rel & m & 1524 & 2\tabularnewline
Bahrain & BH & BHR & 2013 & rel & m & 1524 & 13\tabularnewline
Bangladesh & BD & BGD & 2013 & rel & m & 1524 & 14705\tabularnewline
Barbados & BB & BRB & 2013 & rel & m & 1524 & 0\tabularnewline
Belarus & BY & BLR & 2013 & rel & m & 1524 & 162\tabularnewline
Belgium & BE & BEL & 2013 & rel & m & 1524 & 63\tabularnewline
Belize & BZ & BLZ & 2013 & rel & m & 1524 & 8\tabularnewline
Benin & BJ & BEN & 2013 & rel & m & 1524 & 301\tabularnewline
Bermuda & BM & BMU & 2013 & rel & m & 1524 & 0\tabularnewline
Bhutan & BT & BTN & 2013 & rel & m & 1524 & 180\tabularnewline
Bolivia (Plurinational State of) & BO & BOL & 2013 & rel & m & 1524 &
1470\tabularnewline
Bonaire, Saint Eustatius and Saba & BQ & BES & 2013 & rel & m & 1524 &
0\tabularnewline
Bosnia and Herzegovina & BA & BIH & 2013 & rel & m & 1524 &
57\tabularnewline
Botswana & BW & BWA & 2013 & rel & m & 1524 & 423\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

When data contains multiple observations per row, we can use splitter
and pattern for target columns to create new columns and put values
there. In following dataset we have two obseravations \texttt{dob} and
\texttt{gender} for two childs. We want to put child infomation into the
column and leave dob and gender for values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ family }\NormalTok{(api/dataset }\StringTok{"data/family.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{family}
\end{Highlighting}
\end{Shaded}

data/family.csv {[}5 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
family & dob\_child1 & dob\_child2 & gender\_child1 &
gender\_child2\tabularnewline
\midrule
\endhead
1 & 1998-11-26 & 2000-01-29 & 1 & 2\tabularnewline
2 & 1996-06-22 & & 2 &\tabularnewline
3 & 2002-07-11 & 2004-04-05 & 2 & 2\tabularnewline
4 & 2004-10-10 & 2009-08-27 & 1 & 1\tabularnewline
5 & 2000-12-05 & 2005-02-28 & 2 & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer family (}\KeywordTok{complement}\NormalTok{ #\{}\StringTok{"family"}\NormalTok{\}) \{}\AttributeTok{:target-columns}\NormalTok{ [}\VariableTok{nil} \AttributeTok{:child}\NormalTok{]}
                                                    \AttributeTok{:splitter}\NormalTok{ #(clojure.string/split }\VariableTok{%} \SpecialStringTok{#"_"}\NormalTok{)}
                                                    \AttributeTok{:datatypes}\NormalTok{ \{}\StringTok{"gender"} \AttributeTok{:int16}\NormalTok{\}\})}
\end{Highlighting}
\end{Shaded}

data/family.csv {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
family & :child & dob & gender\tabularnewline
\midrule
\endhead
1 & child1 & 1998-11-26 & 1\tabularnewline
2 & child1 & 1996-06-22 & 2\tabularnewline
3 & child1 & 2002-07-11 & 2\tabularnewline
4 & child1 & 2004-10-10 & 1\tabularnewline
5 & child1 & 2000-12-05 & 2\tabularnewline
1 & child2 & 2000-01-29 & 2\tabularnewline
3 & child2 & 2004-04-05 & 2\tabularnewline
4 & child2 & 2009-08-27 & 1\tabularnewline
5 & child2 & 2005-02-28 & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Similar here, we have two observations: \texttt{x} and \texttt{y} in
four groups.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ anscombe }\NormalTok{(api/dataset }\StringTok{"data/anscombe.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anscombe}
\end{Highlighting}
\end{Shaded}

data/anscombe.csv {[}11 8{]}:

\begin{longtable}[]{@{}llllllll@{}}
\toprule
x1 & x2 & x3 & x4 & y1 & y2 & y3 & y4\tabularnewline
\midrule
\endhead
10 & 10 & 10 & 8 & 8.040 & 9.140 & 7.460 & 6.580\tabularnewline
8 & 8 & 8 & 8 & 6.950 & 8.140 & 6.770 & 5.760\tabularnewline
13 & 13 & 13 & 8 & 7.580 & 8.740 & 12.74 & 7.710\tabularnewline
9 & 9 & 9 & 8 & 8.810 & 8.770 & 7.110 & 8.840\tabularnewline
11 & 11 & 11 & 8 & 8.330 & 9.260 & 7.810 & 8.470\tabularnewline
14 & 14 & 14 & 8 & 9.960 & 8.100 & 8.840 & 7.040\tabularnewline
6 & 6 & 6 & 8 & 7.240 & 6.130 & 6.080 & 5.250\tabularnewline
4 & 4 & 4 & 19 & 4.260 & 3.100 & 5.390 & 12.50\tabularnewline
12 & 12 & 12 & 8 & 10.84 & 9.130 & 8.150 & 5.560\tabularnewline
7 & 7 & 7 & 8 & 4.820 & 7.260 & 6.420 & 7.910\tabularnewline
5 & 5 & 5 & 8 & 5.680 & 4.740 & 5.730 & 6.890\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer anscombe }\AttributeTok{:all}\NormalTok{ \{}\AttributeTok{:splitter} \SpecialStringTok{#"(.)(.)"}
                                  \AttributeTok{:target-columns}\NormalTok{ [}\VariableTok{nil} \AttributeTok{:set}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

data/anscombe.csv {[}44 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:set & x & y\tabularnewline
\midrule
\endhead
1 & 10 & 8.040\tabularnewline
1 & 8 & 6.950\tabularnewline
1 & 13 & 7.580\tabularnewline
1 & 9 & 8.810\tabularnewline
1 & 11 & 8.330\tabularnewline
1 & 14 & 9.960\tabularnewline
1 & 6 & 7.240\tabularnewline
1 & 4 & 4.260\tabularnewline
1 & 12 & 10.84\tabularnewline
1 & 7 & 4.820\tabularnewline
1 & 5 & 5.680\tabularnewline
2 & 10 & 9.140\tabularnewline
2 & 8 & 8.140\tabularnewline
2 & 13 & 8.740\tabularnewline
2 & 9 & 8.770\tabularnewline
2 & 11 & 9.260\tabularnewline
2 & 14 & 8.100\tabularnewline
2 & 6 & 6.130\tabularnewline
2 & 4 & 3.100\tabularnewline
2 & 12 & 9.130\tabularnewline
2 & 7 & 7.260\tabularnewline
2 & 5 & 4.740\tabularnewline
3 & 10 & 7.460\tabularnewline
3 & 8 & 6.770\tabularnewline
3 & 13 & 12.74\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ pnl }\NormalTok{(api/dataset \{}\AttributeTok{:x}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3} \DecValTok{4}\NormalTok{]}
                       \AttributeTok{:a}\NormalTok{ [}\DecValTok{1} \DecValTok{1} \DecValTok{0} \DecValTok{0}\NormalTok{]}
                       \AttributeTok{:b}\NormalTok{ [}\DecValTok{0} \DecValTok{1} \DecValTok{1} \DecValTok{1}\NormalTok{]}
                       \AttributeTok{:y1}\NormalTok{ (}\KeywordTok{repeatedly} \DecValTok{4} \KeywordTok{rand}\NormalTok{)}
                       \AttributeTok{:y2}\NormalTok{ (}\KeywordTok{repeatedly} \DecValTok{4} \KeywordTok{rand}\NormalTok{)}
                       \AttributeTok{:z1}\NormalTok{ [}\DecValTok{3} \DecValTok{3} \DecValTok{3} \DecValTok{3}\NormalTok{]}
                       \AttributeTok{:z2}\NormalTok{ [-}\DecValTok{2} \DecValTok{-2} \DecValTok{-2} \DecValTok{-2}\NormalTok{]\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pnl}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:x & :a & :b & :y1 & :y2 & :z1 & :z2\tabularnewline
\midrule
\endhead
1 & 1 & 0 & 0.8680 & 0.3047 & 3 & -2\tabularnewline
2 & 1 & 1 & 0.9778 & 0.8507 & 3 & -2\tabularnewline
3 & 0 & 1 & 0.5632 & 0.7646 & 3 & -2\tabularnewline
4 & 0 & 1 & 0.3847 & 0.02462 & 3 & -2\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->longer pnl [}\AttributeTok{:y1} \AttributeTok{:y2} \AttributeTok{:z1} \AttributeTok{:z2}\NormalTok{] \{}\AttributeTok{:target-columns}\NormalTok{ [}\VariableTok{nil} \AttributeTok{:times}\NormalTok{]}
                                          \AttributeTok{:splitter} \SpecialStringTok{#":(.)(.)"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}8 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:x & :a & :b & :times & y & z\tabularnewline
\midrule
\endhead
1 & 1 & 0 & 1 & 0.8680 & 3\tabularnewline
2 & 1 & 1 & 1 & 0.9778 & 3\tabularnewline
3 & 0 & 1 & 1 & 0.5632 & 3\tabularnewline
4 & 0 & 1 & 1 & 0.3847 & 3\tabularnewline
1 & 1 & 0 & 2 & 0.3047 & -2\tabularnewline
2 & 1 & 1 & 2 & 0.8507 & -2\tabularnewline
3 & 0 & 1 & 2 & 0.7646 & -2\tabularnewline
4 & 0 & 1 & 2 & 0.02462 & -2\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Wider}\label{wider}

\texttt{pivot-\textgreater{}wider} converts rows to columns.

Arguments:

\begin{itemize}
\tightlist
\item
  dataset
\item
  \texttt{columns-selector} - values from selected columns are converted
  to new columns
\item
  \texttt{value-columns} - what are values
\end{itemize}

When multiple columns are used as columns selector, names are joined
using \texttt{:concat-columns-with} option.
\texttt{:concat-columns-with} can be a string or function (default:
``\_``). Function accepts sequence of names.

When \texttt{columns-selector} creates non unique set of values, they
are folded using \texttt{:fold-fn} (default: \texttt{vec}) option.

When \texttt{value-columns} is a sequence, multiple observations as
columns are created appending value column names into new columns.
Column names are joined using \texttt{:concat-value-with} option.
\texttt{:concat-value-with} can be a string or function (default:
``-''). Function accepts current column name and value.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Use \texttt{station} as a name source for columns and \texttt{seen} for
values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ fish }\NormalTok{(api/dataset }\StringTok{"data/fish_encounters.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fish}
\end{Highlighting}
\end{Shaded}

data/fish\_encounters.csv {[}114 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
fish & station & seen\tabularnewline
\midrule
\endhead
4842 & Release & 1\tabularnewline
4842 & I80\_1 & 1\tabularnewline
4842 & Lisbon & 1\tabularnewline
4842 & Rstr & 1\tabularnewline
4842 & Base\_TD & 1\tabularnewline
4842 & BCE & 1\tabularnewline
4842 & BCW & 1\tabularnewline
4842 & BCE2 & 1\tabularnewline
4842 & BCW2 & 1\tabularnewline
4842 & MAE & 1\tabularnewline
4842 & MAW & 1\tabularnewline
4843 & Release & 1\tabularnewline
4843 & I80\_1 & 1\tabularnewline
4843 & Lisbon & 1\tabularnewline
4843 & Rstr & 1\tabularnewline
4843 & Base\_TD & 1\tabularnewline
4843 & BCE & 1\tabularnewline
4843 & BCW & 1\tabularnewline
4843 & BCE2 & 1\tabularnewline
4843 & BCW2 & 1\tabularnewline
4843 & MAE & 1\tabularnewline
4843 & MAW & 1\tabularnewline
4844 & Release & 1\tabularnewline
4844 & I80\_1 & 1\tabularnewline
4844 & Lisbon & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider fish }\StringTok{"station"} \StringTok{"seen"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

data/fish\_encounters.csv {[}19 12{]}:

\begin{longtable}[]{@{}llllllllllll@{}}
\toprule
fish & Rstr & Base\_TD & I80\_1 & Release & MAE & BCE2 & MAW & BCW2 &
BCE & Lisbon & BCW\tabularnewline
\midrule
\endhead
4842 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\tabularnewline
4843 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\tabularnewline
4844 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\tabularnewline
4850 & 1 & 1 & 1 & 1 & & & & & 1 & & 1\tabularnewline
4857 & 1 & 1 & 1 & 1 & & 1 & & 1 & 1 & 1 & 1\tabularnewline
4858 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\tabularnewline
4861 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\tabularnewline
4862 & 1 & 1 & 1 & 1 & & 1 & & 1 & 1 & 1 & 1\tabularnewline
4864 & & & 1 & 1 & & & & & & &\tabularnewline
4865 & & & 1 & 1 & & & & & & 1 &\tabularnewline
4845 & 1 & 1 & 1 & 1 & & & & & & 1 &\tabularnewline
4847 & & & 1 & 1 & & & & & & 1 &\tabularnewline
4848 & 1 & & 1 & 1 & & & & & & 1 &\tabularnewline
4849 & & & 1 & 1 & & & & & & &\tabularnewline
4851 & & & 1 & 1 & & & & & & &\tabularnewline
4854 & & & 1 & 1 & & & & & & &\tabularnewline
4855 & 1 & 1 & 1 & 1 & & & & & & 1 &\tabularnewline
4859 & 1 & 1 & 1 & 1 & & & & & & 1 &\tabularnewline
4863 & & & 1 & 1 & & & & & & &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

If selected columns contain multiple values, such values should be
folded.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ warpbreaks }\NormalTok{(api/dataset }\StringTok{"data/warpbreaks.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{warpbreaks}
\end{Highlighting}
\end{Shaded}

data/warpbreaks.csv {[}54 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
breaks & wool & tension\tabularnewline
\midrule
\endhead
26 & A & L\tabularnewline
30 & A & L\tabularnewline
54 & A & L\tabularnewline
25 & A & L\tabularnewline
70 & A & L\tabularnewline
52 & A & L\tabularnewline
51 & A & L\tabularnewline
26 & A & L\tabularnewline
67 & A & L\tabularnewline
18 & A & M\tabularnewline
21 & A & M\tabularnewline
29 & A & M\tabularnewline
17 & A & M\tabularnewline
12 & A & M\tabularnewline
18 & A & M\tabularnewline
35 & A & M\tabularnewline
30 & A & M\tabularnewline
36 & A & M\tabularnewline
36 & A & H\tabularnewline
21 & A & H\tabularnewline
24 & A & H\tabularnewline
18 & A & H\tabularnewline
10 & A & H\tabularnewline
43 & A & H\tabularnewline
28 & A & H\tabularnewline
\bottomrule
\end{longtable}

Let's see how many values are for each type of \texttt{wool} and
\texttt{tension} groups

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ warpbreaks}
\NormalTok{    (api/group-by [}\StringTok{"wool"} \StringTok{"tension"}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:n}\NormalTok{ api/row-count\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
wool & tension & :n\tabularnewline
\midrule
\endhead
A & H & 9\tabularnewline
B & H & 9\tabularnewline
A & L & 9\tabularnewline
A & M & 9\tabularnewline
B & L & 9\tabularnewline
B & M & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ warpbreaks}
\NormalTok{    (api/reorder-columns [}\StringTok{"wool"} \StringTok{"tension"} \StringTok{"breaks"}\NormalTok{])}
\NormalTok{    (api/pivot->wider }\StringTok{"wool"} \StringTok{"breaks"}\NormalTok{ \{}\AttributeTok{:fold-fn} \KeywordTok{vec}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

data/warpbreaks.csv {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
tension & B & A\tabularnewline
\midrule
\endhead
M & {[}42 26 19 16 39 28 21 39 29{]} & {[}18 21 29 17 12 18 35 30
36{]}\tabularnewline
H & {[}20 21 24 17 13 15 15 16 28{]} & {[}36 21 24 18 10 43 28 15
26{]}\tabularnewline
L & {[}27 14 29 19 29 31 41 20 44{]} & {[}26 30 54 25 70 52 51 26
67{]}\tabularnewline
\bottomrule
\end{longtable}

We can also calculate mean (aggreate values)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ warpbreaks}
\NormalTok{    (api/reorder-columns [}\StringTok{"wool"} \StringTok{"tension"} \StringTok{"breaks"}\NormalTok{])}
\NormalTok{    (api/pivot->wider }\StringTok{"wool"} \StringTok{"breaks"}\NormalTok{ \{}\AttributeTok{:fold-fn}\NormalTok{ tech.v2.datatype.functional/mean\}))}
\end{Highlighting}
\end{Shaded}

data/warpbreaks.csv {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
tension & B & A\tabularnewline
\midrule
\endhead
H & 18.78 & 24.56\tabularnewline
M & 28.78 & 24.00\tabularnewline
L & 28.22 & 44.56\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Multiple source columns, joined with default separator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ production }\NormalTok{(api/dataset }\StringTok{"data/production.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{production}
\end{Highlighting}
\end{Shaded}

data/production.csv {[}45 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
product & country & year & production\tabularnewline
\midrule
\endhead
A & AI & 2000 & 1.637\tabularnewline
A & AI & 2001 & 0.1587\tabularnewline
A & AI & 2002 & -1.568\tabularnewline
A & AI & 2003 & -0.4446\tabularnewline
A & AI & 2004 & -0.07134\tabularnewline
A & AI & 2005 & 1.612\tabularnewline
A & AI & 2006 & -0.7043\tabularnewline
A & AI & 2007 & -1.536\tabularnewline
A & AI & 2008 & 0.8391\tabularnewline
A & AI & 2009 & -0.3742\tabularnewline
A & AI & 2010 & -0.7116\tabularnewline
A & AI & 2011 & 1.128\tabularnewline
A & AI & 2012 & 1.457\tabularnewline
A & AI & 2013 & -1.559\tabularnewline
A & AI & 2014 & -0.1170\tabularnewline
B & AI & 2000 & -0.02618\tabularnewline
B & AI & 2001 & -0.6886\tabularnewline
B & AI & 2002 & 0.06249\tabularnewline
B & AI & 2003 & -0.7234\tabularnewline
B & AI & 2004 & 0.4725\tabularnewline
B & AI & 2005 & -0.9417\tabularnewline
B & AI & 2006 & -0.3478\tabularnewline
B & AI & 2007 & 0.5243\tabularnewline
B & AI & 2008 & 1.832\tabularnewline
B & AI & 2009 & 0.1071\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider production [}\StringTok{"product"} \StringTok{"country"}\NormalTok{] }\StringTok{"production"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

data/production.csv {[}15 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
year & A\_AI & B\_EI & B\_AI\tabularnewline
\midrule
\endhead
2000 & 1.637 & 1.405 & -0.02618\tabularnewline
2001 & 0.1587 & -0.5962 & -0.6886\tabularnewline
2002 & -1.568 & -0.2657 & 0.06249\tabularnewline
2003 & -0.4446 & 0.6526 & -0.7234\tabularnewline
2004 & -0.07134 & 0.6256 & 0.4725\tabularnewline
2005 & 1.612 & -1.345 & -0.9417\tabularnewline
2006 & -0.7043 & -0.9718 & -0.3478\tabularnewline
2007 & -1.536 & -1.697 & 0.5243\tabularnewline
2008 & 0.8391 & 0.04556 & 1.832\tabularnewline
2009 & -0.3742 & 1.193 & 0.1071\tabularnewline
2010 & -0.7116 & -1.606 & -0.3290\tabularnewline
2011 & 1.128 & -0.7724 & -1.783\tabularnewline
2012 & 1.457 & -2.503 & 0.6113\tabularnewline
2013 & -1.559 & -1.628 & -0.7853\tabularnewline
2014 & -0.1170 & 0.03330 & 0.9784\tabularnewline
\bottomrule
\end{longtable}

Joined with custom function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider production [}\StringTok{"product"} \StringTok{"country"}\NormalTok{] }\StringTok{"production"}\NormalTok{ \{}\AttributeTok{:concat-columns-with} \KeywordTok{vec}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

data/production.csv {[}15 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
year & {[}``A'' ``AI''{]} & {[}``B'' ``EI''{]} & {[}``B''
``AI''{]}\tabularnewline
\midrule
\endhead
2000 & 1.637 & 1.405 & -0.02618\tabularnewline
2001 & 0.1587 & -0.5962 & -0.6886\tabularnewline
2002 & -1.568 & -0.2657 & 0.06249\tabularnewline
2003 & -0.4446 & 0.6526 & -0.7234\tabularnewline
2004 & -0.07134 & 0.6256 & 0.4725\tabularnewline
2005 & 1.612 & -1.345 & -0.9417\tabularnewline
2006 & -0.7043 & -0.9718 & -0.3478\tabularnewline
2007 & -1.536 & -1.697 & 0.5243\tabularnewline
2008 & 0.8391 & 0.04556 & 1.832\tabularnewline
2009 & -0.3742 & 1.193 & 0.1071\tabularnewline
2010 & -0.7116 & -1.606 & -0.3290\tabularnewline
2011 & 1.128 & -0.7724 & -1.783\tabularnewline
2012 & 1.457 & -2.503 & 0.6113\tabularnewline
2013 & -1.559 & -1.628 & -0.7853\tabularnewline
2014 & -0.1170 & 0.03330 & 0.9784\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Multiple value columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ income }\NormalTok{(api/dataset }\StringTok{"data/us_rent_income.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{income}
\end{Highlighting}
\end{Shaded}

data/us\_rent\_income.csv {[}104 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
GEOID & NAME & variable & estimate & moe\tabularnewline
\midrule
\endhead
1 & Alabama & income & 24476 & 136\tabularnewline
1 & Alabama & rent & 747 & 3\tabularnewline
2 & Alaska & income & 32940 & 508\tabularnewline
2 & Alaska & rent & 1200 & 13\tabularnewline
4 & Arizona & income & 27517 & 148\tabularnewline
4 & Arizona & rent & 972 & 4\tabularnewline
5 & Arkansas & income & 23789 & 165\tabularnewline
5 & Arkansas & rent & 709 & 5\tabularnewline
6 & California & income & 29454 & 109\tabularnewline
6 & California & rent & 1358 & 3\tabularnewline
8 & Colorado & income & 32401 & 109\tabularnewline
8 & Colorado & rent & 1125 & 5\tabularnewline
9 & Connecticut & income & 35326 & 195\tabularnewline
9 & Connecticut & rent & 1123 & 5\tabularnewline
10 & Delaware & income & 31560 & 247\tabularnewline
10 & Delaware & rent & 1076 & 10\tabularnewline
11 & District of Columbia & income & 43198 & 681\tabularnewline
11 & District of Columbia & rent & 1424 & 17\tabularnewline
12 & Florida & income & 25952 & 70\tabularnewline
12 & Florida & rent & 1077 & 3\tabularnewline
13 & Georgia & income & 27024 & 106\tabularnewline
13 & Georgia & rent & 927 & 3\tabularnewline
15 & Hawaii & income & 32453 & 218\tabularnewline
15 & Hawaii & rent & 1507 & 18\tabularnewline
16 & Idaho & income & 25298 & 208\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider income }\StringTok{"variable"}\NormalTok{ [}\StringTok{"estimate"} \StringTok{"moe"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

data/us\_rent\_income.csv {[}52 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
GEOID & NAME & estimate-rent & moe-rent & estimate-income &
moe-income\tabularnewline
\midrule
\endhead
1 & Alabama & 747 & 3 & 24476 & 136\tabularnewline
2 & Alaska & 1200 & 13 & 32940 & 508\tabularnewline
4 & Arizona & 972 & 4 & 27517 & 148\tabularnewline
5 & Arkansas & 709 & 5 & 23789 & 165\tabularnewline
6 & California & 1358 & 3 & 29454 & 109\tabularnewline
8 & Colorado & 1125 & 5 & 32401 & 109\tabularnewline
9 & Connecticut & 1123 & 5 & 35326 & 195\tabularnewline
10 & Delaware & 1076 & 10 & 31560 & 247\tabularnewline
11 & District of Columbia & 1424 & 17 & 43198 & 681\tabularnewline
12 & Florida & 1077 & 3 & 25952 & 70\tabularnewline
13 & Georgia & 927 & 3 & 27024 & 106\tabularnewline
15 & Hawaii & 1507 & 18 & 32453 & 218\tabularnewline
16 & Idaho & 792 & 7 & 25298 & 208\tabularnewline
17 & Illinois & 952 & 3 & 30684 & 83\tabularnewline
18 & Indiana & 782 & 3 & 27247 & 117\tabularnewline
19 & Iowa & 740 & 4 & 30002 & 143\tabularnewline
20 & Kansas & 801 & 5 & 29126 & 208\tabularnewline
21 & Kentucky & 713 & 4 & 24702 & 159\tabularnewline
22 & Louisiana & 825 & 4 & 25086 & 155\tabularnewline
23 & Maine & 808 & 7 & 26841 & 187\tabularnewline
24 & Maryland & 1311 & 5 & 37147 & 152\tabularnewline
25 & Massachusetts & 1173 & 5 & 34498 & 199\tabularnewline
26 & Michigan & 824 & 3 & 26987 & 82\tabularnewline
27 & Minnesota & 906 & 4 & 32734 & 189\tabularnewline
28 & Mississippi & 740 & 5 & 22766 & 194\tabularnewline
\bottomrule
\end{longtable}

Value concatenated by custom function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider income }\StringTok{"variable"}\NormalTok{ [}\StringTok{"estimate"} \StringTok{"moe"}\NormalTok{] \{}\AttributeTok{:concat-columns-with} \KeywordTok{vec}
                                                        \AttributeTok{:concat-value-with} \KeywordTok{vector}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

data/us\_rent\_income.csv {[}52 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
GEOID & NAME & {[}``rent'' ``estimate''{]} & {[}``rent'' ``moe''{]} &
{[}``income'' ``estimate''{]} & {[}``income'' ``moe''{]}\tabularnewline
\midrule
\endhead
1 & Alabama & 747 & 3 & 24476 & 136\tabularnewline
2 & Alaska & 1200 & 13 & 32940 & 508\tabularnewline
4 & Arizona & 972 & 4 & 27517 & 148\tabularnewline
5 & Arkansas & 709 & 5 & 23789 & 165\tabularnewline
6 & California & 1358 & 3 & 29454 & 109\tabularnewline
8 & Colorado & 1125 & 5 & 32401 & 109\tabularnewline
9 & Connecticut & 1123 & 5 & 35326 & 195\tabularnewline
10 & Delaware & 1076 & 10 & 31560 & 247\tabularnewline
11 & District of Columbia & 1424 & 17 & 43198 & 681\tabularnewline
12 & Florida & 1077 & 3 & 25952 & 70\tabularnewline
13 & Georgia & 927 & 3 & 27024 & 106\tabularnewline
15 & Hawaii & 1507 & 18 & 32453 & 218\tabularnewline
16 & Idaho & 792 & 7 & 25298 & 208\tabularnewline
17 & Illinois & 952 & 3 & 30684 & 83\tabularnewline
18 & Indiana & 782 & 3 & 27247 & 117\tabularnewline
19 & Iowa & 740 & 4 & 30002 & 143\tabularnewline
20 & Kansas & 801 & 5 & 29126 & 208\tabularnewline
21 & Kentucky & 713 & 4 & 24702 & 159\tabularnewline
22 & Louisiana & 825 & 4 & 25086 & 155\tabularnewline
23 & Maine & 808 & 7 & 26841 & 187\tabularnewline
24 & Maryland & 1311 & 5 & 37147 & 152\tabularnewline
25 & Massachusetts & 1173 & 5 & 34498 & 199\tabularnewline
26 & Michigan & 824 & 3 & 26987 & 82\tabularnewline
27 & Minnesota & 906 & 4 & 32734 & 189\tabularnewline
28 & Mississippi & 740 & 5 & 22766 & 194\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Reshape contact data

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ contacts }\NormalTok{(api/dataset }\StringTok{"data/contacts.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{contacts}
\end{Highlighting}
\end{Shaded}

data/contacts.csv {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
field & value & person\_id\tabularnewline
\midrule
\endhead
name & Jiena McLellan & 1\tabularnewline
company & Toyota & 1\tabularnewline
name & John Smith & 2\tabularnewline
company & google & 2\tabularnewline
email & \href{mailto:john@google.com}{\nolinkurl{john@google.com}} &
2\tabularnewline
name & Huxley Ratcliffe & 3\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider contacts }\StringTok{"field"} \StringTok{"value"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

data/contacts.csv {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
person\_id & email & name & company\tabularnewline
\midrule
\endhead
1 & & Jiena McLellan & Toyota\tabularnewline
2 & \href{mailto:john@google.com}{\nolinkurl{john@google.com}} & John
Smith & google\tabularnewline
3 & & Huxley Ratcliffe &\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Reshaping}\label{reshaping}

A couple of \texttt{tidyr} examples of more complex reshaping.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\href{https://tidyr.tidyverse.org/articles/pivot.html\#world-bank}{World
bank}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ world-bank-pop }\NormalTok{(api/dataset }\StringTok{"data/world_bank_pop.csv.gz"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>}\NormalTok{ world-bank-pop}
\NormalTok{     (api/column-names)}
\NormalTok{     (}\KeywordTok{take} \DecValTok{8}\NormalTok{)}
\NormalTok{     (api/select-columns world-bank-pop))}
\end{Highlighting}
\end{Shaded}

data/world\_bank\_pop.csv.gz {[}1056 8{]}:

\begin{longtable}[]{@{}llllllll@{}}
\toprule
country & indicator & 2000 & 2001 & 2002 & 2003 & 2004 &
2005\tabularnewline
\midrule
\endhead
ABW & SP.URB.TOTL & 4.244E+04 & 4.305E+04 & 4.367E+04 & 4.425E+04 &
4.467E+04 & 4.489E+04\tabularnewline
ABW & SP.URB.GROW & 1.183 & 1.413 & 1.435 & 1.310 & 0.9515 &
0.4913\tabularnewline
ABW & SP.POP.TOTL & 9.085E+04 & 9.290E+04 & 9.499E+04 & 9.702E+04 &
9.874E+04 & 1.000E+05\tabularnewline
ABW & SP.POP.GROW & 2.055 & 2.226 & 2.229 & 2.109 & 1.757 &
1.302\tabularnewline
AFG & SP.URB.TOTL & 4.436E+06 & 4.648E+06 & 4.893E+06 & 5.156E+06 &
5.427E+06 & 5.692E+06\tabularnewline
AFG & SP.URB.GROW & 3.912 & 4.663 & 5.135 & 5.230 & 5.124 &
4.769\tabularnewline
AFG & SP.POP.TOTL & 2.009E+07 & 2.097E+07 & 2.198E+07 & 2.306E+07 &
2.412E+07 & 2.507E+07\tabularnewline
AFG & SP.POP.GROW & 3.495 & 4.252 & 4.721 & 4.818 & 4.469 &
3.870\tabularnewline
AGO & SP.URB.TOTL & 8.235E+06 & 8.708E+06 & 9.219E+06 & 9.765E+06 &
1.034E+07 & 1.095E+07\tabularnewline
AGO & SP.URB.GROW & 5.437 & 5.588 & 5.700 & 5.758 & 5.753 &
5.693\tabularnewline
AGO & SP.POP.TOTL & 1.644E+07 & 1.698E+07 & 1.757E+07 & 1.820E+07 &
1.887E+07 & 1.955E+07\tabularnewline
AGO & SP.POP.GROW & 3.033 & 3.245 & 3.412 & 3.526 & 3.574 &
3.576\tabularnewline
ALB & SP.URB.TOTL & 1.289E+06 & 1.299E+06 & 1.327E+06 & 1.355E+06 &
1.382E+06 & 1.407E+06\tabularnewline
ALB & SP.URB.GROW & 0.7425 & 0.7104 & 2.181 & 2.060 & 1.972 &
1.826\tabularnewline
ALB & SP.POP.TOTL & 3.089E+06 & 3.060E+06 & 3.051E+06 & 3.040E+06 &
3.027E+06 & 3.011E+06\tabularnewline
ALB & SP.POP.GROW & -0.6374 & -0.9385 & -0.2999 & -0.3741 & -0.4179 &
-0.5118\tabularnewline
AND & SP.URB.TOTL & 6.042E+04 & 6.199E+04 & 6.419E+04 & 6.675E+04 &
6.919E+04 & 7.121E+04\tabularnewline
AND & SP.URB.GROW & 1.279 & 2.572 & 3.492 & 3.900 & 3.598 &
2.868\tabularnewline
AND & SP.POP.TOTL & 6.539E+04 & 6.734E+04 & 7.005E+04 & 7.318E+04 &
7.624E+04 & 7.887E+04\tabularnewline
AND & SP.POP.GROW & 1.572 & 2.940 & 3.943 & 4.375 & 4.099 &
3.382\tabularnewline
ARB & SP.URB.TOTL & 1.500E+08 & 1.539E+08 & 1.580E+08 & 1.623E+08 &
1.668E+08 & 1.718E+08\tabularnewline
ARB & SP.URB.GROW & 2.600 & 2.629 & 2.639 & 2.710 & 2.806 &
2.993\tabularnewline
ARB & SP.POP.TOTL & 2.838E+08 & 2.899E+08 & 2.960E+08 & 3.024E+08 &
3.092E+08 & 3.163E+08\tabularnewline
ARB & SP.POP.GROW & 2.111 & 2.120 & 2.131 & 2.165 & 2.224 &
2.297\tabularnewline
ARE & SP.URB.TOTL & 2.531E+06 & 2.683E+06 & 2.843E+06 & 3.049E+06 &
3.347E+06 & 3.767E+06\tabularnewline
\bottomrule
\end{longtable}

Step 1 - convert years column into values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ pop2 }\NormalTok{(api/pivot->longer world-bank-pop (}\KeywordTok{map} \KeywordTok{str}\NormalTok{ (}\KeywordTok{range} \DecValTok{2000} \DecValTok{2018}\NormalTok{)) \{}\AttributeTok{:drop-missing}\NormalTok{? }\VariableTok{false}
                                                                         \AttributeTok{:target-columns}\NormalTok{ [}\StringTok{"year"}\NormalTok{]}
                                                                         \AttributeTok{:value-column-name} \StringTok{"value"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pop2}
\end{Highlighting}
\end{Shaded}

data/world\_bank\_pop.csv.gz {[}19008 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
country & indicator & year & value\tabularnewline
\midrule
\endhead
ABW & SP.URB.TOTL & 2013 & 4.436E+04\tabularnewline
ABW & SP.URB.GROW & 2013 & 0.6695\tabularnewline
ABW & SP.POP.TOTL & 2013 & 1.032E+05\tabularnewline
ABW & SP.POP.GROW & 2013 & 0.5929\tabularnewline
AFG & SP.URB.TOTL & 2013 & 7.734E+06\tabularnewline
AFG & SP.URB.GROW & 2013 & 4.193\tabularnewline
AFG & SP.POP.TOTL & 2013 & 3.173E+07\tabularnewline
AFG & SP.POP.GROW & 2013 & 3.315\tabularnewline
AGO & SP.URB.TOTL & 2013 & 1.612E+07\tabularnewline
AGO & SP.URB.GROW & 2013 & 4.723\tabularnewline
AGO & SP.POP.TOTL & 2013 & 2.600E+07\tabularnewline
AGO & SP.POP.GROW & 2013 & 3.532\tabularnewline
ALB & SP.URB.TOTL & 2013 & 1.604E+06\tabularnewline
ALB & SP.URB.GROW & 2013 & 1.744\tabularnewline
ALB & SP.POP.TOTL & 2013 & 2.895E+06\tabularnewline
ALB & SP.POP.GROW & 2013 & -0.1832\tabularnewline
AND & SP.URB.TOTL & 2013 & 7.153E+04\tabularnewline
AND & SP.URB.GROW & 2013 & -2.119\tabularnewline
AND & SP.POP.TOTL & 2013 & 8.079E+04\tabularnewline
AND & SP.POP.GROW & 2013 & -2.013\tabularnewline
ARB & SP.URB.TOTL & 2013 & 2.186E+08\tabularnewline
ARB & SP.URB.GROW & 2013 & 2.783\tabularnewline
ARB & SP.POP.TOTL & 2013 & 3.817E+08\tabularnewline
ARB & SP.POP.GROW & 2013 & 2.249\tabularnewline
ARE & SP.URB.TOTL & 2013 & 7.661E+06\tabularnewline
\bottomrule
\end{longtable}

Step 2 - separate \texttt{"indicate"} column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ pop3 }\NormalTok{(api/separate-column pop2}
                               \StringTok{"indicator"}\NormalTok{ [}\StringTok{"area"} \StringTok{"variable"}\NormalTok{]}
\NormalTok{                               #(}\KeywordTok{rest}\NormalTok{ (clojure.string/split }\VariableTok{%} \SpecialStringTok{#"\textbackslash{}."}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pop3}
\end{Highlighting}
\end{Shaded}

data/world\_bank\_pop.csv.gz {[}19008 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
country & area & variable & year & value\tabularnewline
\midrule
\endhead
ABW & URB & TOTL & 2013 & 4.436E+04\tabularnewline
ABW & URB & GROW & 2013 & 0.6695\tabularnewline
ABW & POP & TOTL & 2013 & 1.032E+05\tabularnewline
ABW & POP & GROW & 2013 & 0.5929\tabularnewline
AFG & URB & TOTL & 2013 & 7.734E+06\tabularnewline
AFG & URB & GROW & 2013 & 4.193\tabularnewline
AFG & POP & TOTL & 2013 & 3.173E+07\tabularnewline
AFG & POP & GROW & 2013 & 3.315\tabularnewline
AGO & URB & TOTL & 2013 & 1.612E+07\tabularnewline
AGO & URB & GROW & 2013 & 4.723\tabularnewline
AGO & POP & TOTL & 2013 & 2.600E+07\tabularnewline
AGO & POP & GROW & 2013 & 3.532\tabularnewline
ALB & URB & TOTL & 2013 & 1.604E+06\tabularnewline
ALB & URB & GROW & 2013 & 1.744\tabularnewline
ALB & POP & TOTL & 2013 & 2.895E+06\tabularnewline
ALB & POP & GROW & 2013 & -0.1832\tabularnewline
AND & URB & TOTL & 2013 & 7.153E+04\tabularnewline
AND & URB & GROW & 2013 & -2.119\tabularnewline
AND & POP & TOTL & 2013 & 8.079E+04\tabularnewline
AND & POP & GROW & 2013 & -2.013\tabularnewline
ARB & URB & TOTL & 2013 & 2.186E+08\tabularnewline
ARB & URB & GROW & 2013 & 2.783\tabularnewline
ARB & POP & TOTL & 2013 & 3.817E+08\tabularnewline
ARB & POP & GROW & 2013 & 2.249\tabularnewline
ARE & URB & TOTL & 2013 & 7.661E+06\tabularnewline
\bottomrule
\end{longtable}

Step 3 - Make columns based on \texttt{"variable"} values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider pop3 }\StringTok{"variable"} \StringTok{"value"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

data/world\_bank\_pop.csv.gz {[}9504 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
country & area & year & GROW & TOTL\tabularnewline
\midrule
\endhead
ABW & URB & 2013 & 0.6695 & 4.436E+04\tabularnewline
ABW & POP & 2013 & 0.5929 & 1.032E+05\tabularnewline
AFG & URB & 2013 & 4.193 & 7.734E+06\tabularnewline
AFG & POP & 2013 & 3.315 & 3.173E+07\tabularnewline
AGO & URB & 2013 & 4.723 & 1.612E+07\tabularnewline
AGO & POP & 2013 & 3.532 & 2.600E+07\tabularnewline
ALB & URB & 2013 & 1.744 & 1.604E+06\tabularnewline
ALB & POP & 2013 & -0.1832 & 2.895E+06\tabularnewline
AND & URB & 2013 & -2.119 & 7.153E+04\tabularnewline
AND & POP & 2013 & -2.013 & 8.079E+04\tabularnewline
ARB & URB & 2013 & 2.783 & 2.186E+08\tabularnewline
ARB & POP & 2013 & 2.249 & 3.817E+08\tabularnewline
ARE & URB & 2013 & 1.555 & 7.661E+06\tabularnewline
ARE & POP & 2013 & 1.182 & 9.006E+06\tabularnewline
ARG & URB & 2013 & 1.188 & 3.882E+07\tabularnewline
ARG & POP & 2013 & 1.047 & 4.254E+07\tabularnewline
ARM & URB & 2013 & 0.2810 & 1.828E+06\tabularnewline
ARM & POP & 2013 & 0.4013 & 2.894E+06\tabularnewline
ASM & URB & 2013 & 0.05798 & 4.831E+04\tabularnewline
ASM & POP & 2013 & 0.1393 & 5.531E+04\tabularnewline
ATG & URB & 2013 & 0.3838 & 2.480E+04\tabularnewline
ATG & POP & 2013 & 1.076 & 9.782E+04\tabularnewline
AUS & URB & 2013 & 1.875 & 1.979E+07\tabularnewline
AUS & POP & 2013 & 1.758 & 2.315E+07\tabularnewline
AUT & URB & 2013 & 0.9196 & 4.862E+06\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\href{https://tidyr.tidyverse.org/articles/pivot.html\#multi-choice}{Multi-choice}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ multi }\NormalTok{(api/dataset \{}\AttributeTok{:id}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{3} \DecValTok{4}\NormalTok{]}
                         \AttributeTok{:choice1}\NormalTok{ [}\StringTok{"A"} \StringTok{"C"} \StringTok{"D"} \StringTok{"B"}\NormalTok{]}
                         \AttributeTok{:choice2}\NormalTok{ [}\StringTok{"B"} \StringTok{"B"} \VariableTok{nil} \StringTok{"D"}\NormalTok{]}
                         \AttributeTok{:choice3}\NormalTok{ [}\StringTok{"C"} \VariableTok{nil} \VariableTok{nil} \VariableTok{nil}\NormalTok{]\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{multi}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:id & :choice1 & :choice2 & :choice3\tabularnewline
\midrule
\endhead
1 & A & B & C\tabularnewline
2 & C & B &\tabularnewline
3 & D & &\tabularnewline
4 & B & D &\tabularnewline
\bottomrule
\end{longtable}

Step 1 - convert all choices into rows and add artificial column to all
values which are not missing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ multi2 }\NormalTok{(}\KeywordTok{->}\NormalTok{ multi}
\NormalTok{                (api/pivot->longer (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:id}\NormalTok{\}))}
\NormalTok{                (api/add-or-update-column }\AttributeTok{:checked} \VariableTok{true}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{multi2}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}8 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:id & :\$column & :\$value & :checked\tabularnewline
\midrule
\endhead
1 & :choice1 & A & true\tabularnewline
2 & :choice1 & C & true\tabularnewline
3 & :choice1 & D & true\tabularnewline
4 & :choice1 & B & true\tabularnewline
1 & :choice2 & B & true\tabularnewline
2 & :choice2 & B & true\tabularnewline
4 & :choice2 & D & true\tabularnewline
1 & :choice3 & C & true\tabularnewline
\bottomrule
\end{longtable}

Step 2 - Convert back to wide form with actual choices as columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ multi2}
\NormalTok{    (api/drop-columns :$column)}
\NormalTok{    (api/pivot->wider :$value }\AttributeTok{:checked}\NormalTok{ \{}\AttributeTok{:drop-missing}\NormalTok{? }\VariableTok{false}\NormalTok{\})}
\NormalTok{    (api/order-by }\AttributeTok{:id}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:id & A & B & C & D\tabularnewline
\midrule
\endhead
1 & true & true & true &\tabularnewline
2 & & true & true &\tabularnewline
3 & & & & true\tabularnewline
4 & & true & & true\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\href{https://tidyr.tidyverse.org/articles/pivot.html\#by-hand}{Construction}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ construction }\NormalTok{(api/dataset }\StringTok{"data/construction.csv"}\NormalTok{))}
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ construction-unit-map }\NormalTok{\{}\StringTok{"1 unit"} \StringTok{"1"}
                            \StringTok{"2 to 4 units"} \StringTok{"2-4"}
                            \StringTok{"5 units or more"} \StringTok{"5+"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{construction}
\end{Highlighting}
\end{Shaded}

data/construction.csv {[}9 9{]}:

\begin{longtable}[]{@{}lllllllll@{}}
\toprule
Year & Month & 1 unit & 2 to 4 units & 5 units or more & Northeast &
Midwest & South & West\tabularnewline
\midrule
\endhead
2018 & January & 859 & & 348 & 114 & 169 & 596 & 339\tabularnewline
2018 & February & 882 & & 400 & 138 & 160 & 655 & 336\tabularnewline
2018 & March & 862 & & 356 & 150 & 154 & 595 & 330\tabularnewline
2018 & April & 797 & & 447 & 144 & 196 & 613 & 304\tabularnewline
2018 & May & 875 & & 364 & 90 & 169 & 673 & 319\tabularnewline
2018 & June & 867 & & 342 & 76 & 170 & 610 & 360\tabularnewline
2018 & July & 829 & & 360 & 108 & 183 & 594 & 310\tabularnewline
2018 & August & 939 & & 286 & 90 & 205 & 649 & 286\tabularnewline
2018 & September & 835 & & 304 & 117 & 175 & 560 & 296\tabularnewline
\bottomrule
\end{longtable}

Conversion 1 - Group two column types

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ construction}
\NormalTok{    (api/pivot->longer }\SpecialStringTok{#"^[125NWS].*|Midwest"}\NormalTok{ \{}\AttributeTok{:target-columns}\NormalTok{ [}\AttributeTok{:units} \AttributeTok{:region}\NormalTok{]}
                                               \AttributeTok{:splitter}\NormalTok{ (}\KeywordTok{fn}\NormalTok{ [col-name]}
\NormalTok{                                                           (}\KeywordTok{if}\NormalTok{ (}\KeywordTok{re-matches} \SpecialStringTok{#"^[125].*"}\NormalTok{ col-name)}
\NormalTok{                                                             [(construction-unit-map col-name) }\VariableTok{nil}\NormalTok{]}
\NormalTok{                                                             [}\VariableTok{nil}\NormalTok{ col-name]))}
                                               \AttributeTok{:value-column-name} \AttributeTok{:n}
                                               \AttributeTok{:drop-missing}\NormalTok{? }\VariableTok{false}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

data/construction.csv {[}63 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
Year & Month & :units & :region & :n\tabularnewline
\midrule
\endhead
2018 & January & 1 & & 859\tabularnewline
2018 & February & 1 & & 882\tabularnewline
2018 & March & 1 & & 862\tabularnewline
2018 & April & 1 & & 797\tabularnewline
2018 & May & 1 & & 875\tabularnewline
2018 & June & 1 & & 867\tabularnewline
2018 & July & 1 & & 829\tabularnewline
2018 & August & 1 & & 939\tabularnewline
2018 & September & 1 & & 835\tabularnewline
2018 & January & 2-4 & &\tabularnewline
2018 & February & 2-4 & &\tabularnewline
2018 & March & 2-4 & &\tabularnewline
2018 & April & 2-4 & &\tabularnewline
2018 & May & 2-4 & &\tabularnewline
2018 & June & 2-4 & &\tabularnewline
2018 & July & 2-4 & &\tabularnewline
2018 & August & 2-4 & &\tabularnewline
2018 & September & 2-4 & &\tabularnewline
2018 & January & 5+ & & 348\tabularnewline
2018 & February & 5+ & & 400\tabularnewline
2018 & March & 5+ & & 356\tabularnewline
2018 & April & 5+ & & 447\tabularnewline
2018 & May & 5+ & & 364\tabularnewline
2018 & June & 5+ & & 342\tabularnewline
2018 & July & 5+ & & 360\tabularnewline
\bottomrule
\end{longtable}

Conversion 2 - Convert to longer form and back and rename columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ construction}
\NormalTok{    (api/pivot->longer }\SpecialStringTok{#"^[125NWS].*|Midwest"}\NormalTok{ \{}\AttributeTok{:target-columns}\NormalTok{ [}\AttributeTok{:units} \AttributeTok{:region}\NormalTok{]}
                                               \AttributeTok{:splitter}\NormalTok{ (}\KeywordTok{fn}\NormalTok{ [col-name]}
\NormalTok{                                                           (}\KeywordTok{if}\NormalTok{ (}\KeywordTok{re-matches} \SpecialStringTok{#"^[125].*"}\NormalTok{ col-name)}
\NormalTok{                                                             [(construction-unit-map col-name) }\VariableTok{nil}\NormalTok{]}
\NormalTok{                                                             [}\VariableTok{nil}\NormalTok{ col-name]))}
                                               \AttributeTok{:value-column-name} \AttributeTok{:n}
                                               \AttributeTok{:drop-missing}\NormalTok{? }\VariableTok{false}\NormalTok{\})}
\NormalTok{    (api/pivot->wider [}\AttributeTok{:units} \AttributeTok{:region}\NormalTok{] }\AttributeTok{:n}\NormalTok{)}
\NormalTok{    (api/rename-columns (}\KeywordTok{zipmap}\NormalTok{ (}\KeywordTok{vals}\NormalTok{ construction-unit-map)}
\NormalTok{                                (}\KeywordTok{keys}\NormalTok{ construction-unit-map))))}
\end{Highlighting}
\end{Shaded}

data/construction.csv {[}9 9{]}:

\begin{longtable}[]{@{}lllllllll@{}}
\toprule
Year & Month & Midwest & 5 units or more & 2 to 4 units & Northeast &
South & 1 unit & West\tabularnewline
\midrule
\endhead
2018 & January & 169 & 348 & & 114 & 596 & 859 & 339\tabularnewline
2018 & February & 160 & 400 & & 138 & 655 & 882 & 336\tabularnewline
2018 & March & 154 & 356 & & 150 & 595 & 862 & 330\tabularnewline
2018 & April & 196 & 447 & & 144 & 613 & 797 & 304\tabularnewline
2018 & May & 169 & 364 & & 90 & 673 & 875 & 319\tabularnewline
2018 & June & 170 & 342 & & 76 & 610 & 867 & 360\tabularnewline
2018 & July & 183 & 360 & & 108 & 594 & 829 & 310\tabularnewline
2018 & August & 205 & 286 & & 90 & 649 & 939 & 286\tabularnewline
2018 & September & 175 & 304 & & 117 & 560 & 835 & 296\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Various operations on stocks, examples taken from
\href{https://tidyr.tidyverse.org/reference/gather.html}{gather} and
\href{https://tidyr.tidyverse.org/reference/spread.html}{spread}
manuals.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ stocks-tidyr }\NormalTok{(api/dataset }\StringTok{"data/stockstidyr.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stocks-tidyr}
\end{Highlighting}
\end{Shaded}

data/stockstidyr.csv {[}10 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
time & X & Y & Z\tabularnewline
\midrule
\endhead
2009-01-01 & 1.310 & -1.890 & -1.779\tabularnewline
2009-01-02 & -0.2999 & -1.825 & 2.399\tabularnewline
2009-01-03 & 0.5365 & -1.036 & -3.987\tabularnewline
2009-01-04 & -1.884 & -0.5218 & -2.831\tabularnewline
2009-01-05 & -0.9605 & -2.217 & 1.437\tabularnewline
2009-01-06 & -1.185 & -2.894 & 3.398\tabularnewline
2009-01-07 & -0.8521 & -2.168 & -1.201\tabularnewline
2009-01-08 & 0.2523 & -0.3285 & -1.532\tabularnewline
2009-01-09 & 0.4026 & 1.964 & -6.809\tabularnewline
2009-01-10 & -0.6438 & 2.686 & -2.559\tabularnewline
\bottomrule
\end{longtable}

Convert to longer form

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ stocks-long }\NormalTok{(api/pivot->longer stocks-tidyr [}\StringTok{"X"} \StringTok{"Y"} \StringTok{"Z"}\NormalTok{] \{}\AttributeTok{:value-column-name} \AttributeTok{:price}
                                                                \AttributeTok{:target-columns} \AttributeTok{:stocks}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stocks-long}
\end{Highlighting}
\end{Shaded}

data/stockstidyr.csv {[}30 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
time & :stocks & :price\tabularnewline
\midrule
\endhead
2009-01-01 & X & 1.310\tabularnewline
2009-01-02 & X & -0.2999\tabularnewline
2009-01-03 & X & 0.5365\tabularnewline
2009-01-04 & X & -1.884\tabularnewline
2009-01-05 & X & -0.9605\tabularnewline
2009-01-06 & X & -1.185\tabularnewline
2009-01-07 & X & -0.8521\tabularnewline
2009-01-08 & X & 0.2523\tabularnewline
2009-01-09 & X & 0.4026\tabularnewline
2009-01-10 & X & -0.6438\tabularnewline
2009-01-01 & Y & -1.890\tabularnewline
2009-01-02 & Y & -1.825\tabularnewline
2009-01-03 & Y & -1.036\tabularnewline
2009-01-04 & Y & -0.5218\tabularnewline
2009-01-05 & Y & -2.217\tabularnewline
2009-01-06 & Y & -2.894\tabularnewline
2009-01-07 & Y & -2.168\tabularnewline
2009-01-08 & Y & -0.3285\tabularnewline
2009-01-09 & Y & 1.964\tabularnewline
2009-01-10 & Y & 2.686\tabularnewline
2009-01-01 & Z & -1.779\tabularnewline
2009-01-02 & Z & 2.399\tabularnewline
2009-01-03 & Z & -3.987\tabularnewline
2009-01-04 & Z & -2.831\tabularnewline
2009-01-05 & Z & 1.437\tabularnewline
\bottomrule
\end{longtable}

Convert back to wide form

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/pivot->wider stocks-long }\AttributeTok{:stocks} \AttributeTok{:price}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

data/stockstidyr.csv {[}10 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
time & Z & X & Y\tabularnewline
\midrule
\endhead
2009-01-01 & -1.779 & 1.310 & -1.890\tabularnewline
2009-01-02 & 2.399 & -0.2999 & -1.825\tabularnewline
2009-01-03 & -3.987 & 0.5365 & -1.036\tabularnewline
2009-01-04 & -2.831 & -1.884 & -0.5218\tabularnewline
2009-01-05 & 1.437 & -0.9605 & -2.217\tabularnewline
2009-01-06 & 3.398 & -1.185 & -2.894\tabularnewline
2009-01-07 & -1.201 & -0.8521 & -2.168\tabularnewline
2009-01-08 & -1.532 & 0.2523 & -0.3285\tabularnewline
2009-01-09 & -6.809 & 0.4026 & 1.964\tabularnewline
2009-01-10 & -2.559 & -0.6438 & 2.686\tabularnewline
\bottomrule
\end{longtable}

Convert to wide form on time column (let's limit values to a couple of
rows)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ stocks-long}
\NormalTok{    (api/select-rows (}\KeywordTok{range} \DecValTok{0} \DecValTok{30} \DecValTok{4}\NormalTok{))}
\NormalTok{    (api/pivot->wider }\StringTok{"time"} \AttributeTok{:price}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

data/stockstidyr.csv {[}3 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:stocks & 2009-01-05 & 2009-01-07 & 2009-01-01 & 2009-01-03 &
2009-01-09\tabularnewline
\midrule
\endhead
X & -0.9605 & & 1.310 & & 0.4026\tabularnewline
Z & 1.437 & & -1.779 & & -6.809\tabularnewline
Y & & -2.168 & & -1.036 &\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{Join/Concat Datasets}\label{joinconcat-datasets}

Dataset join and concatenation functions.

Joins accept left-side and right-side datasets and columns selector.
Options are the same as in \texttt{tech.ml.dataset} functions.

The difference between \texttt{tech.ml.dataset} join functions are:
arguments order (first datasets) and possibility to join on multiple
columns.

Additionally set operations are defined: \texttt{union},
\texttt{intersect} and \texttt{difference}.

Datasets used in examples:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ ds1 }\NormalTok{(api/dataset \{}\AttributeTok{:a}\NormalTok{ [}\DecValTok{1} \DecValTok{2} \DecValTok{1} \DecValTok{2} \DecValTok{3} \DecValTok{4} \VariableTok{nil} \VariableTok{nil} \DecValTok{4}\NormalTok{]}
                       \AttributeTok{:b}\NormalTok{ (}\KeywordTok{range} \DecValTok{101} \DecValTok{110}\NormalTok{)}
                       \AttributeTok{:c}\NormalTok{ (}\KeywordTok{map} \KeywordTok{str} \StringTok{"abs tract"}\NormalTok{)\}))}
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ ds2 }\NormalTok{(api/dataset \{}\AttributeTok{:a}\NormalTok{ [}\VariableTok{nil} \DecValTok{1} \DecValTok{2} \DecValTok{5} \DecValTok{4} \DecValTok{3} \DecValTok{2} \DecValTok{1} \VariableTok{nil}\NormalTok{]}
                       \AttributeTok{:b}\NormalTok{ (}\KeywordTok{range} \DecValTok{110} \DecValTok{101} \DecValTok{-1}\NormalTok{)}
                       \AttributeTok{:c}\NormalTok{ (}\KeywordTok{map} \KeywordTok{str} \StringTok{"datatable"}\NormalTok{)}
                       \AttributeTok{:d}\NormalTok{ (}\KeywordTok{symbol} \StringTok{"X"}\NormalTok{)\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds1}
\NormalTok{ds2}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:a & :b & :c\tabularnewline
\midrule
\endhead
1 & 101 & a\tabularnewline
2 & 102 & b\tabularnewline
1 & 103 & s\tabularnewline
2 & 104 &\tabularnewline
3 & 105 & t\tabularnewline
4 & 106 & r\tabularnewline
& 107 & a\tabularnewline
& 108 & c\tabularnewline
4 & 109 & t\tabularnewline
\bottomrule
\end{longtable}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:a & :b & :c & :d\tabularnewline
\midrule
\endhead
& 110 & d & X\tabularnewline
1 & 109 & a & X\tabularnewline
2 & 108 & t & X\tabularnewline
5 & 107 & a & X\tabularnewline
4 & 106 & t & X\tabularnewline
3 & 105 & a & X\tabularnewline
2 & 104 & b & X\tabularnewline
1 & 103 & l & X\tabularnewline
& 102 & e & X\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Left}\label{left}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/left-join ds1 ds2 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

left-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:b & :a & :c & :right.b & :right.a & :right.c & :d\tabularnewline
\midrule
\endhead
109 & 4 & t & 109 & 1 & a & X\tabularnewline
108 & & c & 108 & 2 & t & X\tabularnewline
107 & & a & 107 & 5 & a & X\tabularnewline
106 & 4 & r & 106 & 4 & t & X\tabularnewline
105 & 3 & t & 105 & 3 & a & X\tabularnewline
104 & 2 & & 104 & 2 & b & X\tabularnewline
103 & 1 & s & 103 & 1 & l & X\tabularnewline
102 & 2 & b & 102 & & e & X\tabularnewline
101 & 1 & a & & & &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/left-join ds2 ds1 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

left-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:b & :a & :c & :d & :right.b & :right.a & :right.c\tabularnewline
\midrule
\endhead
102 & & e & X & 102 & 2 & b\tabularnewline
103 & 1 & l & X & 103 & 1 & s\tabularnewline
104 & 2 & b & X & 104 & 2 &\tabularnewline
105 & 3 & a & X & 105 & 3 & t\tabularnewline
106 & 4 & t & X & 106 & 4 & r\tabularnewline
107 & 5 & a & X & 107 & & a\tabularnewline
108 & 2 & t & X & 108 & & c\tabularnewline
109 & 1 & a & X & 109 & 4 & t\tabularnewline
110 & & d & X & & &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/left-join ds1 ds2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

left-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :right.a & :right.b & :right.c & :d\tabularnewline
\midrule
\endhead
4 & 106 & r & 4 & 106 & t & X\tabularnewline
3 & 105 & t & 3 & 105 & a & X\tabularnewline
2 & 104 & & 2 & 104 & b & X\tabularnewline
1 & 103 & s & 1 & 103 & l & X\tabularnewline
2 & 102 & b & & & &\tabularnewline
& 108 & c & & & &\tabularnewline
& 107 & a & & & &\tabularnewline
1 & 101 & a & & & &\tabularnewline
4 & 109 & t & & & &\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/left-join ds2 ds1 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

left-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :d & :right.a & :right.b & :right.c\tabularnewline
\midrule
\endhead
1 & 103 & l & X & 1 & 103 & s\tabularnewline
2 & 104 & b & X & 2 & 104 &\tabularnewline
3 & 105 & a & X & 3 & 105 & t\tabularnewline
4 & 106 & t & X & 4 & 106 & r\tabularnewline
2 & 108 & t & X & & &\tabularnewline
1 & 109 & a & X & & &\tabularnewline
5 & 107 & a & X & & &\tabularnewline
& 110 & d & X & & &\tabularnewline
& 102 & e & X & & &\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Right}\label{right}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/right-join ds1 ds2 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

right-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:b & :a & :c & :right.b & :right.a & :right.c & :d\tabularnewline
\midrule
\endhead
109 & 4 & t & 109 & 1 & a & X\tabularnewline
108 & & c & 108 & 2 & t & X\tabularnewline
107 & & a & 107 & 5 & a & X\tabularnewline
106 & 4 & r & 106 & 4 & t & X\tabularnewline
105 & 3 & t & 105 & 3 & a & X\tabularnewline
104 & 2 & & 104 & 2 & b & X\tabularnewline
103 & 1 & s & 103 & 1 & l & X\tabularnewline
102 & 2 & b & 102 & & e & X\tabularnewline
& & & 110 & & d & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/right-join ds2 ds1 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

right-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:b & :a & :c & :d & :right.b & :right.a & :right.c\tabularnewline
\midrule
\endhead
102 & & e & X & 102 & 2 & b\tabularnewline
103 & 1 & l & X & 103 & 1 & s\tabularnewline
104 & 2 & b & X & 104 & 2 &\tabularnewline
105 & 3 & a & X & 105 & 3 & t\tabularnewline
106 & 4 & t & X & 106 & 4 & r\tabularnewline
107 & 5 & a & X & 107 & & a\tabularnewline
108 & 2 & t & X & 108 & & c\tabularnewline
109 & 1 & a & X & 109 & 4 & t\tabularnewline
& & & & 101 & 1 & a\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/right-join ds1 ds2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

right-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :right.a & :right.b & :right.c & :d\tabularnewline
\midrule
\endhead
4 & 106 & r & 4 & 106 & t & X\tabularnewline
3 & 105 & t & 3 & 105 & a & X\tabularnewline
2 & 104 & & 2 & 104 & b & X\tabularnewline
1 & 103 & s & 1 & 103 & l & X\tabularnewline
& & & & 110 & d & X\tabularnewline
& & & 1 & 109 & a & X\tabularnewline
& & & 2 & 108 & t & X\tabularnewline
& & & 5 & 107 & a & X\tabularnewline
& & & & 102 & e & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/right-join ds2 ds1 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

right-outer-join {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :d & :right.a & :right.b & :right.c\tabularnewline
\midrule
\endhead
1 & 103 & l & X & 1 & 103 & s\tabularnewline
2 & 104 & b & X & 2 & 104 &\tabularnewline
3 & 105 & a & X & 3 & 105 & t\tabularnewline
4 & 106 & t & X & 4 & 106 & r\tabularnewline
& & & & 1 & 101 & a\tabularnewline
& & & & 2 & 102 & b\tabularnewline
& & & & & 107 & a\tabularnewline
& & & & & 108 & c\tabularnewline
& & & & 4 & 109 & t\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Inner}\label{inner}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/inner-join ds1 ds2 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

inner-join {[}8 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:b & :a & :c & :right.a & :right.c & :d\tabularnewline
\midrule
\endhead
109 & 4 & t & 1 & a & X\tabularnewline
108 & & c & 2 & t & X\tabularnewline
107 & & a & 5 & a & X\tabularnewline
106 & 4 & r & 4 & t & X\tabularnewline
105 & 3 & t & 3 & a & X\tabularnewline
104 & 2 & & 2 & b & X\tabularnewline
103 & 1 & s & 1 & l & X\tabularnewline
102 & 2 & b & & e & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/inner-join ds2 ds1 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

inner-join {[}8 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:b & :a & :c & :d & :right.a & :right.c\tabularnewline
\midrule
\endhead
102 & & e & X & 2 & b\tabularnewline
103 & 1 & l & X & 1 & s\tabularnewline
104 & 2 & b & X & 2 &\tabularnewline
105 & 3 & a & X & 3 & t\tabularnewline
106 & 4 & t & X & 4 & r\tabularnewline
107 & 5 & a & X & & a\tabularnewline
108 & 2 & t & X & & c\tabularnewline
109 & 1 & a & X & 4 & t\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/inner-join ds1 ds2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

inner-join {[}4 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :right.a & :right.b & :right.c & :d\tabularnewline
\midrule
\endhead
4 & 106 & r & 4 & 106 & t & X\tabularnewline
3 & 105 & t & 3 & 105 & a & X\tabularnewline
2 & 104 & & 2 & 104 & b & X\tabularnewline
1 & 103 & s & 1 & 103 & l & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/inner-join ds2 ds1 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

inner-join {[}4 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :d & :right.a & :right.b & :right.c\tabularnewline
\midrule
\endhead
1 & 103 & l & X & 1 & 103 & s\tabularnewline
2 & 104 & b & X & 2 & 104 &\tabularnewline
3 & 105 & a & X & 3 & 105 & t\tabularnewline
4 & 106 & t & X & 4 & 106 & r\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Full}\label{full}

Join keeping all rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/full-join ds1 ds2 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

full-join {[}10 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:b & :a & :c & :right.b & :right.a & :right.c & :d\tabularnewline
\midrule
\endhead
109 & 4 & t & 109 & 1 & a & X\tabularnewline
108 & & c & 108 & 2 & t & X\tabularnewline
107 & & a & 107 & 5 & a & X\tabularnewline
106 & 4 & r & 106 & 4 & t & X\tabularnewline
105 & 3 & t & 105 & 3 & a & X\tabularnewline
104 & 2 & & 104 & 2 & b & X\tabularnewline
103 & 1 & s & 103 & 1 & l & X\tabularnewline
102 & 2 & b & 102 & & e & X\tabularnewline
101 & 1 & a & & & &\tabularnewline
& & & 110 & & d & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/full-join ds2 ds1 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

full-join {[}10 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:b & :a & :c & :d & :right.b & :right.a & :right.c\tabularnewline
\midrule
\endhead
102 & & e & X & 102 & 2 & b\tabularnewline
103 & 1 & l & X & 103 & 1 & s\tabularnewline
104 & 2 & b & X & 104 & 2 &\tabularnewline
105 & 3 & a & X & 105 & 3 & t\tabularnewline
106 & 4 & t & X & 106 & 4 & r\tabularnewline
107 & 5 & a & X & 107 & & a\tabularnewline
108 & 2 & t & X & 108 & & c\tabularnewline
109 & 1 & a & X & 109 & 4 & t\tabularnewline
110 & & d & X & & &\tabularnewline
& & & & 101 & 1 & a\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/full-join ds1 ds2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

full-join {[}14 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :right.a & :right.b & :right.c & :d\tabularnewline
\midrule
\endhead
4 & 106 & r & 4 & 106 & t & X\tabularnewline
3 & 105 & t & 3 & 105 & a & X\tabularnewline
2 & 104 & & 2 & 104 & b & X\tabularnewline
1 & 103 & s & 1 & 103 & l & X\tabularnewline
2 & 102 & b & & & &\tabularnewline
& 108 & c & & & &\tabularnewline
& 107 & a & & & &\tabularnewline
1 & 101 & a & & & &\tabularnewline
4 & 109 & t & & & &\tabularnewline
& & & & 110 & d & X\tabularnewline
& & & 1 & 109 & a & X\tabularnewline
& & & 2 & 108 & t & X\tabularnewline
& & & 5 & 107 & a & X\tabularnewline
& & & & 102 & e & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/full-join ds2 ds1 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

full-join {[}14 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:a & :b & :c & :d & :right.a & :right.b & :right.c\tabularnewline
\midrule
\endhead
1 & 103 & l & X & 1 & 103 & s\tabularnewline
2 & 104 & b & X & 2 & 104 &\tabularnewline
3 & 105 & a & X & 3 & 105 & t\tabularnewline
4 & 106 & t & X & 4 & 106 & r\tabularnewline
2 & 108 & t & X & & &\tabularnewline
1 & 109 & a & X & & &\tabularnewline
5 & 107 & a & X & & &\tabularnewline
& 110 & d & X & & &\tabularnewline
& 102 & e & X & & &\tabularnewline
& & & & 1 & 101 & a\tabularnewline
& & & & 2 & 102 & b\tabularnewline
& & & & & 107 & a\tabularnewline
& & & & & 108 & c\tabularnewline
& & & & 4 & 109 & t\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Semi}\label{semi}

Return rows from ds1 matching ds2

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/semi-join ds1 ds2 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

semi-join {[}5 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:b & :a & :c\tabularnewline
\midrule
\endhead
109 & 4 & t\tabularnewline
106 & 4 & r\tabularnewline
105 & 3 & t\tabularnewline
104 & 2 &\tabularnewline
103 & 1 & s\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/semi-join ds2 ds1 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

semi-join {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:b & :a & :c & :d\tabularnewline
\midrule
\endhead
103 & 1 & l & X\tabularnewline
104 & 2 & b & X\tabularnewline
105 & 3 & a & X\tabularnewline
106 & 4 & t & X\tabularnewline
109 & 1 & a & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/semi-join ds1 ds2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

semi-join {[}4 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:a & :b & :c\tabularnewline
\midrule
\endhead
4 & 106 & r\tabularnewline
3 & 105 & t\tabularnewline
2 & 104 &\tabularnewline
1 & 103 & s\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/semi-join ds2 ds1 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

semi-join {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:a & :b & :c & :d\tabularnewline
\midrule
\endhead
1 & 103 & l & X\tabularnewline
2 & 104 & b & X\tabularnewline
3 & 105 & a & X\tabularnewline
4 & 106 & t & X\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Anti}\label{anti}

Return rows from ds1 not matching ds2

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/anti-join ds1 ds2 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

anti-join {[}4 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:b & :a & :c\tabularnewline
\midrule
\endhead
108 & & c\tabularnewline
107 & & a\tabularnewline
102 & 2 & b\tabularnewline
101 & 1 & a\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/anti-join ds2 ds1 }\AttributeTok{:b}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

anti-join {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:b & :a & :c & :d\tabularnewline
\midrule
\endhead
102 & & e & X\tabularnewline
107 & 5 & a & X\tabularnewline
108 & 2 & t & X\tabularnewline
110 & & d & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/anti-join ds1 ds2 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

anti-join {[}5 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:a & :b & :c\tabularnewline
\midrule
\endhead
2 & 102 & b\tabularnewline
& 108 & c\tabularnewline
& 107 & a\tabularnewline
1 & 101 & a\tabularnewline
4 & 109 & t\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/anti-join ds2 ds1 [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

anti-join {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:a & :b & :c & :d\tabularnewline
\midrule
\endhead
2 & 108 & t & X\tabularnewline
1 & 109 & a & X\tabularnewline
5 & 107 & a & X\tabularnewline
& 110 & d & X\tabularnewline
& 102 & e & X\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Concat}\label{concat}

\texttt{contact} joins rows from other datasets

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/concat ds1)}
\end{Highlighting}
\end{Shaded}

null {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:a & :b & :c\tabularnewline
\midrule
\endhead
1 & 101 & a\tabularnewline
2 & 102 & b\tabularnewline
1 & 103 & s\tabularnewline
2 & 104 &\tabularnewline
3 & 105 & t\tabularnewline
4 & 106 & r\tabularnewline
& 107 & a\tabularnewline
& 108 & c\tabularnewline
4 & 109 & t\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/concat ds1 (api/drop-columns ds2 }\AttributeTok{:d}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

null {[}18 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:a & :b & :c\tabularnewline
\midrule
\endhead
1 & 101 & a\tabularnewline
2 & 102 & b\tabularnewline
1 & 103 & s\tabularnewline
2 & 104 &\tabularnewline
3 & 105 & t\tabularnewline
4 & 106 & r\tabularnewline
& 107 & a\tabularnewline
& 108 & c\tabularnewline
4 & 109 & t\tabularnewline
& 110 & d\tabularnewline
1 & 109 & a\tabularnewline
2 & 108 & t\tabularnewline
5 & 107 & a\tabularnewline
4 & 106 & t\tabularnewline
3 & 105 & a\tabularnewline
2 & 104 & b\tabularnewline
1 & 103 & l\tabularnewline
& 102 & e\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{apply}\NormalTok{ api/concat (}\KeywordTok{repeatedly} \DecValTok{3}\NormalTok{ #(api/random DS)))}
\end{Highlighting}
\end{Shaded}

null {[}27 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Union}\label{union}

The same as \texttt{concat} but returns unique rows

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{apply}\NormalTok{ api/union (api/drop-columns ds2 }\AttributeTok{:d}\NormalTok{) (}\KeywordTok{repeat} \DecValTok{10}\NormalTok{ ds1))}
\end{Highlighting}
\end{Shaded}

union {[}18 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:a & :b & :c\tabularnewline
\midrule
\endhead
& 110 & d\tabularnewline
1 & 109 & a\tabularnewline
2 & 108 & t\tabularnewline
5 & 107 & a\tabularnewline
4 & 106 & t\tabularnewline
3 & 105 & a\tabularnewline
2 & 104 & b\tabularnewline
1 & 103 & l\tabularnewline
& 102 & e\tabularnewline
1 & 101 & a\tabularnewline
2 & 102 & b\tabularnewline
1 & 103 & s\tabularnewline
2 & 104 &\tabularnewline
3 & 105 & t\tabularnewline
4 & 106 & r\tabularnewline
& 107 & a\tabularnewline
& 108 & c\tabularnewline
4 & 109 & t\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{apply}\NormalTok{ api/union (}\KeywordTok{repeatedly} \DecValTok{10}\NormalTok{ #(api/random DS)))}
\end{Highlighting}
\end{Shaded}

union {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Intersection}\label{intersection}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/intersect (api/select-columns ds1 }\AttributeTok{:b}\NormalTok{)}
\NormalTok{               (api/select-columns ds2 }\AttributeTok{:b}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

intersection {[}8 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:b\tabularnewline
\midrule
\endhead
109\tabularnewline
108\tabularnewline
107\tabularnewline
106\tabularnewline
105\tabularnewline
104\tabularnewline
103\tabularnewline
102\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Difference}\label{difference}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/difference (api/select-columns ds1 }\AttributeTok{:b}\NormalTok{)}
\NormalTok{                (api/select-columns ds2 }\AttributeTok{:b}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

difference {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:b\tabularnewline
\midrule
\endhead
101\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/difference (api/select-columns ds2 }\AttributeTok{:b}\NormalTok{)}
\NormalTok{                (api/select-columns ds1 }\AttributeTok{:b}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

difference {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:b\tabularnewline
\midrule
\endhead
110\tabularnewline
\bottomrule
\end{longtable}

\subsection{Functions}\label{functions}

This API doesn't provide any statistical, numerical or date/time
functions. Use below namespaces:

\begin{longtable}[]{@{}ll@{}}
\toprule
Namespace & functions\tabularnewline
\midrule
\endhead
\texttt{tech.v2.datatype.functional} & primitive oprations, reducers,
statistics\tabularnewline
\texttt{tech.v2.datatype.datetime} & date/time converters\tabularnewline
\texttt{tech.v2.datatype.datetime.operations} & date/time
functions\tabularnewline
\texttt{tech.ml.dataset.pipeline} & pipeline operations\tabularnewline
\bottomrule
\end{longtable}

\subsection{Other examples}\label{other-examples}

\subsubsection{Stocks}\label{stocks}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{defonce}\FunctionTok{ stocks }\NormalTok{(api/dataset }\StringTok{"https://raw.githubusercontent.com/techascent/tech.ml.dataset/master/test/data/stocks.csv"}\NormalTok{ \{}\AttributeTok{:key-fn} \KeywordTok{keyword}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stocks}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/techascent/tech.ml.dataset/master/test/data/stocks.csv}
{[}560 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:symbol & :date & :price\tabularnewline
\midrule
\endhead
MSFT & 2000-01-01 & 39.81\tabularnewline
MSFT & 2000-02-01 & 36.35\tabularnewline
MSFT & 2000-03-01 & 43.22\tabularnewline
MSFT & 2000-04-01 & 28.37\tabularnewline
MSFT & 2000-05-01 & 25.45\tabularnewline
MSFT & 2000-06-01 & 32.54\tabularnewline
MSFT & 2000-07-01 & 28.40\tabularnewline
MSFT & 2000-08-01 & 28.40\tabularnewline
MSFT & 2000-09-01 & 24.53\tabularnewline
MSFT & 2000-10-01 & 28.02\tabularnewline
MSFT & 2000-11-01 & 23.34\tabularnewline
MSFT & 2000-12-01 & 17.65\tabularnewline
MSFT & 2001-01-01 & 24.84\tabularnewline
MSFT & 2001-02-01 & 24.00\tabularnewline
MSFT & 2001-03-01 & 22.25\tabularnewline
MSFT & 2001-04-01 & 27.56\tabularnewline
MSFT & 2001-05-01 & 28.14\tabularnewline
MSFT & 2001-06-01 & 29.70\tabularnewline
MSFT & 2001-07-01 & 26.93\tabularnewline
MSFT & 2001-08-01 & 23.21\tabularnewline
MSFT & 2001-09-01 & 20.82\tabularnewline
MSFT & 2001-10-01 & 23.65\tabularnewline
MSFT & 2001-11-01 & 26.12\tabularnewline
MSFT & 2001-12-01 & 26.95\tabularnewline
MSFT & 2002-01-01 & 25.92\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ stocks}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row]}
\NormalTok{                    \{}\AttributeTok{:symbol}\NormalTok{ (}\AttributeTok{:symbol}\NormalTok{ row)}
                     \AttributeTok{:year}\NormalTok{ (tech.v2.datatype.datetime.operations/get-years (}\AttributeTok{:date}\NormalTok{ row))\}))}
\NormalTok{    (api/aggregate #(tech.v2.datatype.functional/mean (}\VariableTok{%} \AttributeTok{:price}\NormalTok{)))}
\NormalTok{    (api/order-by [}\AttributeTok{:symbol} \AttributeTok{:year}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}51 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:symbol & :year & :summary\tabularnewline
\midrule
\endhead
AAPL & 2000 & 21.75\tabularnewline
AAPL & 2001 & 10.18\tabularnewline
AAPL & 2002 & 9.408\tabularnewline
AAPL & 2003 & 9.347\tabularnewline
AAPL & 2004 & 18.72\tabularnewline
AAPL & 2005 & 48.17\tabularnewline
AAPL & 2006 & 72.04\tabularnewline
AAPL & 2007 & 133.4\tabularnewline
AAPL & 2008 & 138.5\tabularnewline
AAPL & 2009 & 150.4\tabularnewline
AAPL & 2010 & 206.6\tabularnewline
AMZN & 2000 & 43.93\tabularnewline
AMZN & 2001 & 11.74\tabularnewline
AMZN & 2002 & 16.72\tabularnewline
AMZN & 2003 & 39.02\tabularnewline
AMZN & 2004 & 43.27\tabularnewline
AMZN & 2005 & 40.19\tabularnewline
AMZN & 2006 & 36.25\tabularnewline
AMZN & 2007 & 69.95\tabularnewline
AMZN & 2008 & 69.02\tabularnewline
AMZN & 2009 & 90.73\tabularnewline
AMZN & 2010 & 124.2\tabularnewline
GOOG & 2004 & 159.5\tabularnewline
GOOG & 2005 & 286.5\tabularnewline
GOOG & 2006 & 415.3\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ stocks}
\NormalTok{    (api/group-by (}\KeywordTok{juxt} \AttributeTok{:symbol}\NormalTok{ #(tech.v2.datatype.datetime.operations/get-years (}\VariableTok{%} \AttributeTok{:date}\NormalTok{))))}
\NormalTok{    (api/aggregate #(tech.v2.datatype.functional/mean (}\VariableTok{%} \AttributeTok{:price}\NormalTok{)))}
\NormalTok{    (api/rename-columns \{:$group-name}\DecValTok{-0} \AttributeTok{:symbol}
\NormalTok{                         :$group-name}\DecValTok{-1} \AttributeTok{:year}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}51 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:symbol & :year & :summary\tabularnewline
\midrule
\endhead
AMZN & 2007 & 69.95\tabularnewline
AMZN & 2008 & 69.02\tabularnewline
AMZN & 2009 & 90.73\tabularnewline
AMZN & 2010 & 124.2\tabularnewline
AMZN & 2000 & 43.93\tabularnewline
AMZN & 2001 & 11.74\tabularnewline
AMZN & 2002 & 16.72\tabularnewline
AMZN & 2003 & 39.02\tabularnewline
AMZN & 2004 & 43.27\tabularnewline
AMZN & 2005 & 40.19\tabularnewline
AMZN & 2006 & 36.25\tabularnewline
IBM & 2001 & 96.97\tabularnewline
IBM & 2002 & 75.13\tabularnewline
IBM & 2000 & 96.91\tabularnewline
MSFT & 2006 & 24.76\tabularnewline
MSFT & 2005 & 23.85\tabularnewline
MSFT & 2004 & 22.67\tabularnewline
MSFT & 2003 & 20.93\tabularnewline
AAPL & 2001 & 10.18\tabularnewline
MSFT & 2010 & 28.51\tabularnewline
AAPL & 2002 & 9.408\tabularnewline
MSFT & 2009 & 22.87\tabularnewline
MSFT & 2008 & 25.21\tabularnewline
AAPL & 2000 & 21.75\tabularnewline
MSFT & 2007 & 29.28\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{data.table}\label{data.table}

Below you can find comparizon between functionality of
\texttt{data.table} and Clojure dataset API. I leave it without
comments, please refer original document explaining details:

\href{https://rdatatable.gitlab.io/data.table/articles/datatable-intro.html}{Introduction
to \texttt{data.table}}

R

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(data.table)}
\KeywordTok{library}\NormalTok{(knitr)}

\NormalTok{flights <-}\StringTok{ }\KeywordTok{fread}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv"}\NormalTok{)}

\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(flights))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrrrlllrrr@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & 14 & 13 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & -3 & 13 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
2014 & 1 & 1 & 2 & 9 & AA & JFK & LAX & 351 & 2475 & 19\tabularnewline
2014 & 1 & 1 & -8 & -26 & AA & LGA & PBI & 157 & 1035 & 7\tabularnewline
2014 & 1 & 1 & 2 & 1 & AA & JFK & LAX & 350 & 2475 & 13\tabularnewline
2014 & 1 & 1 & 4 & 0 & AA & EWR & LAX & 339 & 2454 & 18\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{require}\NormalTok{ '[tech.v2.datatype.functional }\AttributeTok{:as}\NormalTok{ dfn]}
\NormalTok{         '[tech.v2.datatype }\AttributeTok{:as}\NormalTok{ dtype])}

\NormalTok{(}\BuiltInTok{defonce}\FunctionTok{ flights }\NormalTok{(api/dataset }\StringTok{"https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/head flights }\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 11{]}:

\begin{longtable}[]{@{}lllllllllll@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & 14 & 13 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & -3 & 13 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
2014 & 1 & 1 & 2 & 9 & AA & JFK & LAX & 351 & 2475 & 19\tabularnewline
2014 & 1 & 1 & -8 & -26 & AA & LGA & PBI & 157 & 1035 & 7\tabularnewline
2014 & 1 & 1 & 2 & 1 & AA & JFK & LAX & 350 & 2475 & 13\tabularnewline
2014 & 1 & 1 & 4 & 0 & AA & EWR & LAX & 339 & 2454 & 18\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Basics}\label{basics}

\subparagraph{Shape of loaded data}\label{shape-of-loaded-data}

R

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dim}\NormalTok{(flights)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 253316     11
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/shape flights)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[253316 11]
\end{verbatim}

\subparagraph{\texorpdfstring{What is
\texttt{data.table}?}{What is data.table?}}\label{what-is-data.table}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DT =}\StringTok{ }\KeywordTok{data.table}\NormalTok{(}
  \DataTypeTok{ID =} \KeywordTok{c}\NormalTok{(}\StringTok{"b"}\NormalTok{,}\StringTok{"b"}\NormalTok{,}\StringTok{"b"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"a"}\NormalTok{,}\StringTok{"c"}\NormalTok{),}
  \DataTypeTok{a =} \DecValTok{1}\OperatorTok{:}\DecValTok{6}\NormalTok{,}
  \DataTypeTok{b =} \DecValTok{7}\OperatorTok{:}\DecValTok{12}\NormalTok{,}
  \DataTypeTok{c =} \DecValTok{13}\OperatorTok{:}\DecValTok{18}
\NormalTok{)}

\KeywordTok{kable}\NormalTok{(DT)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrrr@{}}
\toprule
ID & a & b & c\tabularnewline
\midrule
\endhead
b & 1 & 7 & 13\tabularnewline
b & 2 & 8 & 14\tabularnewline
b & 3 & 9 & 15\tabularnewline
a & 4 & 10 & 16\tabularnewline
a & 5 & 11 & 17\tabularnewline
c & 6 & 12 & 18\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{(DT}\OperatorTok{$}\NormalTok{ID)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DT }\NormalTok{(api/dataset \{}\AttributeTok{:ID}\NormalTok{ [}\StringTok{"b"} \StringTok{"b"} \StringTok{"b"} \StringTok{"a"} \StringTok{"a"} \StringTok{"c"}\NormalTok{]}
                      \AttributeTok{:a}\NormalTok{ (}\KeywordTok{range} \DecValTok{1} \DecValTok{7}\NormalTok{)}
                      \AttributeTok{:b}\NormalTok{ (}\KeywordTok{range} \DecValTok{7} \DecValTok{13}\NormalTok{)}
                      \AttributeTok{:c}\NormalTok{ (}\KeywordTok{range} \DecValTok{13} \DecValTok{19}\NormalTok{)\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DT}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:ID & :a & :b & :c\tabularnewline
\midrule
\endhead
b & 1 & 7 & 13\tabularnewline
b & 2 & 8 & 14\tabularnewline
b & 3 & 9 & 15\tabularnewline
a & 4 & 10 & 16\tabularnewline
a & 5 & 11 & 17\tabularnewline
c & 6 & 12 & 18\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->} \AttributeTok{:ID}\NormalTok{ DT }\KeywordTok{meta} \AttributeTok{:datatype}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
:string
\end{verbatim}

\subparagraph{\texorpdfstring{Get all the flights with ``JFK'' as the
origin airport in the month of
June.}{Get all the flights with JFK as the origin airport in the month of June.}}\label{get-all-the-flights-with-jfk-as-the-origin-airport-in-the-month-of-june.}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[origin }\OperatorTok{==}\StringTok{ "JFK"} \OperatorTok{&}\StringTok{ }\NormalTok{month }\OperatorTok{==}\StringTok{ }\NormalTok{6L]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrrrlllrrr@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 6 & 1 & -9 & -5 & AA & JFK & LAX & 324 & 2475 & 8\tabularnewline
2014 & 6 & 1 & -10 & -13 & AA & JFK & LAX & 329 & 2475 &
12\tabularnewline
2014 & 6 & 1 & 18 & -1 & AA & JFK & LAX & 326 & 2475 & 7\tabularnewline
2014 & 6 & 1 & -6 & -16 & AA & JFK & LAX & 320 & 2475 &
10\tabularnewline
2014 & 6 & 1 & -4 & -45 & AA & JFK & LAX & 326 & 2475 &
18\tabularnewline
2014 & 6 & 1 & -6 & -23 & AA & JFK & LAX & 329 & 2475 &
14\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"origin"}\NormalTok{) }\StringTok{"JFK"}\NormalTok{)}
\NormalTok{                                   (}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"month"}\NormalTok{) }\DecValTok{6}\NormalTok{))))}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 11{]}:

\begin{longtable}[]{@{}lllllllllll@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 6 & 1 & -9 & -5 & AA & JFK & LAX & 324 & 2475 & 8\tabularnewline
2014 & 6 & 1 & -10 & -13 & AA & JFK & LAX & 329 & 2475 &
12\tabularnewline
2014 & 6 & 1 & 18 & -1 & AA & JFK & LAX & 326 & 2475 & 7\tabularnewline
2014 & 6 & 1 & -6 & -16 & AA & JFK & LAX & 320 & 2475 &
10\tabularnewline
2014 & 6 & 1 & -4 & -45 & AA & JFK & LAX & 326 & 2475 &
18\tabularnewline
2014 & 6 & 1 & -6 & -23 & AA & JFK & LAX & 329 & 2475 &
14\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Get the first two rows from
\texttt{flights}.}{Get the first two rows from flights.}}\label{get-the-first-two-rows-from-flights.}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{]}
\KeywordTok{kable}\NormalTok{(ans)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrrrlllrrr@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & 14 & 13 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & -3 & 13 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows flights (}\KeywordTok{range} \DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}2 11{]}:

\begin{longtable}[]{@{}lllllllllll@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & 14 & 13 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & -3 & 13 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Sort \texttt{flights} first by column
\texttt{origin} in ascending order, and then by \texttt{dest} in
descending
order}{Sort flights first by column origin in ascending order, and then by dest in descending order}}\label{sort-flights-first-by-column-origin-in-ascending-order-and-then-by-dest-in-descending-order}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[}\KeywordTok{order}\NormalTok{(origin, }\OperatorTok{-}\NormalTok{dest)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrrrlllrrr@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 1 & 5 & 6 & 49 & EV & EWR & XNA & 195 & 1131 & 8\tabularnewline
2014 & 1 & 6 & 7 & 13 & EV & EWR & XNA & 190 & 1131 & 8\tabularnewline
2014 & 1 & 7 & -6 & -13 & EV & EWR & XNA & 179 & 1131 & 8\tabularnewline
2014 & 1 & 8 & -7 & -12 & EV & EWR & XNA & 184 & 1131 & 8\tabularnewline
2014 & 1 & 9 & 16 & 7 & EV & EWR & XNA & 181 & 1131 & 8\tabularnewline
2014 & 1 & 13 & 66 & 66 & EV & EWR & XNA & 188 & 1131 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/order-by [}\StringTok{"origin"} \StringTok{"dest"}\NormalTok{] [}\AttributeTok{:asc} \AttributeTok{:desc}\NormalTok{])}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 11{]}:

\begin{longtable}[]{@{}lllllllllll@{}}
\toprule
year & month & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
2014 & 6 & 3 & -6 & -38 & EV & EWR & XNA & 154 & 1131 & 6\tabularnewline
2014 & 1 & 20 & -9 & -17 & EV & EWR & XNA & 177 & 1131 &
8\tabularnewline
2014 & 3 & 19 & -6 & 10 & EV & EWR & XNA & 201 & 1131 & 6\tabularnewline
2014 & 2 & 3 & 231 & 268 & EV & EWR & XNA & 184 & 1131 &
12\tabularnewline
2014 & 4 & 25 & -8 & -32 & EV & EWR & XNA & 159 & 1131 &
6\tabularnewline
2014 & 2 & 19 & 21 & 10 & EV & EWR & XNA & 176 & 1131 & 8\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Select \texttt{arr\_delay} column, but
return it as a
vector}{Select arr\_delay column, but return it as a vector}}\label{select-arr_delay-column-but-return-it-as-a-vector}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, arr_delay]}
\KeywordTok{head}\NormalTok{(ans)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  13  13   9 -26   1   0
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{take} \DecValTok{6}\NormalTok{ (flights }\StringTok{"arr_delay"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(13 13 9 -26 1 0)
\end{verbatim}

\subparagraph{\texorpdfstring{Select \texttt{arr\_delay} column, but
return as a data.table
instead}{Select arr\_delay column, but return as a data.table instead}}\label{select-arr_delay-column-but-return-as-a-data.table-instead}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, }\KeywordTok{list}\NormalTok{(arr_delay)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}r@{}}
\toprule
arr\_delay\tabularnewline
\midrule
\endhead
13\tabularnewline
13\tabularnewline
9\tabularnewline
-26\tabularnewline
1\tabularnewline
0\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-columns }\StringTok{"arr_delay"}\NormalTok{)}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
arr\_delay\tabularnewline
\midrule
\endhead
13\tabularnewline
13\tabularnewline
9\tabularnewline
-26\tabularnewline
1\tabularnewline
0\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Select both \texttt{arr\_delay} and
\texttt{dep\_delay}
columns}{Select both arr\_delay and dep\_delay columns}}\label{select-both-arr_delay-and-dep_delay-columns}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, .(arr_delay, dep_delay)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rr@{}}
\toprule
arr\_delay & dep\_delay\tabularnewline
\midrule
\endhead
13 & 14\tabularnewline
13 & -3\tabularnewline
9 & 2\tabularnewline
-26 & -8\tabularnewline
1 & 2\tabularnewline
0 & 4\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-columns [}\StringTok{"arr_delay"} \StringTok{"dep_delay"}\NormalTok{])}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
dep\_delay & arr\_delay\tabularnewline
\midrule
\endhead
14 & 13\tabularnewline
-3 & 13\tabularnewline
2 & 9\tabularnewline
-8 & -26\tabularnewline
2 & 1\tabularnewline
4 & 0\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Select both \texttt{arr\_delay} and
\texttt{dep\_delay} columns and rename them to \texttt{delay\_arr} and
\texttt{delay\_dep}}{Select both arr\_delay and dep\_delay columns and rename them to delay\_arr and delay\_dep}}\label{select-both-arr_delay-and-dep_delay-columns-and-rename-them-to-delay_arr-and-delay_dep}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, .(}\DataTypeTok{delay_arr =}\NormalTok{ arr_delay, }\DataTypeTok{delay_dep =}\NormalTok{ dep_delay)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rr@{}}
\toprule
delay\_arr & delay\_dep\tabularnewline
\midrule
\endhead
13 & 14\tabularnewline
13 & -3\tabularnewline
9 & 2\tabularnewline
-26 & -8\tabularnewline
1 & 2\tabularnewline
0 & 4\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-columns \{}\StringTok{"arr_delay"} \StringTok{"delay_arr"}
                         \StringTok{"dep_delay"} \StringTok{"delay_arr"}\NormalTok{\})}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
delay\_arr & delay\_arr\tabularnewline
\midrule
\endhead
14 & 13\tabularnewline
-3 & 13\tabularnewline
2 & 9\tabularnewline
-8 & -26\tabularnewline
2 & 1\tabularnewline
4 & 0\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{How many trips have had total delay \textless{}
0?}\label{how-many-trips-have-had-total-delay-0}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, }\KeywordTok{sum}\NormalTok{( (arr_delay }\OperatorTok{+}\StringTok{ }\NormalTok{dep_delay) }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{ )]}
\NormalTok{ans}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 141814
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>}\NormalTok{ (dfn/+ (flights }\StringTok{"arr_delay"}\NormalTok{) (flights }\StringTok{"dep_delay"}\NormalTok{))}
\NormalTok{     (dfn/argfilter #(}\KeywordTok{<} \VariableTok{%} \FloatTok{0.0}\NormalTok{))}
\NormalTok{     (dtype/ecount))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
141814
\end{verbatim}

or pure Clojure functions (much, much slower)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>}\NormalTok{ (}\KeywordTok{map} \KeywordTok{+}\NormalTok{ (flights }\StringTok{"arr_delay"}\NormalTok{) (flights }\StringTok{"dep_delay"}\NormalTok{))}
\NormalTok{     (}\KeywordTok{filter} \KeywordTok{neg?}\NormalTok{)}
\NormalTok{     (}\KeywordTok{count}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
141814
\end{verbatim}

\subparagraph{\texorpdfstring{Calculate the average arrival and
departure delay for all flights with ``JFK'' as the origin airport in
the month of
June}{Calculate the average arrival and departure delay for all flights with JFK as the origin airport in the month of June}}\label{calculate-the-average-arrival-and-departure-delay-for-all-flights-with-jfk-as-the-origin-airport-in-the-month-of-june}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[origin }\OperatorTok{==}\StringTok{ "JFK"} \OperatorTok{&}\StringTok{ }\NormalTok{month }\OperatorTok{==}\StringTok{ }\NormalTok{6L,}
\NormalTok{               .(}\DataTypeTok{m_arr =} \KeywordTok{mean}\NormalTok{(arr_delay), }\DataTypeTok{m_dep =} \KeywordTok{mean}\NormalTok{(dep_delay))]}
\KeywordTok{kable}\NormalTok{(ans)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rr@{}}
\toprule
m\_arr & m\_dep\tabularnewline
\midrule
\endhead
5.839349 & 9.807884\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"origin"}\NormalTok{) }\StringTok{"JFK"}\NormalTok{)}
\NormalTok{                                   (}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"month"}\NormalTok{) }\DecValTok{6}\NormalTok{))))}
\NormalTok{    (api/aggregate \{}\AttributeTok{:m}\NormalTok{_arr #(dfn/mean (}\VariableTok{%} \StringTok{"arr_delay"}\NormalTok{))}
                    \AttributeTok{:m}\NormalTok{_dep #(dfn/mean (}\VariableTok{%} \StringTok{"dep_delay"}\NormalTok{))\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:m\_arr & :m\_dep\tabularnewline
\midrule
\endhead
5.839 & 9.808\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{How many trips have been made in 2014 from
``JFK'' airport in the month of
June?}{How many trips have been made in 2014 from JFK airport in the month of June?}}\label{how-many-trips-have-been-made-in-2014-from-jfk-airport-in-the-month-of-june}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[origin }\OperatorTok{==}\StringTok{ "JFK"} \OperatorTok{&}\StringTok{ }\NormalTok{month }\OperatorTok{==}\StringTok{ }\NormalTok{6L, }\KeywordTok{length}\NormalTok{(dest)]}
\NormalTok{ans}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8422
\end{verbatim}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[origin }\OperatorTok{==}\StringTok{ "JFK"} \OperatorTok{&}\StringTok{ }\NormalTok{month }\OperatorTok{==}\StringTok{ }\NormalTok{6L, .N]}
\NormalTok{ans}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8422
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows (}\KeywordTok{fn}\NormalTok{ [row] (}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"origin"}\NormalTok{) }\StringTok{"JFK"}\NormalTok{)}
\NormalTok{                                   (}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"month"}\NormalTok{) }\DecValTok{6}\NormalTok{))))}
\NormalTok{    (api/row-count))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
8422
\end{verbatim}

\subparagraph{deselect columns using - or
!}\label{deselect-columns-using---or}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, }\OperatorTok{!}\KeywordTok{c}\NormalTok{(}\StringTok{"arr_delay"}\NormalTok{, }\StringTok{"dep_delay"}\NormalTok{)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrlllrrr@{}}
\toprule
year & month & day & carrier & origin & dest & air\_time & distance &
hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 351 & 2475 & 19\tabularnewline
2014 & 1 & 1 & AA & LGA & PBI & 157 & 1035 & 7\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 350 & 2475 & 13\tabularnewline
2014 & 1 & 1 & AA & EWR & LAX & 339 & 2454 & 18\tabularnewline
\bottomrule
\end{longtable}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\StringTok{"arr_delay"}\NormalTok{, }\StringTok{"dep_delay"}\NormalTok{)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrlllrrr@{}}
\toprule
year & month & day & carrier & origin & dest & air\_time & distance &
hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 351 & 2475 & 19\tabularnewline
2014 & 1 & 1 & AA & LGA & PBI & 157 & 1035 & 7\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 350 & 2475 & 13\tabularnewline
2014 & 1 & 1 & AA & EWR & LAX & 339 & 2454 & 18\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-columns (}\KeywordTok{complement}\NormalTok{ #\{}\StringTok{"arr_delay"} \StringTok{"dep_delay"}\NormalTok{\}))}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\url{https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv}
{[}6 9{]}:

\begin{longtable}[]{@{}lllllllll@{}}
\toprule
year & month & day & carrier & origin & dest & air\_time & distance &
hour\tabularnewline
\midrule
\endhead
2014 & 1 & 1 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 351 & 2475 & 19\tabularnewline
2014 & 1 & 1 & AA & LGA & PBI & 157 & 1035 & 7\tabularnewline
2014 & 1 & 1 & AA & JFK & LAX & 350 & 2475 & 13\tabularnewline
2014 & 1 & 1 & AA & EWR & LAX & 339 & 2454 & 18\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Aggregations}\label{aggregations}

\subparagraph{How can we get the number of trips corresponding to each
origin
airport?}\label{how-can-we-get-the-number-of-trips-corresponding-to-each-origin-airport}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, .(.N), by =}\StringTok{ }\NormalTok{.(origin)]}
\KeywordTok{kable}\NormalTok{(ans)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lr@{}}
\toprule
origin & N\tabularnewline
\midrule
\endhead
JFK & 81483\tabularnewline
LGA & 84433\tabularnewline
EWR & 87400\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/group-by [}\StringTok{"origin"}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:N}\NormalTok{ api/row-count\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
origin & :N\tabularnewline
\midrule
\endhead
LGA & 84433\tabularnewline
EWR & 87400\tabularnewline
JFK & 81483\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{How can we calculate the number of trips
for each origin airport for carrier code
``AA''?}{How can we calculate the number of trips for each origin airport for carrier code AA?}}\label{how-can-we-calculate-the-number-of-trips-for-each-origin-airport-for-carrier-code-aa}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[carrier }\OperatorTok{==}\StringTok{ "AA"}\NormalTok{, .N, by =}\StringTok{ }\NormalTok{origin]}
\KeywordTok{kable}\NormalTok{(ans)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lr@{}}
\toprule
origin & N\tabularnewline
\midrule
\endhead
JFK & 11923\tabularnewline
LGA & 11730\tabularnewline
EWR & 2649\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get} \VariableTok{%} \StringTok{"carrier"}\NormalTok{) }\StringTok{"AA"}\NormalTok{))}
\NormalTok{    (api/group-by [}\StringTok{"origin"}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:N}\NormalTok{ api/row-count\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
origin & :N\tabularnewline
\midrule
\endhead
LGA & 11730\tabularnewline
EWR & 2649\tabularnewline
JFK & 11923\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{How can we get the total number of trips
for each \texttt{origin}, \texttt{dest} pair for carrier code
``AA''?}{How can we get the total number of trips for each origin, dest pair for carrier code AA?}}\label{how-can-we-get-the-total-number-of-trips-for-each-origin-dest-pair-for-carrier-code-aa}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[carrier }\OperatorTok{==}\StringTok{ "AA"}\NormalTok{, .N, by =}\StringTok{ }\NormalTok{.(origin, dest)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llr@{}}
\toprule
origin & dest & N\tabularnewline
\midrule
\endhead
JFK & LAX & 3387\tabularnewline
LGA & PBI & 245\tabularnewline
EWR & LAX & 62\tabularnewline
JFK & MIA & 1876\tabularnewline
JFK & SEA & 298\tabularnewline
EWR & MIA & 848\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get} \VariableTok{%} \StringTok{"carrier"}\NormalTok{) }\StringTok{"AA"}\NormalTok{))}
\NormalTok{    (api/group-by [}\StringTok{"origin"} \StringTok{"dest"}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:N}\NormalTok{ api/row-count\})}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
origin & dest & :N\tabularnewline
\midrule
\endhead
JFK & MIA & 1876\tabularnewline
LGA & PBI & 245\tabularnewline
JFK & SEA & 298\tabularnewline
LGA & DFW & 3785\tabularnewline
JFK & AUS & 297\tabularnewline
JFK & STT & 229\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{How can we get the average arrival and
departure delay for each \texttt{orig},\texttt{dest} pair for each month
for carrier code
``AA''?}{How can we get the average arrival and departure delay for each orig,dest pair for each month for carrier code AA?}}\label{how-can-we-get-the-average-arrival-and-departure-delay-for-each-origdest-pair-for-each-month-for-carrier-code-aa}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[carrier }\OperatorTok{==}\StringTok{ "AA"}\NormalTok{,}
\NormalTok{        .(}\KeywordTok{mean}\NormalTok{(arr_delay), }\KeywordTok{mean}\NormalTok{(dep_delay)),}
\NormalTok{        by =}\StringTok{ }\NormalTok{.(origin, dest, month)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans,}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llrrr@{}}
\toprule
origin & dest & month & V1 & V2\tabularnewline
\midrule
\endhead
JFK & LAX & 1 & 6.590361 & 14.2289157\tabularnewline
LGA & PBI & 1 & -7.758621 & 0.3103448\tabularnewline
EWR & LAX & 1 & 1.366667 & 7.5000000\tabularnewline
JFK & MIA & 1 & 15.720670 & 18.7430168\tabularnewline
JFK & SEA & 1 & 14.357143 & 30.7500000\tabularnewline
EWR & MIA & 1 & 11.011236 & 12.1235955\tabularnewline
JFK & SFO & 1 & 19.252252 & 28.6396396\tabularnewline
JFK & BOS & 1 & 12.919643 & 15.2142857\tabularnewline
JFK & ORD & 1 & 31.586207 & 40.1724138\tabularnewline
JFK & IAH & 1 & 28.857143 & 14.2857143\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get} \VariableTok{%} \StringTok{"carrier"}\NormalTok{) }\StringTok{"AA"}\NormalTok{))}
\NormalTok{    (api/group-by [}\StringTok{"origin"} \StringTok{"dest"} \StringTok{"month"}\NormalTok{])}
\NormalTok{    (api/aggregate [#(dfn/mean (}\VariableTok{%} \StringTok{"arr_delay"}\NormalTok{))}
\NormalTok{                    #(dfn/mean (}\VariableTok{%} \StringTok{"dep_delay"}\NormalTok{))])}
\NormalTok{    (api/head }\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}10 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
month & origin & dest & :summary-0 & :summary-1\tabularnewline
\midrule
\endhead
9 & LGA & DFW & -8.788 & -0.2558\tabularnewline
10 & LGA & DFW & 3.500 & 4.553\tabularnewline
1 & JFK & AUS & 25.20 & 27.60\tabularnewline
4 & JFK & AUS & 4.367 & -0.1333\tabularnewline
5 & JFK & AUS & 6.767 & 14.73\tabularnewline
2 & JFK & AUS & 26.27 & 21.50\tabularnewline
3 & JFK & AUS & 8.194 & 2.710\tabularnewline
8 & JFK & AUS & 20.42 & 20.77\tabularnewline
1 & EWR & LAX & 1.367 & 7.500\tabularnewline
9 & JFK & AUS & 16.27 & 14.37\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{So how can we directly order by all the grouping
variables?}\label{so-how-can-we-directly-order-by-all-the-grouping-variables}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[carrier }\OperatorTok{==}\StringTok{ "AA"}\NormalTok{,}
\NormalTok{        .(}\KeywordTok{mean}\NormalTok{(arr_delay), }\KeywordTok{mean}\NormalTok{(dep_delay)),}
\NormalTok{        keyby =}\StringTok{ }\NormalTok{.(origin, dest, month)]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans,}\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llrrr@{}}
\toprule
origin & dest & month & V1 & V2\tabularnewline
\midrule
\endhead
EWR & DFW & 1 & 6.427673 & 10.012579\tabularnewline
EWR & DFW & 2 & 10.536765 & 11.345588\tabularnewline
EWR & DFW & 3 & 12.865031 & 8.079755\tabularnewline
EWR & DFW & 4 & 17.792683 & 12.920732\tabularnewline
EWR & DFW & 5 & 18.487805 & 18.682927\tabularnewline
EWR & DFW & 6 & 37.005952 & 38.744048\tabularnewline
EWR & DFW & 7 & 20.250000 & 21.154762\tabularnewline
EWR & DFW & 8 & 16.936046 & 22.069767\tabularnewline
EWR & DFW & 9 & 5.865031 & 13.055215\tabularnewline
EWR & DFW & 10 & 18.813665 & 18.894410\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get} \VariableTok{%} \StringTok{"carrier"}\NormalTok{) }\StringTok{"AA"}\NormalTok{))}
\NormalTok{    (api/group-by [}\StringTok{"origin"} \StringTok{"dest"} \StringTok{"month"}\NormalTok{])}
\NormalTok{    (api/aggregate [#(dfn/mean (}\VariableTok{%} \StringTok{"arr_delay"}\NormalTok{))}
\NormalTok{                    #(dfn/mean (}\VariableTok{%} \StringTok{"dep_delay"}\NormalTok{))])}
\NormalTok{    (api/order-by [}\StringTok{"origin"} \StringTok{"dest"} \StringTok{"month"}\NormalTok{])}
\NormalTok{    (api/head }\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}10 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
month & origin & dest & :summary-0 & :summary-1\tabularnewline
\midrule
\endhead
1 & EWR & DFW & 6.428 & 10.01\tabularnewline
2 & EWR & DFW & 10.54 & 11.35\tabularnewline
3 & EWR & DFW & 12.87 & 8.080\tabularnewline
4 & EWR & DFW & 17.79 & 12.92\tabularnewline
5 & EWR & DFW & 18.49 & 18.68\tabularnewline
6 & EWR & DFW & 37.01 & 38.74\tabularnewline
7 & EWR & DFW & 20.25 & 21.15\tabularnewline
8 & EWR & DFW & 16.94 & 22.07\tabularnewline
9 & EWR & DFW & 5.865 & 13.06\tabularnewline
10 & EWR & DFW & 18.81 & 18.89\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Can \texttt{by} accept expressions as well
or does it just take
columns?}{Can by accept expressions as well or does it just take columns?}}\label{can-by-accept-expressions-as-well-or-does-it-just-take-columns}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, .N, .(dep_delay}\OperatorTok{>}\DecValTok{0}\NormalTok{, arr_delay}\OperatorTok{>}\DecValTok{0}\NormalTok{)]}
\KeywordTok{kable}\NormalTok{(ans)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llr@{}}
\toprule
dep\_delay & arr\_delay & N\tabularnewline
\midrule
\endhead
TRUE & TRUE & 72836\tabularnewline
FALSE & TRUE & 34583\tabularnewline
FALSE & FALSE & 119304\tabularnewline
TRUE & FALSE & 26593\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row]}
\NormalTok{                    \{}\AttributeTok{:dep}\NormalTok{_delay (}\KeywordTok{pos?}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"dep_delay"}\NormalTok{))}
                     \AttributeTok{:arr}\NormalTok{_delay (}\KeywordTok{pos?}\NormalTok{ (}\KeywordTok{get}\NormalTok{ row }\StringTok{"arr_delay"}\NormalTok{))\}))}
\NormalTok{    (api/aggregate \{}\AttributeTok{:N}\NormalTok{ api/row-count\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:dep\_delay & :arr\_delay & :N\tabularnewline
\midrule
\endhead
true & false & 26593\tabularnewline
false & true & 34583\tabularnewline
false & false & 119304\tabularnewline
true & true & 72836\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{Do we have to compute \texttt{mean()} for
each column
individually?}{Do we have to compute mean() for each column individually?}}\label{do-we-have-to-compute-mean-for-each-column-individually}

R

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(DT)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrrr@{}}
\toprule
ID & a & b & c\tabularnewline
\midrule
\endhead
b & 1 & 7 & 13\tabularnewline
b & 2 & 8 & 14\tabularnewline
b & 3 & 9 & 15\tabularnewline
a & 4 & 10 & 16\tabularnewline
a & 5 & 11 & 17\tabularnewline
c & 6 & 12 & 18\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DT[, }\KeywordTok{print}\NormalTok{(.SD), by =}\StringTok{ }\NormalTok{ID]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   a b  c
1: 1 7 13
2: 2 8 14
3: 3 9 15
   a  b  c
1: 4 10 16
2: 5 11 17
   a  b  c
1: 6 12 18
\end{verbatim}

\begin{verbatim}
Empty data.table (0 rows and 1 cols): ID
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(DT[, }\KeywordTok{lapply}\NormalTok{(.SD, mean), }\DataTypeTok{by =}\NormalTok{ ID])}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrrr@{}}
\toprule
ID & a & b & c\tabularnewline
\midrule
\endhead
b & 2.0 & 8.0 & 14.0\tabularnewline
a & 4.5 & 10.5 & 16.5\tabularnewline
c & 6.0 & 12.0 & 18.0\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DT}

\NormalTok{(api/group-by DT }\AttributeTok{:ID}\NormalTok{ \{}\AttributeTok{:result-type} \AttributeTok{:as-map}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:ID & :a & :b & :c\tabularnewline
\midrule
\endhead
b & 1 & 7 & 13\tabularnewline
b & 2 & 8 & 14\tabularnewline
b & 3 & 9 & 15\tabularnewline
a & 4 & 10 & 16\tabularnewline
a & 5 & 11 & 17\tabularnewline
c & 6 & 12 & 18\tabularnewline
\bottomrule
\end{longtable}

\{``a'' Group: a {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:ID & :a & :b & :c\tabularnewline
\midrule
\endhead
a & 4 & 10 & 16\tabularnewline
a & 5 & 11 & 17\tabularnewline
\bottomrule
\end{longtable}

, ``b'' Group: b {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:ID & :a & :b & :c\tabularnewline
\midrule
\endhead
b & 1 & 7 & 13\tabularnewline
b & 2 & 8 & 14\tabularnewline
b & 3 & 9 & 15\tabularnewline
\bottomrule
\end{longtable}

, ``c'' Group: c {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:ID & :a & :b & :c\tabularnewline
\midrule
\endhead
c & 6 & 12 & 18\tabularnewline
\bottomrule
\end{longtable}

\}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DT}
\NormalTok{    (api/group-by [}\AttributeTok{:ID}\NormalTok{])}
\NormalTok{    (api/aggregate-columns (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:ID}\NormalTok{\}) dfn/mean))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:ID & :a & :b & :c\tabularnewline
\midrule
\endhead
a & 4.500 & 10.50 & 16.50\tabularnewline
b & 2.000 & 8.000 & 14.00\tabularnewline
c & 6.000 & 12.00 & 18.00\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{How can we specify just the columns we
would like to compute the \texttt{mean()}
on?}{How can we specify just the columns we would like to compute the mean() on?}}\label{how-can-we-specify-just-the-columns-we-would-like-to-compute-the-mean-on}

R

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(flights[carrier }\OperatorTok{==}\StringTok{ "AA"}\NormalTok{,                         ## Only on trips with carrier "AA"}
                   \KeywordTok{lapply}\NormalTok{(.SD, mean),                       ## compute the mean}
                   \DataTypeTok{by =}\NormalTok{ .(origin, dest, month),             ## for every 'origin,dest,month'}
                   \DataTypeTok{.SDcols =} \KeywordTok{c}\NormalTok{(}\StringTok{"arr_delay"}\NormalTok{, }\StringTok{"dep_delay"}\NormalTok{)])) ## for just those specified in .SDcols}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llrrr@{}}
\toprule
origin & dest & month & arr\_delay & dep\_delay\tabularnewline
\midrule
\endhead
JFK & LAX & 1 & 6.590361 & 14.2289157\tabularnewline
LGA & PBI & 1 & -7.758621 & 0.3103448\tabularnewline
EWR & LAX & 1 & 1.366667 & 7.5000000\tabularnewline
JFK & MIA & 1 & 15.720670 & 18.7430168\tabularnewline
JFK & SEA & 1 & 14.357143 & 30.7500000\tabularnewline
EWR & MIA & 1 & 11.011236 & 12.1235955\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\KeywordTok{get} \VariableTok{%} \StringTok{"carrier"}\NormalTok{) }\StringTok{"AA"}\NormalTok{))}
\NormalTok{    (api/group-by [}\StringTok{"origin"} \StringTok{"dest"} \StringTok{"month"}\NormalTok{])}
\NormalTok{    (api/aggregate-columns [}\StringTok{"arr_delay"} \StringTok{"dep_delay"}\NormalTok{] dfn/mean)}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
month & origin & dest & dep\_delay & arr\_delay\tabularnewline
\midrule
\endhead
9 & LGA & DFW & -0.2558 & -8.788\tabularnewline
10 & LGA & DFW & 4.553 & 3.500\tabularnewline
1 & JFK & AUS & 27.60 & 25.20\tabularnewline
4 & JFK & AUS & -0.1333 & 4.367\tabularnewline
5 & JFK & AUS & 14.73 & 6.767\tabularnewline
2 & JFK & AUS & 21.50 & 26.27\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{How can we return the first two rows for each
month?}\label{how-can-we-return-the-first-two-rows-for-each-month}

R

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ans <-}\StringTok{ }\NormalTok{flights[, }\KeywordTok{head}\NormalTok{(.SD, }\DecValTok{2}\NormalTok{), by =}\StringTok{ }\NormalTok{month]}
\KeywordTok{kable}\NormalTok{(}\KeywordTok{head}\NormalTok{(ans))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}rrrrrlllrrr@{}}
\toprule
month & year & day & dep\_delay & arr\_delay & carrier & origin & dest &
air\_time & distance & hour\tabularnewline
\midrule
\endhead
1 & 2014 & 1 & 14 & 13 & AA & JFK & LAX & 359 & 2475 & 9\tabularnewline
1 & 2014 & 1 & -3 & 13 & AA & JFK & LAX & 363 & 2475 & 11\tabularnewline
2 & 2014 & 1 & -1 & 1 & AA & JFK & LAX & 358 & 2475 & 8\tabularnewline
2 & 2014 & 1 & -5 & 3 & AA & JFK & LAX & 358 & 2475 & 11\tabularnewline
3 & 2014 & 1 & -11 & 36 & AA & JFK & LAX & 375 & 2475 & 8\tabularnewline
3 & 2014 & 1 & -3 & 14 & AA & JFK & LAX & 368 & 2475 & 11\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ flights}
\NormalTok{    (api/group-by [}\StringTok{"month"}\NormalTok{])}
\NormalTok{    (api/head }\DecValTok{2}\NormalTok{) }\CommentTok{;; head applied on each group}
\NormalTok{    (api/ungroup)}
\NormalTok{    (api/head }\DecValTok{6}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 11{]}:

\begin{longtable}[]{@{}lllllllllll@{}}
\toprule
dep\_delay & origin & air\_time & hour & arr\_delay & dest & distance &
year & month & day & carrier\tabularnewline
\midrule
\endhead
-8 & LGA & 113 & 18 & -23 & BNA & 764 & 2014 & 4 & 1 & MQ\tabularnewline
-8 & LGA & 71 & 18 & -11 & RDU & 431 & 2014 & 4 & 1 & MQ\tabularnewline
43 & JFK & 288 & 17 & 5 & LAS & 2248 & 2014 & 5 & 1 & AA\tabularnewline
-1 & JFK & 330 & 7 & -38 & SFO & 2586 & 2014 & 5 & 1 & AA\tabularnewline
-9 & JFK & 324 & 8 & -5 & LAX & 2475 & 2014 & 6 & 1 & AA\tabularnewline
-10 & JFK & 329 & 12 & -13 & LAX & 2475 & 2014 & 6 & 1 &
AA\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{How can we concatenate columns a and b for each group in
ID?}\label{how-can-we-concatenate-columns-a-and-b-for-each-group-in-id}

R

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(DT[, .(}\DataTypeTok{val =} \KeywordTok{c}\NormalTok{(a,b)), }\DataTypeTok{by =}\NormalTok{ ID])}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lr@{}}
\toprule
ID & val\tabularnewline
\midrule
\endhead
b & 1\tabularnewline
b & 2\tabularnewline
b & 3\tabularnewline
b & 7\tabularnewline
b & 8\tabularnewline
b & 9\tabularnewline
a & 4\tabularnewline
a & 5\tabularnewline
a & 10\tabularnewline
a & 11\tabularnewline
c & 6\tabularnewline
c & 12\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DT}
\NormalTok{    (api/pivot->longer [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{] \{}\AttributeTok{:value-column-name} \AttributeTok{:val}\NormalTok{\})}
\NormalTok{    (api/drop-columns [:$column }\AttributeTok{:c}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}12 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:ID & :val\tabularnewline
\midrule
\endhead
b & 1\tabularnewline
b & 2\tabularnewline
b & 3\tabularnewline
a & 4\tabularnewline
a & 5\tabularnewline
c & 6\tabularnewline
b & 7\tabularnewline
b & 8\tabularnewline
b & 9\tabularnewline
a & 10\tabularnewline
a & 11\tabularnewline
c & 12\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{\texorpdfstring{What if we would like to have all the
values of column \texttt{a} and \texttt{b} concatenated, but returned as
a list
column?}{What if we would like to have all the values of column a and b concatenated, but returned as a list column?}}\label{what-if-we-would-like-to-have-all-the-values-of-column-a-and-b-concatenated-but-returned-as-a-list-column}

R

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{kable}\NormalTok{(DT[, .(}\DataTypeTok{val =} \KeywordTok{list}\NormalTok{(}\KeywordTok{c}\NormalTok{(a,b))), }\DataTypeTok{by =}\NormalTok{ ID])}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ll@{}}
\toprule
ID & val\tabularnewline
\midrule
\endhead
b & c(1, 2, 3, 7, 8, 9)\tabularnewline
a & c(4, 5, 10, 11)\tabularnewline
c & c(6, 12)\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Clojure

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DT}
\NormalTok{    (api/pivot->longer [}\AttributeTok{:a} \AttributeTok{:b}\NormalTok{] \{}\AttributeTok{:value-column-name} \AttributeTok{:val}\NormalTok{\})}
\NormalTok{    (api/drop-columns [:$column }\AttributeTok{:c}\NormalTok{])}
\NormalTok{    (api/fold-by }\AttributeTok{:ID}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:ID & :val\tabularnewline
\midrule
\endhead
a & {[}4 5 10 11{]}\tabularnewline
b & {[}1 2 3 7 8 9{]}\tabularnewline
c & {[}6 12{]}\tabularnewline
\bottomrule
\end{longtable}

\subsubsection{API tour}\label{api-tour}

Below snippets are taken from
\href{https://atrebas.github.io/post/2019-03-03-datatable-dplyr/}{A
data.table and dplyr tour} written by Atrebas (permission granted).

I keep structure and subtitles but I skip \texttt{data.table} and
\texttt{dplyr} examples.

Example data

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/dataset \{}\AttributeTok{:V1}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\DecValTok{1} \DecValTok{2}\NormalTok{]))}
                      \AttributeTok{:V2}\NormalTok{ (}\KeywordTok{range} \DecValTok{1} \DecValTok{10}\NormalTok{)}
                      \AttributeTok{:V3}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\FloatTok{0.5} \FloatTok{1.0} \FloatTok{1.5}\NormalTok{]))}
                      \AttributeTok{:V4}\NormalTok{ (}\KeywordTok{take} \DecValTok{9}\NormalTok{ (}\KeywordTok{cycle}\NormalTok{ [}\StringTok{"A"} \StringTok{"B"} \StringTok{"C"}\NormalTok{]))\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset? DS)}
\NormalTok{(}\KeywordTok{class}\NormalTok{ DS)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
true
tech.ml.dataset.impl.dataset.Dataset
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Basic Operations}\label{basic-operations}

\subparagraph{Filter rows}\label{filter-rows}

Filter rows using indices

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS [}\DecValTok{2} \DecValTok{3}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Discard rows using negative indices

In Clojure API we have separate function for that: \texttt{drop-rows}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-rows DS (}\KeywordTok{range} \DecValTok{2} \DecValTok{7}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Filter rows using a logical expression

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{>} \VariableTok{%} \DecValTok{5}\NormalTok{) }\AttributeTok{:V2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #\{}\StringTok{"A"} \StringTok{"C"}\NormalTok{\} }\AttributeTok{:V4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Filter rows using multiple conditions

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS #(}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V1} \VariableTok{%}\NormalTok{) }\DecValTok{1}\NormalTok{)}
\NormalTok{                          (}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{) }\StringTok{"A"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Filter unique rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/unique-by DS [}\AttributeTok{:V1} \AttributeTok{:V4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Discard rows with missing values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-missing DS)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Other filters

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/random DS }\DecValTok{3}\NormalTok{) }\CommentTok{;; 3 random rows}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/random DS (}\KeywordTok{/}\NormalTok{ (api/row-count DS) }\DecValTok{2}\NormalTok{)) }\CommentTok{;; fraction of random rows}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}5 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 7 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/by-rank DS }\AttributeTok{:V1} \KeywordTok{zero?}\NormalTok{) }\CommentTok{;; take top n entries}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}4 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Convenience functions

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ (}\KeywordTok{partial} \KeywordTok{re-matches} \SpecialStringTok{#"^B"}\NormalTok{) }\KeywordTok{str} \AttributeTok{:V4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<=} \DecValTok{3} \VariableTok{%} \DecValTok{5}\NormalTok{) }\AttributeTok{:V2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<} \DecValTok{3} \VariableTok{%} \DecValTok{5}\NormalTok{) }\AttributeTok{:V2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
2 & 4 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #(}\KeywordTok{<=} \DecValTok{3} \VariableTok{%} \DecValTok{5}\NormalTok{) }\AttributeTok{:V2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

Last example skipped.

\subparagraph{Sort rows}\label{sort-rows}

Sort rows by column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS }\AttributeTok{:V3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sort rows in decreasing order

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS }\AttributeTok{:V3} \AttributeTok{:desc}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 3 & 1.500 & C\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Sort rows based on several columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] [}\AttributeTok{:asc} \AttributeTok{:desc}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 9 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
1 & 1 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Select columns}\label{select-columns}

Select one column using an index (not recommended)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{nth}\NormalTok{ (api/columns DS }\AttributeTok{:as-seq}\NormalTok{) }\DecValTok{2}\NormalTok{) }\CommentTok{;; as column (iterable)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#tech.ml.dataset.column<float64>[9]
:V3
[0.5000, 1.000, 1.500, 0.5000, 1.000, 1.500, 0.5000, 1.000, 1.500, ]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset [(}\KeywordTok{nth}\NormalTok{ (api/columns DS }\AttributeTok{:as-seq}\NormalTok{) }\DecValTok{2}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select one column using column name

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS }\AttributeTok{:V2}\NormalTok{) }\CommentTok{;; as dataset}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V2\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
3\tabularnewline
4\tabularnewline
5\tabularnewline
6\tabularnewline
7\tabularnewline
8\tabularnewline
9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS [}\AttributeTok{:V2}\NormalTok{]) }\CommentTok{;; as dataset}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V2\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
3\tabularnewline
4\tabularnewline
5\tabularnewline
6\tabularnewline
7\tabularnewline
8\tabularnewline
9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(DS }\AttributeTok{:V2}\NormalTok{) }\CommentTok{;; as column (iterable)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
#tech.ml.dataset.column<int64>[9]
:V2
[1, 2, 3, 4, 5, 6, 7, 8, 9, ]
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select several columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS [}\AttributeTok{:V2} \AttributeTok{:V3} \AttributeTok{:V4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 0.5000 & A\tabularnewline
2 & 1.000 & B\tabularnewline
3 & 1.500 & C\tabularnewline
4 & 0.5000 & A\tabularnewline
5 & 1.000 & B\tabularnewline
6 & 1.500 & C\tabularnewline
7 & 0.5000 & A\tabularnewline
8 & 1.000 & B\tabularnewline
9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Exclude columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V2} \AttributeTok{:V3} \AttributeTok{:V4}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V1\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/drop-columns DS [}\AttributeTok{:V2} \AttributeTok{:V3} \AttributeTok{:V4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V1\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Other seletions

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->>}\NormalTok{ (}\KeywordTok{range} \DecValTok{1} \DecValTok{3}\NormalTok{)}
\NormalTok{     (}\KeywordTok{map}\NormalTok{ (}\KeywordTok{comp} \KeywordTok{keyword}\NormalTok{ (}\KeywordTok{partial} \KeywordTok{format} \StringTok{"V%d"}\NormalTok{)))}
\NormalTok{     (api/select-columns DS))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
1 & 1\tabularnewline
2 & 2\tabularnewline
1 & 3\tabularnewline
2 & 4\tabularnewline
1 & 5\tabularnewline
2 & 6\tabularnewline
1 & 7\tabularnewline
2 & 8\tabularnewline
1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/reorder-columns DS }\AttributeTok{:V4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V4 & :V1 & :V2 & :V3\tabularnewline
\midrule
\endhead
A & 1 & 1 & 0.5000\tabularnewline
B & 2 & 2 & 1.000\tabularnewline
C & 1 & 3 & 1.500\tabularnewline
A & 2 & 4 & 0.5000\tabularnewline
B & 1 & 5 & 1.000\tabularnewline
C & 2 & 6 & 1.500\tabularnewline
A & 1 & 7 & 0.5000\tabularnewline
B & 2 & 8 & 1.000\tabularnewline
C & 1 & 9 & 1.500\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS #(clojure.string/starts-with? (}\KeywordTok{name} \VariableTok{%}\NormalTok{) }\StringTok{"V"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
2 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
2 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
2 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
2 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS #(clojure.string/ends-with? (}\KeywordTok{name} \VariableTok{%}\NormalTok{) }\StringTok{"3"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
0.5000\tabularnewline
1.000\tabularnewline
1.500\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS }\SpecialStringTok{#"..2"}\NormalTok{) }\CommentTok{;; regex converts to string using `str` function}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V2\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
3\tabularnewline
4\tabularnewline
5\tabularnewline
6\tabularnewline
7\tabularnewline
8\tabularnewline
9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS #\{}\AttributeTok{:V1} \StringTok{"X"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V1\tabularnewline
\midrule
\endhead
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
2\tabularnewline
1\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-columns DS #(}\KeywordTok{not}\NormalTok{ (clojure.string/starts-with? (}\KeywordTok{name} \VariableTok{%}\NormalTok{) }\StringTok{"V2"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 0.5000 & A\tabularnewline
2 & 1.000 & B\tabularnewline
1 & 1.500 & C\tabularnewline
2 & 0.5000 & A\tabularnewline
1 & 1.000 & B\tabularnewline
2 & 1.500 & C\tabularnewline
1 & 0.5000 & A\tabularnewline
2 & 1.000 & B\tabularnewline
1 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Summarise data}\label{summarise-data}

Summarise one column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{reduce} \KeywordTok{+}\NormalTok{ (DS }\AttributeTok{:V1}\NormalTok{)) }\CommentTok{;; using pure Clojure, as value}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate-columns DS }\AttributeTok{:V1}\NormalTok{ dfn/sum) }\CommentTok{;; as dataset}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V1\tabularnewline
\midrule
\endhead
13.00\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS \{}\AttributeTok{:sumV1}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:sumV1\tabularnewline
\midrule
\endhead
13.00\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Summarize several columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS [#(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))}
\NormalTok{                   #(dfn/standard-deviation (}\VariableTok{%} \AttributeTok{:V3}\NormalTok{))])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:summary-0 & :summary-1\tabularnewline
\midrule
\endhead
13.00 & 0.4330\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate-columns DS [}\AttributeTok{:V1} \AttributeTok{:V3}\NormalTok{] [dfn/sum}
\NormalTok{                                     dfn/standard-deviation])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V3\tabularnewline
\midrule
\endhead
13.00 & 0.4330\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Summarise several columns and assign column names

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate DS \{}\AttributeTok{:sumv1}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))}
                   \AttributeTok{:sdv3}\NormalTok{ #(dfn/standard-deviation (}\VariableTok{%} \AttributeTok{:V3}\NormalTok{))\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:sumv1 & :sdv3\tabularnewline
\midrule
\endhead
13.00 & 0.4330\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Summarise a subset of rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows (}\KeywordTok{range} \DecValTok{4}\NormalTok{))}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:V1}\NormalTok{ dfn/sum))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V1\tabularnewline
\midrule
\endhead
6.000\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Additional helpers}\label{additional-helpers}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/first)}
\NormalTok{    (api/select-columns }\AttributeTok{:V3}\NormalTok{)) }\CommentTok{;; select first row from `:V3` column}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
0.5000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/last)}
\NormalTok{    (api/select-columns }\AttributeTok{:V3}\NormalTok{)) }\CommentTok{;; select last row from `:V3` column}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
1.500\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows }\DecValTok{4}\NormalTok{)}
\NormalTok{    (api/select-columns }\AttributeTok{:V3}\NormalTok{)) }\CommentTok{;; select forth row from `:V3` column}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
1.000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select }\AttributeTok{:V3} \DecValTok{4}\NormalTok{)) }\CommentTok{;; select forth row from `:V3` column}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V3\tabularnewline
\midrule
\endhead
1.000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/unique-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/aggregate api/row-count)) }\CommentTok{;; number of unique rows in `:V4` column, as dataset}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:summary\tabularnewline
\midrule
\endhead
3\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/unique-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/row-count)) }\CommentTok{;; number of unique rows in `:V4` column, as value}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/unique-by)}
\NormalTok{    (api/row-count)) }\CommentTok{;; number of unique rows in dataset, as value}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
9
\end{verbatim}

\subparagraph{Add/update/delete columns}\label{addupdatedelete-columns}

Modify a column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/map-columns DS }\AttributeTok{:V1}\NormalTok{ [}\AttributeTok{:V1}\NormalTok{] #(dfn/pow }\VariableTok{%} \DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1 & 1 & 0.5000 & A\tabularnewline
4 & 2 & 1.000 & B\tabularnewline
1 & 3 & 1.500 & C\tabularnewline
4 & 4 & 0.5000 & A\tabularnewline
1 & 5 & 1.000 & B\tabularnewline
4 & 6 & 1.500 & C\tabularnewline
1 & 7 & 0.5000 & A\tabularnewline
4 & 8 & 1.000 & B\tabularnewline
1 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/add-or-update-column DS }\AttributeTok{:V1}\NormalTok{ (dfn/pow (DS }\AttributeTok{:V1}\NormalTok{) }\DecValTok{2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1.000 & 1 & 0.5000 & A\tabularnewline
4.000 & 2 & 1.000 & B\tabularnewline
1.000 & 3 & 1.500 & C\tabularnewline
4.000 & 4 & 0.5000 & A\tabularnewline
1.000 & 5 & 1.000 & B\tabularnewline
4.000 & 6 & 1.500 & C\tabularnewline
1.000 & 7 & 0.5000 & A\tabularnewline
4.000 & 8 & 1.000 & B\tabularnewline
1.000 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Add one column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/map-columns DS }\AttributeTok{:v5}\NormalTok{ [}\AttributeTok{:V1}\NormalTok{] dfn/log)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :v5\tabularnewline
\midrule
\endhead
1.000 & 1 & 0.5000 & A & 0.000\tabularnewline
4.000 & 2 & 1.000 & B & 1.386\tabularnewline
1.000 & 3 & 1.500 & C & 0.000\tabularnewline
4.000 & 4 & 0.5000 & A & 1.386\tabularnewline
1.000 & 5 & 1.000 & B & 0.000\tabularnewline
4.000 & 6 & 1.500 & C & 1.386\tabularnewline
1.000 & 7 & 0.5000 & A & 0.000\tabularnewline
4.000 & 8 & 1.000 & B & 1.386\tabularnewline
1.000 & 9 & 1.500 & C & 0.000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/add-or-update-column DS }\AttributeTok{:v5}\NormalTok{ (dfn/log (DS }\AttributeTok{:V1}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :v5\tabularnewline
\midrule
\endhead
1.000 & 1 & 0.5000 & A & 0.000\tabularnewline
4.000 & 2 & 1.000 & B & 1.386\tabularnewline
1.000 & 3 & 1.500 & C & 0.000\tabularnewline
4.000 & 4 & 0.5000 & A & 1.386\tabularnewline
1.000 & 5 & 1.000 & B & 0.000\tabularnewline
4.000 & 6 & 1.500 & C & 1.386\tabularnewline
1.000 & 7 & 0.5000 & A & 0.000\tabularnewline
4.000 & 8 & 1.000 & B & 1.386\tabularnewline
1.000 & 9 & 1.500 & C & 0.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Add several columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/add-or-update-columns DS \{}\AttributeTok{:v6}\NormalTok{ (dfn/sqrt (DS }\AttributeTok{:V1}\NormalTok{))}
                                       \AttributeTok{:v7} \StringTok{"X"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 7{]}:

\begin{longtable}[]{@{}lllllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :v5 & :v6 & :v7\tabularnewline
\midrule
\endhead
1.000 & 1 & 0.5000 & A & 0.000 & 1.000 & X\tabularnewline
4.000 & 2 & 1.000 & B & 1.386 & 2.000 & X\tabularnewline
1.000 & 3 & 1.500 & C & 0.000 & 1.000 & X\tabularnewline
4.000 & 4 & 0.5000 & A & 1.386 & 2.000 & X\tabularnewline
1.000 & 5 & 1.000 & B & 0.000 & 1.000 & X\tabularnewline
4.000 & 6 & 1.500 & C & 1.386 & 2.000 & X\tabularnewline
1.000 & 7 & 0.5000 & A & 0.000 & 1.000 & X\tabularnewline
4.000 & 8 & 1.000 & B & 1.386 & 2.000 & X\tabularnewline
1.000 & 9 & 1.500 & C & 0.000 & 1.000 & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Create one column and remove the others

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset \{}\AttributeTok{:v8}\NormalTok{ (dfn/+ (DS }\AttributeTok{:V3}\NormalTok{) }\DecValTok{1}\NormalTok{)\})}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:v8\tabularnewline
\midrule
\endhead
1.500\tabularnewline
2.000\tabularnewline
2.500\tabularnewline
1.500\tabularnewline
2.000\tabularnewline
2.500\tabularnewline
1.500\tabularnewline
2.000\tabularnewline
2.500\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Remove one column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/drop-columns DS }\AttributeTok{:v5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 6{]}:

\begin{longtable}[]{@{}llllll@{}}
\toprule
:V1 & :V2 & :V3 & :V4 & :v6 & :v7\tabularnewline
\midrule
\endhead
1.000 & 1 & 0.5000 & A & 1.000 & X\tabularnewline
4.000 & 2 & 1.000 & B & 2.000 & X\tabularnewline
1.000 & 3 & 1.500 & C & 1.000 & X\tabularnewline
4.000 & 4 & 0.5000 & A & 2.000 & X\tabularnewline
1.000 & 5 & 1.000 & B & 1.000 & X\tabularnewline
4.000 & 6 & 1.500 & C & 2.000 & X\tabularnewline
1.000 & 7 & 0.5000 & A & 1.000 & X\tabularnewline
4.000 & 8 & 1.000 & B & 2.000 & X\tabularnewline
1.000 & 9 & 1.500 & C & 1.000 & X\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Remove several columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/drop-columns DS [}\AttributeTok{:v6} \AttributeTok{:v7}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V3 & :V4\tabularnewline
\midrule
\endhead
1.000 & 1 & 0.5000 & A\tabularnewline
4.000 & 2 & 1.000 & B\tabularnewline
1.000 & 3 & 1.500 & C\tabularnewline
4.000 & 4 & 0.5000 & A\tabularnewline
1.000 & 5 & 1.000 & B\tabularnewline
4.000 & 6 & 1.500 & C\tabularnewline
1.000 & 7 & 0.5000 & A\tabularnewline
4.000 & 8 & 1.000 & B\tabularnewline
1.000 & 9 & 1.500 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Remove columns using a vector of colnames

We use set here.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/select-columns DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V3}\NormalTok{\})))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1.000 & 1 & A\tabularnewline
4.000 & 2 & B\tabularnewline
1.000 & 3 & C\tabularnewline
4.000 & 4 & A\tabularnewline
1.000 & 5 & B\tabularnewline
4.000 & 6 & C\tabularnewline
1.000 & 7 & A\tabularnewline
4.000 & 8 & B\tabularnewline
1.000 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Replace values for rows matching a condition

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/map-columns DS }\AttributeTok{:V2}\NormalTok{ [}\AttributeTok{:V2}\NormalTok{] #(}\KeywordTok{if}\NormalTok{ (}\KeywordTok{<} \VariableTok{%} \FloatTok{4.0}\NormalTok{) }\FloatTok{0.0} \VariableTok{%}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1.000 & 0 & A\tabularnewline
4.000 & 0 & B\tabularnewline
1.000 & 0 & C\tabularnewline
4.000 & 4 & A\tabularnewline
1.000 & 5 & B\tabularnewline
4.000 & 6 & C\tabularnewline
1.000 & 7 & A\tabularnewline
4.000 & 8 & B\tabularnewline
1.000 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{by}\label{by}

By group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:sumV2}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :sumV2\tabularnewline
\midrule
\endhead
B & 13.00\tabularnewline
C & 15.00\tabularnewline
A & 11.00\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

By several groups

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4} \AttributeTok{:V1}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:sumV2}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V2}\NormalTok{))\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :sumV2\tabularnewline
\midrule
\endhead
A & 4.000 & 4.000\tabularnewline
A & 1.000 & 7.000\tabularnewline
B & 1.000 & 5.000\tabularnewline
B & 4.000 & 8.000\tabularnewline
C & 4.000 & 6.000\tabularnewline
C & 1.000 & 9.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Calling function in by

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row]}
\NormalTok{                    (clojure.string/lower-case (}\AttributeTok{:V4}\NormalTok{ row))))}
\NormalTok{    (api/aggregate \{}\AttributeTok{:sumV1}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:\$group-name & :sumV1\tabularnewline
\midrule
\endhead
a & 6.000\tabularnewline
b & 9.000\tabularnewline
c & 6.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Assigning column name in by

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row]}
\NormalTok{                    \{}\AttributeTok{:abc}\NormalTok{ (clojure.string/lower-case (}\AttributeTok{:V4}\NormalTok{ row))\}))}
\NormalTok{    (api/aggregate \{}\AttributeTok{:sumV1}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:abc & :sumV1\tabularnewline
\midrule
\endhead
a & 6.000\tabularnewline
b & 9.000\tabularnewline
c & 6.000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by (}\KeywordTok{fn}\NormalTok{ [row]}
\NormalTok{                    (clojure.string/lower-case (}\AttributeTok{:V4}\NormalTok{ row))))}
\NormalTok{    (api/aggregate \{}\AttributeTok{:sumV1}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\} \{}\AttributeTok{:add-group-as-column} \AttributeTok{:abc}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:abc & :sumV1\tabularnewline
\midrule
\endhead
a & 6.000\tabularnewline
b & 9.000\tabularnewline
c & 6.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Using a condition in by

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by #(}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{) }\StringTok{"A"}\NormalTok{))}
\NormalTok{    (api/aggregate #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:\$group-name & :summary\tabularnewline
\midrule
\endhead
false & 15.00\tabularnewline
true & 6.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

By on a subset of rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows (}\KeywordTok{range} \DecValTok{5}\NormalTok{))}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/aggregate \{}\AttributeTok{:sumV1}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:\$group-name & :sumV1\tabularnewline
\midrule
\endhead
A & 5.000\tabularnewline
B & 5.000\tabularnewline
C & 1.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Count number of observations for each group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/aggregate api/row-count))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:\$group-name & :summary\tabularnewline
\midrule
\endhead
A & 3\tabularnewline
B & 3\tabularnewline
C & 3\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Add a column with number of observations for each group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V1}\NormalTok{])}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:n}\NormalTok{ api/row-count)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:V1 & :V2 & :V4 & :n\tabularnewline
\midrule
\endhead
4.000 & 0 & B & 4\tabularnewline
4.000 & 4 & A & 4\tabularnewline
4.000 & 6 & C & 4\tabularnewline
4.000 & 8 & B & 4\tabularnewline
1.000 & 0 & A & 5\tabularnewline
1.000 & 0 & C & 5\tabularnewline
1.000 & 5 & B & 5\tabularnewline
1.000 & 7 & A & 5\tabularnewline
1.000 & 9 & C & 5\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Retrieve the first/last/nth observation for each group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:V2} \KeywordTok{first}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V2\tabularnewline
\midrule
\endhead
B & 0\tabularnewline
C & 0\tabularnewline
A & 0\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:V2} \KeywordTok{last}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V2\tabularnewline
\midrule
\endhead
B & 8\tabularnewline
C & 9\tabularnewline
A & 7\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:V2}\NormalTok{ #(}\KeywordTok{nth} \VariableTok{%} \DecValTok{1}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V2\tabularnewline
\midrule
\endhead
B & 5\tabularnewline
C & 6\tabularnewline
A & 4\tabularnewline
\bottomrule
\end{longtable}

\paragraph{Going further}\label{going-further}

\subparagraph{Advanced columns
manipulation}\label{advanced-columns-manipulation}

Summarise all the columns

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{;; custom max function which works on every type}
\NormalTok{(api/aggregate-columns DS }\AttributeTok{:all}\NormalTok{ (}\KeywordTok{fn}\NormalTok{ [col] (}\KeywordTok{first}\NormalTok{ (}\KeywordTok{sort}\NormalTok{ #(}\KeywordTok{compare} \VariableTok{%2} \VariableTok{%1}\NormalTok{) col))))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
4.000 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Summarise several columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/aggregate-columns DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] dfn/mean)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
2.333 & 4.333\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Summarise several columns by group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] dfn/mean))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
B & 3.000 & 4.333\tabularnewline
C & 2.000 & 5.000\tabularnewline
A & 2.000 & 3.667\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Summarise with more than one function by group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] (}\KeywordTok{fn}\NormalTok{ [col]}
\NormalTok{                                       \{}\AttributeTok{:sum}\NormalTok{ (dfn/sum col)}
                                        \AttributeTok{:mean}\NormalTok{ (dfn/mean col)\})))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 5{]}:

\begin{longtable}[]{@{}lllll@{}}
\toprule
:V4 & :V1-sum & :V1-mean & :V2-sum & :V2-mean\tabularnewline
\midrule
\endhead
B & 9.000 & 3.000 & 13.00 & 4.333\tabularnewline
C & 6.000 & 2.000 & 15.00 & 5.000\tabularnewline
A & 6.000 & 2.000 & 11.00 & 3.667\tabularnewline
\bottomrule
\end{longtable}

Summarise using a condition

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-columns }\AttributeTok{:type/numerical}\NormalTok{)}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:all}\NormalTok{ dfn/mean))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
2.333 & 4.333\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify all the columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/update-columns DS }\AttributeTok{:all} \KeywordTok{reverse}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1.000 & 9 & C\tabularnewline
4.000 & 8 & B\tabularnewline
1.000 & 7 & A\tabularnewline
4.000 & 6 & C\tabularnewline
1.000 & 5 & B\tabularnewline
4.000 & 4 & A\tabularnewline
1.000 & 0 & C\tabularnewline
4.000 & 0 & B\tabularnewline
1.000 & 0 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify several columns (dropping the others)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-columns [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{])}
\NormalTok{    (api/update-columns }\AttributeTok{:all}\NormalTok{ dfn/sqrt))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
1.000 & 0.000\tabularnewline
2.000 & 0.000\tabularnewline
1.000 & 0.000\tabularnewline
2.000 & 2.000\tabularnewline
1.000 & 2.236\tabularnewline
2.000 & 2.449\tabularnewline
1.000 & 2.646\tabularnewline
2.000 & 2.828\tabularnewline
1.000 & 3.000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-columns (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V4}\NormalTok{\}))}
\NormalTok{    (api/update-columns }\AttributeTok{:all}\NormalTok{ dfn/exp))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
2.718 & 1.000\tabularnewline
54.60 & 1.000\tabularnewline
2.718 & 1.000\tabularnewline
54.60 & 54.60\tabularnewline
2.718 & 148.4\tabularnewline
54.60 & 403.4\tabularnewline
2.718 & 1097\tabularnewline
54.60 & 2981\tabularnewline
2.718 & 8103\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify several columns (keeping the others)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/update-columns DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] dfn/sqrt))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1.000 & 0.000 & A\tabularnewline
2.000 & 0.000 & B\tabularnewline
1.000 & 0.000 & C\tabularnewline
2.000 & 2.000 & A\tabularnewline
1.000 & 2.236 & B\tabularnewline
2.000 & 2.449 & C\tabularnewline
1.000 & 2.646 & A\tabularnewline
2.000 & 2.828 & B\tabularnewline
1.000 & 3.000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/update-columns DS (}\KeywordTok{complement}\NormalTok{ #\{}\AttributeTok{:V4}\NormalTok{\}) #(dfn/pow }\VariableTok{%} \DecValTok{2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1.000 & 0.000 & A\tabularnewline
4.000 & 0.000 & B\tabularnewline
1.000 & 0.000 & C\tabularnewline
4.000 & 4.000 & A\tabularnewline
1.000 & 5.000 & B\tabularnewline
4.000 & 6.000 & C\tabularnewline
1.000 & 7.000 & A\tabularnewline
4.000 & 8.000 & B\tabularnewline
1.000 & 9.000 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify columns using a condition (dropping the others)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-columns }\AttributeTok{:type/numerical}\NormalTok{)}
\NormalTok{    (api/update-columns }\AttributeTok{:all}\NormalTok{ #(dfn/- }\VariableTok{%} \DecValTok{1}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
0.000 & -1.000\tabularnewline
3.000 & -1.000\tabularnewline
0.000 & -1.000\tabularnewline
3.000 & 3.000\tabularnewline
0.000 & 4.000\tabularnewline
3.000 & 5.000\tabularnewline
0.000 & 6.000\tabularnewline
3.000 & 7.000\tabularnewline
0.000 & 8.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify columns using a condition (keeping the others)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/convert-types DS }\AttributeTok{:type/numerical} \AttributeTok{:int32}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & A\tabularnewline
4 & 0 & B\tabularnewline
1 & 0 & C\tabularnewline
4 & 4 & A\tabularnewline
1 & 5 & B\tabularnewline
4 & 5 & C\tabularnewline
1 & 7 & A\tabularnewline
4 & 8 & B\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Use a complex expression

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/head }\DecValTok{2}\NormalTok{)}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:V2} \StringTok{"X"}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
4 & X & B\tabularnewline
1 & X & B\tabularnewline
1 & X & C\tabularnewline
4 & X & C\tabularnewline
1 & X & A\tabularnewline
4 & X & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Use multiple expressions

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset (}\KeywordTok{let}\NormalTok{ [x (dfn/+ (DS }\AttributeTok{:V1}\NormalTok{) (dfn/sum (DS }\AttributeTok{:V2}\NormalTok{)))]}
\NormalTok{               (}\KeywordTok{println}\NormalTok{ (}\KeywordTok{seq}\NormalTok{ (DS }\AttributeTok{:V1}\NormalTok{)))}
\NormalTok{               (}\KeywordTok{println}\NormalTok{ (api/info (api/select-columns DS }\AttributeTok{:V1}\NormalTok{)))}
\NormalTok{               \{}\AttributeTok{:A}\NormalTok{ (}\KeywordTok{range} \DecValTok{1}\NormalTok{ (}\KeywordTok{inc}\NormalTok{ (api/row-count DS)))}
                \AttributeTok{:B}\NormalTok{ x\}))}
\end{Highlighting}
\end{Shaded}

(1 4 1 4 1 4 1 4 1) \_unnamed: descriptive-stats {[}1 9{]}:

\begin{longtable}[]{@{}lllllllll@{}}
\toprule
\begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
:col-name\strut
\end{minipage} & \begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
:datatype\strut
\end{minipage} & \begin{minipage}[b]{0.08\columnwidth}\raggedright\strut
:n-valid\strut
\end{minipage} & \begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
:n-missing\strut
\end{minipage} & \begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
:min\strut
\end{minipage} & \begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
:mean\strut
\end{minipage} & \begin{minipage}[b]{0.06\columnwidth}\raggedright\strut
:max\strut
\end{minipage} & \begin{minipage}[b]{0.16\columnwidth}\raggedright\strut
:standard-deviation\strut
\end{minipage} & \begin{minipage}[b]{0.07\columnwidth}\raggedright\strut
:skew\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
:V1\strut
\end{minipage} & \begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
:int32\strut
\end{minipage} & \begin{minipage}[t]{0.08\columnwidth}\raggedright\strut
9\strut
\end{minipage} & \begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
0\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
1.000\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
2.333\strut
\end{minipage} & \begin{minipage}[t]{0.06\columnwidth}\raggedright\strut
4.000\strut
\end{minipage} & \begin{minipage}[t]{0.16\columnwidth}\raggedright\strut
1.581\strut
\end{minipage} & \begin{minipage}[t]{0.07\columnwidth}\raggedright\strut
0.2711\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:A & :B\tabularnewline
\midrule
\endhead
1 & 39.00\tabularnewline
2 & 42.00\tabularnewline
3 & 39.00\tabularnewline
4 & 42.00\tabularnewline
5 & 39.00\tabularnewline
6 & 42.00\tabularnewline
7 & 39.00\tabularnewline
8 & 42.00\tabularnewline
9 & 39.00\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Chain expressions}\label{chain-expressions}

Expression chaining using \textgreater{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:V1sum}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\})}
\NormalTok{    (api/select-rows #(}\KeywordTok{>}\NormalTok{ (}\AttributeTok{:V1sum} \VariableTok{%}\NormalTok{) }\DecValTok{5}\NormalTok{) ))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V1sum\tabularnewline
\midrule
\endhead
B & 9.000\tabularnewline
C & 6.000\tabularnewline
A & 6.000\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate \{}\AttributeTok{:V1sum}\NormalTok{ #(dfn/sum (}\VariableTok{%} \AttributeTok{:V1}\NormalTok{))\})}
\NormalTok{    (api/order-by }\AttributeTok{:V1sum} \AttributeTok{:desc}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V1sum\tabularnewline
\midrule
\endhead
B & 9.000\tabularnewline
C & 6.000\tabularnewline
A & 6.000\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Indexing and Keys}\label{indexing-and-keys}

Set the key/index (order)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/order-by DS }\AttributeTok{:V4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & A\tabularnewline
4 & 4 & A\tabularnewline
1 & 7 & A\tabularnewline
4 & 0 & B\tabularnewline
1 & 5 & B\tabularnewline
4 & 8 & B\tabularnewline
1 & 0 & C\tabularnewline
4 & 5 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

Select the matching rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS #(}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{) }\StringTok{"A"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & A\tabularnewline
4 & 4 & A\tabularnewline
1 & 7 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #\{}\StringTok{"A"} \StringTok{"C"}\NormalTok{\} }\AttributeTok{:V4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & A\tabularnewline
4 & 4 & A\tabularnewline
1 & 7 & A\tabularnewline
1 & 0 & C\tabularnewline
4 & 5 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select the first matching row

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{) }\StringTok{"B"}\NormalTok{))}
\NormalTok{    (api/first))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
4 & 0 & B\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/unique-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/select-rows (}\KeywordTok{comp}\NormalTok{ #\{}\StringTok{"B"} \StringTok{"C"}\NormalTok{\} }\AttributeTok{:V4}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
4 & 0 & B\tabularnewline
1 & 0 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select the last matching row

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows #(}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{) }\StringTok{"A"}\NormalTok{))}
\NormalTok{    (api/last))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 7 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Nomatch argument

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/select-rows DS (}\KeywordTok{comp}\NormalTok{ #\{}\StringTok{"A"} \StringTok{"D"}\NormalTok{\} }\AttributeTok{:V4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & A\tabularnewline
4 & 4 & A\tabularnewline
1 & 7 & A\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Apply a function on the matching rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows (}\KeywordTok{comp}\NormalTok{ #\{}\StringTok{"A"} \StringTok{"C"}\NormalTok{\} }\AttributeTok{:V4}\NormalTok{))}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:V1}\NormalTok{ (}\KeywordTok{fn}\NormalTok{ [col]}
\NormalTok{                                 \{}\AttributeTok{:sum}\NormalTok{ (dfn/sum col)\})))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}1 1{]}:

\begin{longtable}[]{@{}l@{}}
\toprule
:V1-sum\tabularnewline
\midrule
\endhead
12.00\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify values for matching rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{            (api/map-columns }\AttributeTok{:V1}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V4}\NormalTok{] #(}\KeywordTok{if}\NormalTok{ (}\KeywordTok{=} \VariableTok{%2} \StringTok{"A"}\NormalTok{) }\DecValTok{0} \VariableTok{%1}\NormalTok{))}
\NormalTok{            (api/order-by }\AttributeTok{:V4}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
0 & 0 & A\tabularnewline
0 & 4 & A\tabularnewline
0 & 7 & A\tabularnewline
4 & 0 & B\tabularnewline
1 & 5 & B\tabularnewline
4 & 8 & B\tabularnewline
1 & 0 & C\tabularnewline
4 & 5 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Use keys in by

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows (}\KeywordTok{comp}\NormalTok{ (}\KeywordTok{complement}\NormalTok{ #\{}\StringTok{"B"}\NormalTok{\}) }\AttributeTok{:V4}\NormalTok{))}
\NormalTok{    (api/group-by [}\AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/aggregate-columns }\AttributeTok{:V1}\NormalTok{ dfn/sum))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V1\tabularnewline
\midrule
\endhead
C & 6.000\tabularnewline
A & 0.000\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Set keys/indices for multiple columns (ordered)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/order-by DS [}\AttributeTok{:V4} \AttributeTok{:V1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
0 & 0 & A\tabularnewline
0 & 4 & A\tabularnewline
0 & 7 & A\tabularnewline
1 & 5 & B\tabularnewline
4 & 0 & B\tabularnewline
4 & 8 & B\tabularnewline
1 & 0 & C\tabularnewline
1 & 9 & C\tabularnewline
4 & 5 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Subset using multiple keys/indices

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows #(}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V1} \VariableTok{%}\NormalTok{) }\DecValTok{1}\NormalTok{)}
\NormalTok{                           (}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{) }\StringTok{"C"}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}2 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 0 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows #(}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V1} \VariableTok{%}\NormalTok{) }\DecValTok{1}\NormalTok{)}
\NormalTok{                           (#\{}\StringTok{"B"} \StringTok{"C"}\NormalTok{\} (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{)))))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
1 & 5 & B\tabularnewline
1 & 0 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-rows #(}\KeywordTok{and}\NormalTok{ (}\KeywordTok{=}\NormalTok{ (}\AttributeTok{:V1} \VariableTok{%}\NormalTok{) }\DecValTok{1}\NormalTok{)}
\NormalTok{                           (#\{}\StringTok{"B"} \StringTok{"C"}\NormalTok{\} (}\AttributeTok{:V4} \VariableTok{%}\NormalTok{))) \{}\AttributeTok{:result-type} \AttributeTok{:as-indexes}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(4 6 8)
\end{verbatim}

\subparagraph{set*() modifications}\label{set-modifications}

Replace values

There is no mutating operations \texttt{tech.ml.dataset} or easy way to
set value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/update-columns DS }\AttributeTok{:V2}\NormalTok{ #(map-indexed (}\KeywordTok{fn}\NormalTok{ [idx v]}
\NormalTok{                                                   (}\KeywordTok{if}\NormalTok{ (}\KeywordTok{zero?}\NormalTok{ idx) }\DecValTok{3}\NormalTok{ v)) }\VariableTok{%}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
0 & 3 & A\tabularnewline
0 & 4 & A\tabularnewline
0 & 7 & A\tabularnewline
4 & 0 & B\tabularnewline
1 & 5 & B\tabularnewline
4 & 8 & B\tabularnewline
1 & 0 & C\tabularnewline
4 & 5 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Reorder rows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/order-by DS [}\AttributeTok{:V4} \AttributeTok{:V1}\NormalTok{] [}\AttributeTok{:asc} \AttributeTok{:desc}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & :V2 & :V4\tabularnewline
\midrule
\endhead
0 & 3 & A\tabularnewline
0 & 4 & A\tabularnewline
0 & 7 & A\tabularnewline
4 & 0 & B\tabularnewline
4 & 8 & B\tabularnewline
1 & 5 & B\tabularnewline
4 & 5 & C\tabularnewline
1 & 0 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Modify colnames

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/rename-columns DS \{}\AttributeTok{:V2} \StringTok{"v2"}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V1 & v2 & :V4\tabularnewline
\midrule
\endhead
0 & 3 & A\tabularnewline
0 & 4 & A\tabularnewline
0 & 7 & A\tabularnewline
4 & 0 & B\tabularnewline
4 & 8 & B\tabularnewline
1 & 5 & B\tabularnewline
4 & 5 & C\tabularnewline
1 & 0 & C\tabularnewline
1 & 9 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/rename-columns DS \{}\StringTok{"v2"} \AttributeTok{:V2}\NormalTok{\})) }\CommentTok{;; revert back}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Reorder columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ DS }\NormalTok{(api/reorder-columns DS }\AttributeTok{:V4} \AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Advanced use of by}\label{advanced-use-of-by}

Select first/last/\ldots{} row by group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/first)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
B & 4 & 0\tabularnewline
C & 4 & 5\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/select-rows [}\DecValTok{0} \DecValTok{2}\NormalTok{])}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/tail }\DecValTok{2}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Select rows using a nested query

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/order-by }\AttributeTok{:V2}\NormalTok{)}
\NormalTok{    (api/first)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
B & 4 & 0\tabularnewline
C & 1 & 0\tabularnewline
\bottomrule
\end{longtable}

Add a group counter column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/group-by [}\AttributeTok{:V4} \AttributeTok{:V1}\NormalTok{])}
\NormalTok{    (api/ungroup \{}\AttributeTok{:add-group-id-as-column} \AttributeTok{:Grp}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 4{]}:

\begin{longtable}[]{@{}llll@{}}
\toprule
:Grp & :V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
0 & A & 0 & 3\tabularnewline
0 & A & 0 & 4\tabularnewline
0 & A & 0 & 7\tabularnewline
1 & B & 1 & 5\tabularnewline
2 & C & 1 & 0\tabularnewline
2 & C & 1 & 9\tabularnewline
3 & B & 4 & 0\tabularnewline
3 & B & 4 & 8\tabularnewline
4 & C & 4 & 5\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Get row number of first (and last) observation by group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:row-id}\NormalTok{ (}\KeywordTok{range}\NormalTok{))}
\NormalTok{    (api/select-columns [}\AttributeTok{:V4} \AttributeTok{:row-id}\NormalTok{])}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :row-id\tabularnewline
\midrule
\endhead
A & 0\tabularnewline
A & 1\tabularnewline
A & 2\tabularnewline
B & 3\tabularnewline
B & 4\tabularnewline
B & 5\tabularnewline
C & 6\tabularnewline
C & 7\tabularnewline
C & 8\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:row-id}\NormalTok{ (}\KeywordTok{range}\NormalTok{))}
\NormalTok{    (api/select-columns [}\AttributeTok{:V4} \AttributeTok{:row-id}\NormalTok{])}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/first)}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :row-id\tabularnewline
\midrule
\endhead
A & 0\tabularnewline
B & 3\tabularnewline
C & 6\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/add-or-update-column }\AttributeTok{:row-id}\NormalTok{ (}\KeywordTok{range}\NormalTok{))}
\NormalTok{    (api/select-columns [}\AttributeTok{:V4} \AttributeTok{:row-id}\NormalTok{])}
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/select-rows [}\DecValTok{0} \DecValTok{2}\NormalTok{])}
\NormalTok{    (api/ungroup))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}6 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :row-id\tabularnewline
\midrule
\endhead
A & 0\tabularnewline
A & 2\tabularnewline
B & 3\tabularnewline
B & 5\tabularnewline
C & 6\tabularnewline
C & 8\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Handle list-columns by group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS}
\NormalTok{    (api/select-columns [}\AttributeTok{:V1} \AttributeTok{:V4}\NormalTok{])}
\NormalTok{    (api/fold-by }\AttributeTok{:V4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V4 & :V1\tabularnewline
\midrule
\endhead
B & {[}4 4 1{]}\tabularnewline
C & {[}4 1 1{]}\tabularnewline
A & {[}0 0 0{]}\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ DS    }
\NormalTok{    (api/group-by }\AttributeTok{:V4}\NormalTok{)}
\NormalTok{    (api/unmark-group))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:name & :group-id & :data\tabularnewline
\midrule
\endhead
A & 0 & Group: A {[}3 3{]}:\tabularnewline
B & 1 & Group: B {[}3 3{]}:\tabularnewline
C & 2 & Group: C {[}3 3{]}:\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Grouping sets (multiple by at once)

Not available.

\paragraph{Miscellaneous}\label{miscellaneous}

\subparagraph{Read / Write data}\label{read-write-data}

Write data to a csv file

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/write-csv! DS }\StringTok{"DF.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
nil
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Write data to a tab-delimited file

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/write-csv! DS }\StringTok{"DF.txt"}\NormalTok{ \{}\AttributeTok{:separator} \CharTok{\textbackslash{}tab}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
nil
\end{verbatim}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/write-csv! DS }\StringTok{"DF.tsv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
nil
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Read a csv / tab-delimited file

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\StringTok{"DF.csv"}\NormalTok{ \{}\AttributeTok{:key-fn} \KeywordTok{keyword}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

DF.csv {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\StringTok{"DF.txt"}\NormalTok{ \{}\AttributeTok{:key-fn} \KeywordTok{keyword}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

DF.txt {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\StringTok{"DF.tsv"}\NormalTok{ \{}\AttributeTok{:key-fn} \KeywordTok{keyword}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

DF.tsv {[}9 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Read a csv file selecting / droping columns

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\StringTok{"DF.csv"}\NormalTok{ \{}\AttributeTok{:key-fn} \KeywordTok{keyword}
                       \AttributeTok{:column-whitelist}\NormalTok{ [}\StringTok{"V1"} \StringTok{"V4"}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

DF.csv {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V4\tabularnewline
\midrule
\endhead
0 & A\tabularnewline
0 & A\tabularnewline
0 & A\tabularnewline
4 & B\tabularnewline
4 & B\tabularnewline
1 & B\tabularnewline
4 & C\tabularnewline
1 & C\tabularnewline
1 & C\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/dataset }\StringTok{"DF.csv"}\NormalTok{ \{}\AttributeTok{:key-fn} \KeywordTok{keyword}
                       \AttributeTok{:column-blacklist}\NormalTok{ [}\StringTok{"V4"}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

DF.csv {[}9 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
0 & 3\tabularnewline
0 & 4\tabularnewline
0 & 7\tabularnewline
4 & 0\tabularnewline
4 & 8\tabularnewline
1 & 5\tabularnewline
4 & 5\tabularnewline
1 & 0\tabularnewline
1 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Read and rbind several files

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{apply}\NormalTok{ api/concat (}\KeywordTok{map}\NormalTok{ api/dataset [}\StringTok{"DF.csv"} \StringTok{"DF.csv"}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

null {[}18 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
V4 & V1 & V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Reshape data}\label{reshape-data}

Melt data (from wide to long)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\BuiltInTok{def}\FunctionTok{ mDS }\NormalTok{(api/pivot->longer DS [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] \{}\AttributeTok{:target-columns} \AttributeTok{:variable}
                                          \AttributeTok{:value-column-name} \AttributeTok{:value}\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mDS}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}18 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :variable & :value\tabularnewline
\midrule
\endhead
A & :V1 & 0\tabularnewline
A & :V1 & 0\tabularnewline
A & :V1 & 0\tabularnewline
B & :V1 & 4\tabularnewline
B & :V1 & 4\tabularnewline
B & :V1 & 1\tabularnewline
C & :V1 & 4\tabularnewline
C & :V1 & 1\tabularnewline
C & :V1 & 1\tabularnewline
A & :V2 & 3\tabularnewline
A & :V2 & 4\tabularnewline
A & :V2 & 7\tabularnewline
B & :V2 & 0\tabularnewline
B & :V2 & 8\tabularnewline
B & :V2 & 5\tabularnewline
C & :V2 & 5\tabularnewline
C & :V2 & 0\tabularnewline
C & :V2 & 9\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Cast data (from long to wide)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ mDS}
\NormalTok{    (api/pivot->wider }\AttributeTok{:variable} \AttributeTok{:value}\NormalTok{ \{}\AttributeTok{:fold-fn} \KeywordTok{vec}\NormalTok{\})}
\NormalTok{    (api/update-columns [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] (}\KeywordTok{partial} \KeywordTok{map} \KeywordTok{count}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
C & 3 & 3\tabularnewline
B & 3 & 3\tabularnewline
A & 3 & 3\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ mDS}
\NormalTok{    (api/pivot->wider }\AttributeTok{:variable} \AttributeTok{:value}\NormalTok{ \{}\AttributeTok{:fold-fn} \KeywordTok{vec}\NormalTok{\})}
\NormalTok{    (api/update-columns [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] (}\KeywordTok{partial} \KeywordTok{map}\NormalTok{ dfn/sum)))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
C & 6.000 & 14.00\tabularnewline
B & 9.000 & 13.00\tabularnewline
A & 0.000 & 14.00\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ mDS}
\NormalTok{    (api/map-columns }\AttributeTok{:value}\NormalTok{ #(}\KeywordTok{if}\NormalTok{ (}\KeywordTok{>} \VariableTok{%} \DecValTok{5}\NormalTok{) }\AttributeTok{:true} \AttributeTok{:false}\NormalTok{)) }\CommentTok{;; should be just perdicate, but no option to name `false`}
\NormalTok{    (api/pivot->wider }\AttributeTok{:value} \AttributeTok{:variable}\NormalTok{ \{}\AttributeTok{:fold-fn} \KeywordTok{vec}\NormalTok{\})}
\NormalTok{    (api/update-columns [}\AttributeTok{:true} \AttributeTok{:false}\NormalTok{] (}\KeywordTok{partial} \KeywordTok{map}\NormalTok{ #(}\KeywordTok{if}\NormalTok{ (}\KeywordTok{sequential?} \VariableTok{%}\NormalTok{) (}\KeywordTok{count} \VariableTok{%}\NormalTok{) }\DecValTok{1}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :false & :true\tabularnewline
\midrule
\endhead
A & 5 & 1\tabularnewline
B & 5 & 1\tabularnewline
C & 5 & 1\tabularnewline
\bottomrule
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Split

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(api/group-by DS }\AttributeTok{:V4}\NormalTok{ \{}\AttributeTok{:result-type} \AttributeTok{:as-map}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\{``A'' Group: A {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
A & 0 & 3\tabularnewline
A & 0 & 4\tabularnewline
A & 0 & 7\tabularnewline
\bottomrule
\end{longtable}

, ``B'' Group: B {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
B & 4 & 0\tabularnewline
B & 4 & 8\tabularnewline
B & 1 & 5\tabularnewline
\bottomrule
\end{longtable}

, ``C'' Group: C {[}3 3{]}:

\begin{longtable}[]{@{}lll@{}}
\toprule
:V4 & :V1 & :V2\tabularnewline
\midrule
\endhead
C & 4 & 5\tabularnewline
C & 1 & 0\tabularnewline
C & 1 & 9\tabularnewline
\bottomrule
\end{longtable}

\}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Split and transpose a vector/column

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\KeywordTok{->}\NormalTok{ \{}\AttributeTok{:a}\NormalTok{ [}\StringTok{"A:a"} \StringTok{"B:b"} \StringTok{"C:c"}\NormalTok{]\}}
\NormalTok{    (api/dataset)}
\NormalTok{    (api/separate-column }\AttributeTok{:a}\NormalTok{ [}\AttributeTok{:V1} \AttributeTok{:V2}\NormalTok{] }\StringTok{":"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\_unnamed {[}3 2{]}:

\begin{longtable}[]{@{}ll@{}}
\toprule
:V1 & :V2\tabularnewline
\midrule
\endhead
A & a\tabularnewline
B & b\tabularnewline
C & c\tabularnewline
\bottomrule
\end{longtable}

\subparagraph{Other}\label{other-1}

\end{document}
